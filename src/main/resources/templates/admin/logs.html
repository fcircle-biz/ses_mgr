<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layouts/default :: layout(~{::title}, ~{::main})}">
<head>
    <meta charset="UTF-8">
    <title>ログ管理 | SES業務システム</title>
</head>
<body>
<main>
    <!-- パンくずリスト -->
    <div class="container-fluid py-2 bg-light border-bottom">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a th:href="@{/}">ホーム</a></li>
                <li class="breadcrumb-item"><a th:href="@{/admin}">システム管理</a></li>
                <li class="breadcrumb-item active" aria-current="page">ログ管理</li>
            </ol>
        </nav>
    </div>

    <!-- メインコンテンツ -->
    <div class="container-fluid my-4">
        <!-- ページヘッダー -->
        <div class="page-header mb-4">
            <h2 class="h4 mb-0">ログ管理</h2>
        </div>

        <!-- ログ管理タブ -->
        <ul class="nav nav-tabs mb-4" id="logTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="audit-tab" data-bs-toggle="tab" data-bs-target="#audit-tab-pane" type="button" role="tab" aria-controls="audit-tab-pane" aria-selected="true">監査ログ</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security-tab-pane" type="button" role="tab" aria-controls="security-tab-pane" aria-selected="false">セキュリティログ</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="system-tab" data-bs-toggle="tab" data-bs-target="#system-tab-pane" type="button" role="tab" aria-controls="system-tab-pane" aria-selected="false">システムログ</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-tab-pane" type="button" role="tab" aria-controls="login-tab-pane" aria-selected="false">ログイン履歴</button>
            </li>
        </ul>
        
        <div class="tab-content" id="logTabsContent">
            <!-- 監査ログタブ -->
            <div class="tab-pane fade show active" id="audit-tab-pane" role="tabpanel" aria-labelledby="audit-tab" tabindex="0">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">監査ログ</h5>
                    </div>
                    <div class="card-body">
                        <!-- 検索条件 -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">検索条件</h6>
                            </div>
                            <div class="card-body">
                                <form id="audit-search-form">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label for="auditStartDate" class="form-label">期間（開始）</label>
                                            <input type="date" class="form-control" id="auditStartDate" name="startDate">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="auditEndDate" class="form-label">期間（終了）</label>
                                            <input type="date" class="form-control" id="auditEndDate" name="endDate">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="auditUser" class="form-label">ユーザー</label>
                                            <input type="text" class="form-control" id="auditUser" name="user">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="auditAction" class="form-label">操作種別</label>
                                            <select class="form-select" id="auditAction" name="action">
                                                <option value="">すべて</option>
                                                <option value="CREATE">作成</option>
                                                <option value="UPDATE">更新</option>
                                                <option value="DELETE">削除</option>
                                                <option value="ASSIGN">割り当て</option>
                                                <option value="REMOVE">削除</option>
                                                <option value="LOGIN">ログイン</option>
                                                <option value="LOGOUT">ログアウト</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="auditEntity" class="form-label">対象エンティティ</label>
                                            <select class="form-select" id="auditEntity" name="entity">
                                                <option value="">すべて</option>
                                                <option value="USER">ユーザー</option>
                                                <option value="ROLE">ロール</option>
                                                <option value="PERMISSION">権限</option>
                                                <option value="DEPARTMENT">部門</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="auditStatus" class="form-label">ステータス</label>
                                            <select class="form-select" id="auditStatus" name="status">
                                                <option value="">すべて</option>
                                                <option value="SUCCESS">成功</option>
                                                <option value="FAILURE">失敗</option>
                                            </select>
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-outline-secondary me-2" id="btn-clear-audit-search">クリア</button>
                                            <button type="submit" class="btn btn-primary">検索</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- 検索結果 -->
                        <div class="table-responsive">
                            <table class="table table-hover" id="audit-log-table">
                                <thead>
                                    <tr>
                                        <th>日時</th>
                                        <th>ユーザー</th>
                                        <th>操作種別</th>
                                        <th>対象エンティティ</th>
                                        <th>対象ID</th>
                                        <th>詳細情報</th>
                                        <th>ステータス</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- サンプルデータ -->
                                    <tr>
                                        <td>2025/05/05 15:30:45</td>
                                        <td>admin</td>
                                        <td>CREATE</td>
                                        <td>USER</td>
                                        <td>1001</td>
                                        <td>ユーザー作成: 山田 太郎</td>
                                        <td><span class="badge text-bg-success">成功</span></td>
                                    </tr>
                                    <tr>
                                        <td>2025/05/05 15:35:22</td>
                                        <td>admin</td>
                                        <td>ASSIGN</td>
                                        <td>USER_ROLE</td>
                                        <td>1001</td>
                                        <td>ロール割り当て: 営業担当者</td>
                                        <td><span class="badge text-bg-success">成功</span></td>
                                    </tr>
                                    <tr>
                                        <td>2025/05/05 16:10:05</td>
                                        <td>admin</td>
                                        <td>UPDATE</td>
                                        <td>ROLE</td>
                                        <td>SALES</td>
                                        <td>ロール更新: 権限変更</td>
                                        <td><span class="badge text-bg-success">成功</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- ページネーション -->
                        <nav aria-label="ページナビゲーション" class="mt-3">
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">前へ</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">次へ</a>
                                </li>
                            </ul>
                        </nav>

                        <!-- エクスポートボタン -->
                        <div class="text-end mt-3">
                            <button type="button" class="btn btn-outline-secondary" id="btn-export-audit-log">
                                <i class="bi bi-download me-1"></i>CSVエクスポート
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- セキュリティログタブ -->
            <div class="tab-pane fade" id="security-tab-pane" role="tabpanel" aria-labelledby="security-tab" tabindex="0">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">セキュリティログ</h5>
                    </div>
                    <div class="card-body">
                        <!-- 検索条件 -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">検索条件</h6>
                            </div>
                            <div class="card-body">
                                <form id="security-search-form">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label for="securityStartDate" class="form-label">期間（開始）</label>
                                            <input type="date" class="form-control" id="securityStartDate" name="startDate">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="securityEndDate" class="form-label">期間（終了）</label>
                                            <input type="date" class="form-control" id="securityEndDate" name="endDate">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="securityType" class="form-label">ログ種別</label>
                                            <select class="form-select" id="securityType" name="type">
                                                <option value="">すべて</option>
                                                <option value="AUTH_FAILURE">認証失敗</option>
                                                <option value="ACCESS_DENIED">アクセス拒否</option>
                                                <option value="ACCOUNT_LOCKED">アカウントロック</option>
                                                <option value="PASSWORD_RESET">パスワードリセット</option>
                                                <option value="MFA_FAILURE">多要素認証失敗</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="securityUser" class="form-label">ユーザー</label>
                                            <input type="text" class="form-control" id="securityUser" name="user">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="securityIp" class="form-label">IPアドレス</label>
                                            <input type="text" class="form-control" id="securityIp" name="ip">
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-outline-secondary me-2" id="btn-clear-security-search">クリア</button>
                                            <button type="submit" class="btn btn-primary">検索</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- 検索結果 -->
                        <div class="table-responsive">
                            <table class="table table-hover" id="security-log-table">
                                <thead>
                                    <tr>
                                        <th>日時</th>
                                        <th>種別</th>
                                        <th>ユーザー</th>
                                        <th>IPアドレス</th>
                                        <th>ユーザーエージェント</th>
                                        <th>詳細情報</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- サンプルデータ -->
                                    <tr>
                                        <td>2025/05/05 10:15:22</td>
                                        <td><span class="badge text-bg-danger">認証失敗</span></td>
                                        <td>user123</td>
                                        <td>192.168.1.100</td>
                                        <td>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</td>
                                        <td>パスワード不一致</td>
                                    </tr>
                                    <tr>
                                        <td>2025/05/05 10:15:45</td>
                                        <td><span class="badge text-bg-danger">認証失敗</span></td>
                                        <td>user123</td>
                                        <td>192.168.1.100</td>
                                        <td>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</td>
                                        <td>パスワード不一致</td>
                                    </tr>
                                    <tr>
                                        <td>2025/05/05 10:16:10</td>
                                        <td><span class="badge text-bg-warning">アカウントロック</span></td>
                                        <td>user123</td>
                                        <td>192.168.1.100</td>
                                        <td>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</td>
                                        <td>連続5回ログイン失敗によるロック</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- ページネーション -->
                        <nav aria-label="ページナビゲーション" class="mt-3">
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">前へ</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">次へ</a>
                                </li>
                            </ul>
                        </nav>

                        <!-- エクスポートボタン -->
                        <div class="text-end mt-3">
                            <button type="button" class="btn btn-outline-secondary" id="btn-export-security-log">
                                <i class="bi bi-download me-1"></i>CSVエクスポート
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- システムログタブ -->
            <div class="tab-pane fade" id="system-tab-pane" role="tabpanel" aria-labelledby="system-tab" tabindex="0">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">システムログ</h5>
                    </div>
                    <div class="card-body">
                        <p>システムログの管理画面です。システムの動作ログを確認できます。</p>
                        <!-- 実装は省略 -->
                    </div>
                </div>
            </div>

            <!-- ログイン履歴タブ -->
            <div class="tab-pane fade" id="login-tab-pane" role="tabpanel" aria-labelledby="login-tab" tabindex="0">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">ログイン履歴</h5>
                    </div>
                    <div class="card-body">
                        <!-- 検索条件 -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">検索条件</h6>
                            </div>
                            <div class="card-body">
                                <form id="login-search-form">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label for="loginStartDate" class="form-label">期間（開始）</label>
                                            <input type="date" class="form-control" id="loginStartDate" name="startDate">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="loginEndDate" class="form-label">期間（終了）</label>
                                            <input type="date" class="form-control" id="loginEndDate" name="endDate">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="loginUser" class="form-label">ユーザー</label>
                                            <input type="text" class="form-control" id="loginUser" name="user">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="loginIp" class="form-label">IPアドレス</label>
                                            <input type="text" class="form-control" id="loginIp" name="ip">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="loginStatus" class="form-label">ステータス</label>
                                            <select class="form-select" id="loginStatus" name="status">
                                                <option value="">すべて</option>
                                                <option value="SUCCESS">成功</option>
                                                <option value="FAILURE">失敗</option>
                                            </select>
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-outline-secondary me-2" id="btn-clear-login-search">クリア</button>
                                            <button type="submit" class="btn btn-primary">検索</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- 検索結果 -->
                        <div class="table-responsive">
                            <table class="table table-hover" id="login-log-table">
                                <thead>
                                    <tr>
                                        <th>日時</th>
                                        <th>ユーザー</th>
                                        <th>IPアドレス</th>
                                        <th>ユーザーエージェント</th>
                                        <th>ステータス</th>
                                        <th>備考</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- サンプルデータ -->
                                    <tr>
                                        <td>2025/05/05 09:15:22</td>
                                        <td>admin</td>
                                        <td>192.168.1.150</td>
                                        <td>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</td>
                                        <td><span class="badge text-bg-success">成功</span></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>2025/05/05 09:30:45</td>
                                        <td>user001</td>
                                        <td>192.168.1.151</td>
                                        <td>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)</td>
                                        <td><span class="badge text-bg-success">成功</span></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>2025/05/05 10:15:22</td>
                                        <td>user123</td>
                                        <td>192.168.1.100</td>
                                        <td>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</td>
                                        <td><span class="badge text-bg-danger">失敗</span></td>
                                        <td>パスワード不一致</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- ページネーション -->
                        <nav aria-label="ページナビゲーション" class="mt-3">
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">前へ</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">次へ</a>
                                </li>
                            </ul>
                        </nav>

                        <!-- エクスポートボタン -->
                        <div class="text-end mt-3">
                            <button type="button" class="btn btn-outline-secondary" id="btn-export-login-log">
                                <i class="bi bi-download me-1"></i>CSVエクスポート
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- ページ固有のJavaScript -->
<script th:inline="javascript">
document.addEventListener('DOMContentLoaded', function() {
    // 監査ログタブの検索フォームクリア
    document.getElementById('btn-clear-audit-search').addEventListener('click', function() {
        document.getElementById('audit-search-form').reset();
    });

    // セキュリティログタブの検索フォームクリア
    document.getElementById('btn-clear-security-search').addEventListener('click', function() {
        document.getElementById('security-search-form').reset();
    });

    // ログイン履歴タブの検索フォームクリア
    document.getElementById('btn-clear-login-search').addEventListener('click', function() {
        document.getElementById('login-search-form').reset();
    });

    // CSVエクスポート処理
    document.getElementById('btn-export-audit-log').addEventListener('click', function() {
        alert('監査ログをCSVでエクスポートしました');
    });

    document.getElementById('btn-export-security-log').addEventListener('click', function() {
        alert('セキュリティログをCSVでエクスポートしました');
    });

    document.getElementById('btn-export-login-log').addEventListener('click', function() {
        alert('ログイン履歴をCSVでエクスポートしました');
    });
});
</script>
</body>
</html>