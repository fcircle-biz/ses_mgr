<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ダッシュボード | SES業務システム</title>
</head>
<body>
    <th:block th:replace="~{layouts/default :: 
        ~{::title},
        ~{::section},
        ~{::link},
        ~{::script}
    }">
        <title>ダッシュボード | SES業務システム</title>
        
        <section>
            <div class="welcome-banner">
                <h3>ようこそ、<span th:text="${currentUser != null ? currentUser.fullName : 'ゲスト'}">山田 太郎</span>さん</h3>
                <p>今日は <span th:text="${#dates.format(#dates.createNow(), 'yyyy年MM月dd日（E）')}">2025年5月1日（木）</span> です。今週の重要なタスクとスケジュールをご確認ください。</p>
            </div>
            
            <!-- KPIステータスカード -->
            <div class="row mb-4">
                <div class="col-md-3 mb-4 mb-md-0">
                    <div class="card text-white bg-primary kpi-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-0">技術者稼働率</h6>
                                    <p class="kpi-value my-2" th:text="${kpi.utilizationRate + '%'}">86.7%</p>
                                    <p class="kpi-delta mb-0"><i class="bi bi-arrow-up-short"></i> <span th:text="${'+' + kpi.utilizationRateChange + '%'}">+2.1%</span> 前月比</p>
                                </div>
                                <i class="bi bi-people kpi-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4 mb-md-0">
                    <div class="card text-white bg-success kpi-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-0">進行中の案件</h6>
                                    <p class="kpi-value my-2" th:text="${kpi.activeProjects}">42</p>
                                    <p class="kpi-delta mb-0"><i class="bi bi-arrow-up-short"></i> <span th:text="${'+' + kpi.activeProjectsChange}">+3</span> 前週比</p>
                                </div>
                                <i class="bi bi-briefcase kpi-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4 mb-md-0">
                    <div class="card text-white bg-info kpi-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-0">今月の売上</h6>
                                    <p class="kpi-value my-2" th:text="${kpi.monthlySales + 'M'}">43.8M</p>
                                    <p class="kpi-delta mb-0">目標達成率 <span th:text="${kpi.salesTargetProgress + '%'}">92%</span></p>
                                </div>
                                <i class="bi bi-graph-up-arrow kpi-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-warning kpi-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-0">新規問い合わせ</h6>
                                    <p class="kpi-value my-2" th:text="${kpi.newInquiries}">12</p>
                                    <p class="kpi-delta mb-0">未対応 <span th:text="${kpi.pendingInquiries + '件'}">5件</span></p>
                                </div>
                                <i class="bi bi-bell kpi-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <!-- 売上推移グラフ -->
                <div class="col-lg-8 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">売上推移</h5>
                            <div class="btn-group period-selector">
                                <button type="button" class="btn btn-sm btn-outline-secondary" data-period="year">年間</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary active" data-period="half">半期</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" data-period="quarter">四半期</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 技術者スキル分布 -->
                <div class="col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">技術者スキル分布</h5>
                            <a th:href="@{/reports/skills}" class="btn btn-sm btn-outline-primary">詳細</a>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="utilizationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- 案件ステータス -->
                <div class="col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">案件ステータス</h5>
                            <a th:href="@{/projects}" class="btn btn-sm btn-outline-primary">案件一覧</a>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="projectStatusChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 最近の案件 -->
                <div class="col-lg-8 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">最近の案件</h5>
                            <a th:href="@{/projects}" class="btn btn-sm btn-outline-primary">案件一覧へ</a>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>案件ID</th>
                                            <th>案件名</th>
                                            <th>顧客名</th>
                                            <th>開始日</th>
                                            <th>ステータス</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="project : ${recentProjects}">
                                            <td th:text="${project.id}">PRJ-ID</td>
                                            <td th:text="${project.name}">案件名</td>
                                            <td th:text="${project.client}">顧客名</td>
                                            <td th:text="${project.startDate}">開始日</td>
                                            <td><span th:class="${'badge bg-' + project.statusClass}" th:text="${project.status}">ステータス</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- 重要通知 -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">重要な通知</h5>
                            <a th:href="@{/notifications}" class="btn btn-sm btn-outline-primary">全て見る</a>
                        </div>
                        <div class="card-body">
                            <div th:each="notification : ${notifications}" th:class="${'notification-item' + (notification.isUnread ? ' unread' : '')}">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1" th:text="${notification.title}">通知タイトル</h6>
                                    <small class="text-muted" th:text="${notification.time}">時間</small>
                                </div>
                                <p class="mb-1" th:text="${notification.message}">通知内容</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- アクティビティログ -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">最近のアクティビティ</h5>
                        </div>
                        <div class="card-body">
                            <div th:each="activity : ${activities}" class="activity-item">
                                <div class="d-flex">
                                    <div class="me-3">
                                        <span th:class="${'avatar-circle bg-' + activity.avatarColor + ' text-white'}">
                                            <span th:text="${activity.userInitial}">頭</span>
                                        </span>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1" th:text="${activity.userName}">ユーザー名</h6>
                                            <small th:text="${activity.time}">時間</small>
                                        </div>
                                        <p class="mb-1" th:text="${activity.message}">アクティビティ内容</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <link th:href="@{/css/dashboard.css}" rel="stylesheet">
        
        <script th:src="@{/webjars/chart.js/4.3.0/dist/chart.umd.js}"></script>
        <script th:src="@{/js/dashboard.js}"></script>
    </th:block>
</body>
</html>