# マッチングモジュール インターフェース定義

## 1. インターフェース概要

マッチングモジュールは、技術者と案件のマッチング検索、マッチング結果管理、提案管理、提案書管理、マッチング分析の各機能を他モジュールに提供します。またマッチングに必要な情報を取得するために他モジュールのインターフェースを利用します。

## 2. 提供インターフェース

マッチングモジュールが他のモジュールに提供するインターフェースを定義します。

### 2.1 マッチング検索サービス (MatchingSearchService)

技術者と案件のマッチング検索機能を提供するサービスインターフェースです。

```java
public interface MatchingSearchService {
    // 案件に適した技術者のマッチング検索
    Page<EngineerMatchingResultDTO> findEngineersForProject(ProjectMatchingSearchDTO searchCriteria, Pageable pageable);

    // 技術者に適した案件のマッチング検索
    Page<ProjectMatchingResultDTO> findProjectsForEngineer(EngineerMatchingSearchDTO searchCriteria, Pageable pageable);

    // マッチング検索条件の保存
    Long saveMatchingCriteria(MatchingCriteriaSaveDTO criteria);

    // 保存済みマッチング検索条件の取得
    MatchingCriteriaDTO getMatchingCriteria(Long criteriaId);

    // 保存済みマッチング検索条件の一覧取得
    List<MatchingCriteriaSummaryDTO> listMatchingCriteria(MatchingCriteriaFilterDTO filter);

    // おすすめマッチングの取得
    Page<MatchingRecommendationDTO> getRecommendedMatchings(MatchingRecommendationCriteriaDTO criteria, Pageable pageable);

    // 案件と技術者の個別マッチング評価
    MatchingDetailResultDTO evaluateMatching(Long projectId, Long engineerId, MatchingEvaluationOptionsDTO options);
}
```

**使用コンテキスト**：
- 営業担当者やマッチング担当者が案件に適した技術者を検索する場合
- 技術者担当者が技術者に適した案件を検索する場合
- マッチング結果の詳細を分析する場合
- 定期的な自動マッチング推奨を実行する場合

### 2.2 マッチング結果管理サービス (MatchingResultService)

マッチング結果の管理機能を提供するサービスインターフェースです。

```java
public interface MatchingResultService {
    // マッチング結果の取得
    MatchingResultDTO getMatchingResult(Long matchingId);

    // マッチング結果の登録
    Long createMatchingResult(MatchingResultCreateDTO matchingResult);

    // マッチング結果の更新
    void updateMatchingResult(MatchingResultUpdateDTO matchingResult);

    // マッチング結果のステータス変更
    void updateMatchingStatus(Long matchingId, Long statusId, String statusChangeReason);

    // 案件のマッチング結果一覧取得
    Page<MatchingResultSummaryDTO> getMatchingResultsByProject(Long projectId, MatchingResultFilterDTO filter, Pageable pageable);

    // 技術者のマッチング結果一覧取得
    Page<MatchingResultSummaryDTO> getMatchingResultsByEngineer(Long engineerId, MatchingResultFilterDTO filter, Pageable pageable);

    // マッチングステータス一覧取得
    List<MatchingStatusDTO> getMatchingStatuses();
}
```

**使用コンテキスト**：
- マッチング結果を保存し案件進捗管理に活用する場合
- マッチング結果から提案を作成する前段階の処理
- 案件や技術者に対するマッチング履歴を確認する場合
- マッチング結果の承認フローを管理する場合

### 2.3 提案管理サービス (ProposalService)

提案の管理機能を提供するサービスインターフェースです。

```java
public interface ProposalService {
    // 提案の取得
    ProposalDTO getProposal(Long proposalId);

    // 提案の作成
    Long createProposal(ProposalCreateDTO proposal);

    // 提案の更新
    void updateProposal(ProposalUpdateDTO proposal);

    // 提案のステータス変更
    void updateProposalStatus(Long proposalId, Long statusId, String statusChangeReason);

    // 提案の承認
    void approveProposal(Long proposalId, ProposalApprovalDTO approval);

    // 案件の提案一覧取得
    Page<ProposalSummaryDTO> getProposalsByProject(Long projectId, ProposalFilterDTO filter, Pageable pageable);

    // 提案技術者の追加/更新/削除
    Long addProposalEngineer(ProposalEngineerDTO proposalEngineer);
    void updateProposalEngineer(ProposalEngineerDTO proposalEngineer);
    void removeProposalEngineer(Long proposalEngineerId);

    // 提案技術者一覧取得
    List<ProposalEngineerDTO> getProposalEngineers(Long proposalId);
}
```

**使用コンテキスト**：
- マッチング結果に基づき顧客への提案を作成する場合
- 提案内容の承認ワークフローを管理する場合
- 提案の進捗状況を追跡する場合
- 提案に含める技術者情報を管理する場合

### 2.4 提案書管理サービス (ProposalDocumentService)

提案書の管理機能を提供するサービスインターフェースです。

```java
public interface ProposalDocumentService {
    // 提案書の取得
    ProposalDocumentDTO getProposalDocument(Long documentId);

    // 提案書の生成
    Long generateProposalDocument(ProposalDocumentGenerateDTO generateRequest);

    // 提案書の更新
    void updateProposalDocument(ProposalDocumentUpdateDTO document);

    // 提案書の承認処理
    void requestDocumentApproval(Long documentId, DocumentApprovalRequestDTO request);
    void processDocumentApproval(Long documentId, DocumentApprovalResultDTO result);

    // 提案の提案書一覧取得
    List<ProposalDocumentSummaryDTO> getProposalDocuments(Long proposalId);

    // 提案書のエクスポート
    FileDownloadDTO exportProposalDocument(Long documentId, DocumentExportOptionsDTO options, DocumentFormatEnum format);
}
```

**使用コンテキスト**：
- 提案情報からフォーマット済みの提案書を作成する場合
- 提案書のバージョン管理を行う場合
- 提案書の承認フローを管理する場合
- 提案書をPDFやWord形式でエクスポートする場合

### 2.5 マッチングレポートサービス (MatchingReportService)

マッチングの分析レポート機能を提供するサービスインターフェースです。

```java
public interface MatchingReportService {
    // マッチングトレンド分析
    MatchingTrendReportDTO analyzeMatchingTrends(MatchingReportCriteriaDTO criteria);

    // スキル需給バランス分析
    SkillDemandSupplyReportDTO analyzeSkillDemandSupply(MatchingReportCriteriaDTO criteria);

    // マッチング成約率分析
    MatchingSuccessRateReportDTO analyzeMatchingSuccessRate(MatchingReportCriteriaDTO criteria);

    // 技術者マッチング分析
    EngineerMatchingReportDTO analyzeEngineerMatching(Long engineerId, MatchingReportCriteriaDTO criteria);

    // 案件マッチング分析
    ProjectMatchingReportDTO analyzeProjectMatching(Long projectId, MatchingReportCriteriaDTO criteria);
}
```

**使用コンテキスト**：
- マッチングの傾向を分析し戦略的意思決定に活用する場合
- スキルの需給状況を把握し採用や教育計画に活用する場合
- 特定技術者のマッチング状況を分析しキャリア計画に活用する場合
- 特定案件の要員充足状況を分析する場合

## 3. データ交換モデル

マッチングモジュールでは以下の主要なデータ交換モデルを定義します。

### 3.1 マッチング検索関連

- **ProjectMatchingSearchDTO**: 案件に適した技術者を検索するための条件を表現
- **EngineerMatchingSearchDTO**: 技術者に適した案件を検索するための条件を表現
- **EngineerMatchingResultDTO**: 技術者マッチング検索結果を表現
- **ProjectMatchingResultDTO**: 案件マッチング検索結果を表現
- **MatchingDetailResultDTO**: 案件と技術者のマッチング詳細評価結果を表現

### 3.2 マッチング結果関連

- **MatchingResultDTO**: マッチング結果の詳細情報を表現
- **MatchingResultCreateDTO**: マッチング結果作成時の入力情報を表現
- **MatchingResultUpdateDTO**: マッチング結果更新時の入力情報を表現
- **MatchingResultSummaryDTO**: マッチング結果の概要情報を表現
- **MatchingStatusDTO**: マッチング結果のステータス情報を表現

### 3.3 提案関連

- **ProposalDTO**: 提案の詳細情報を表現
- **ProposalCreateDTO**: 提案作成時の入力情報を表現
- **ProposalUpdateDTO**: 提案更新時の入力情報を表現
- **ProposalSummaryDTO**: 提案の概要情報を表現
- **ProposalEngineerDTO**: 提案に含まれる技術者情報を表現

### 3.4 提案書関連

- **ProposalDocumentDTO**: 提案書の詳細情報を表現
- **ProposalDocumentGenerateDTO**: 提案書生成時の入力情報を表現
- **ProposalDocumentUpdateDTO**: 提案書更新時の入力情報を表現
- **DocumentApprovalRequestDTO**: 提案書承認依頼情報を表現
- **DocumentApprovalResultDTO**: 提案書承認結果情報を表現

### 3.5 レポート関連

- **MatchingReportCriteriaDTO**: マッチングレポート生成条件を表現
- **MatchingTrendReportDTO**: マッチングトレンド分析結果を表現
- **SkillDemandSupplyReportDTO**: スキル需給バランス分析結果を表現
- **MatchingSuccessRateReportDTO**: マッチング成約率分析結果を表現
- **EngineerMatchingReportDTO**: 技術者マッチング分析結果を表現
- **ProjectMatchingReportDTO**: 案件マッチング分析結果を表現

## 4. 要求インターフェース

マッチングモジュールが他のモジュールに要求するインターフェースを定義します。

### 4.1 案件管理モジュール

- **ProjectService**: 案件の基本情報を取得するためのインターフェース
- **ProjectQueryService**: 案件を検索するためのインターフェース
- **ResourceRequirementService**: 案件の要員要件情報を取得するためのインターフェース

### 4.2 技術者管理モジュール

- **EngineerService**: 技術者の基本情報を取得するためのインターフェース
- **EngineerQueryService**: 技術者を検索するためのインターフェース
- **SkillManagementService**: 技術者のスキル情報を取得するためのインターフェース
- **AvailabilityService**: 技術者の稼働状況を取得するためのインターフェース
- **SkillSheetService**: 技術者のスキルシートを取得するためのインターフェース

### 4.3 共通機能モジュール

- **AuthenticationService**: ユーザー認証を行うためのインターフェース
- **AuthorizationService**: ユーザー権限管理を行うためのインターフェース
- **FileStorageService**: ファイルの保存と取得を行うためのインターフェース
- **NotificationService**: ユーザーへの通知を行うためのインターフェース

## 5. イベント

マッチングモジュールが発行および購読するイベントを定義します。

### 5.1 発行イベント

- **MatchingCreatedEvent**: マッチング結果作成時に発行されるイベント
- **MatchingStatusChangedEvent**: マッチング結果のステータス変更時に発行されるイベント
- **ProposalCreatedEvent**: 提案作成時に発行されるイベント
- **ProposalStatusChangedEvent**: 提案のステータス変更時に発行されるイベント
- **ProposalApprovedEvent**: 提案承認時に発行されるイベント

### 5.2 購読イベント

- **ProjectRegisteredEvent**: 案件登録時のイベント（案件管理モジュールから）
- **ProjectStatusChangedEvent**: 案件ステータス変更時のイベント（案件管理モジュールから）
- **EngineerRegisteredEvent**: 技術者登録時のイベント（技術者管理モジュールから）
- **EngineerSkillsUpdatedEvent**: 技術者スキル更新時のイベント（技術者管理モジュールから）
- **AvailabilityChangedEvent**: 技術者稼働状況変更時のイベント（技術者管理モジュールから）

## 6. 非機能要件

### 6.1 パフォーマンス要件

- マッチング検索：平均応答時間3秒以内、最大5秒
- マッチング結果管理操作：平均応答時間500ms以内
- 提案書生成：平均応答時間5秒以内
- 大規模マッチング処理：1000件の技術者と100件の案件の組み合わせを5秒以内
- 同時アクセスユーザー：最大50ユーザー

### 6.2 セキュリティ要件

- 認証：すべてのAPIアクセスでJWTによるトークン認証
- 認可：役割ベースのアクセス制御（RBAC）
- データアクセス制御：部署別のデータ分離
- 機密情報保護：単価情報など機密データの閲覧制限
- 監査：主要操作の監査ログ記録

### 6.3 可用性・耐障害性

- 稼働時間：平日9:00-18:00は99.9%以上の可用性
- タイムアウト処理：大規模マッチング処理の制御
- 障害時復旧：RTO 2時間以内、RPO 5分以内
- リトライ機能：外部サービス接続の自動リトライ