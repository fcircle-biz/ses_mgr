# 認証認可機能 概要

## 1. 目的

認証認可機能は、SES業務システムにおけるセキュリティの基盤を提供するモジュールです。本モジュールの目的は以下の通りです：

- 正規のユーザーのみがシステムにアクセスできるようにする
- ユーザーの権限に応じたリソースアクセス制御を実現する
- セキュリティに関する一貫したポリシーを全システムに適用する
- 監査証跡を提供し、セキュリティイベントの追跡を可能にする

## 2. 機能範囲

### 2.1 認証機能

- ユーザー認証（ID/パスワード）
- JWT（JSON Web Token）によるステートレスセッション管理
- 多要素認証（MFA）
- パスワード管理（リセット、期限切れ、強度ポリシー適用）
- アカウントロック管理
- ログイン/ログアウト処理

### 2.2 認可機能

- ロールベースアクセス制御（RBAC）
- 属性ベースアクセス制御（ABAC）
- APIレベルの認可
- 画面レベルの認可
- データレベルの認可
- 権限管理

### 2.3 ユーザー管理機能

- ユーザーアカウント管理
- ロール・権限付与
- ユーザープロファイル管理

## 3. システム内の位置づけ

認証認可機能は、システム内の他のすべてのモジュールから利用される共通基盤機能です。認証・認可はシステムのセキュリティ上の最初の防御線として機能し、以下のように位置づけられます：

- 全APIリクエストの認証・認可を担当
- 全画面アクセスの認証・認可を担当
- データアクセス時の権限チェックを提供
- ユーザー情報を全モジュールに提供

## 4. ユースケース

### 4.1 ユーザー認証

1. ユーザーがログイン画面を表示
2. ユーザーID・パスワードを入力
3. 資格情報の検証
4. 必要に応じて多要素認証を実施
5. 成功時：JWTトークン発行、ユーザーをシステムにリダイレクト
6. 失敗時：エラーメッセージを表示、ログイン失敗カウントを増加

### 4.2 アクセス制御

1. ユーザーが保護されたリソースにアクセス
2. システムがユーザーの認証状態を確認
3. ユーザーのロールと権限を取得
4. リソースに対するアクセス権を評価
5. 許可：リソースへのアクセスを提供
6. 拒否：アクセス拒否メッセージを表示、監査ログに記録

### 4.3 パスワードリセット

1. ユーザーがパスワードリセットをリクエスト
2. システムが登録メールアドレスに一時トークンを送信
3. ユーザーがメールのリンクをクリック
4. 新しいパスワード入力画面を表示
5. パスワードポリシーに基づく検証
6. 成功時：新しいパスワードをハッシュ化して保存、ログイン画面にリダイレクト

### 4.4 ユーザー・ロール管理

1. 管理者がユーザー管理画面にアクセス
2. ユーザーの作成・編集・無効化
3. ユーザーへのロール割り当て
4. ロールの作成・編集・削除
5. ロールへの権限割り当て

## 5. 外部システム連携

- メール送信サービス：パスワードリセットなどの通知送信
- 監査ログサービス：セキュリティイベントの記録
- 通知サービス：アカウントロックなどの通知