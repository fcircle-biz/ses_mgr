# 軽量モジュール詳細設計ドキュメント分割方針

## 1. 目的

本方針は、SES業務システムの詳細設計ドキュメントにおけるモジュール設計の効率的な文書化と細分化について定義します。以下のメリットを実現します：

- ドキュメントの肥大化防止
- メンテナンス性の向上
- 並行作業の効率化
- レビュー・更新の容易性確保
- 変更影響範囲の最小化
- インターフェース定義による結合整合性の確保

## 2. ドキュメント分割ガイドライン

### 2.1 基本的な分割単位

各業務モジュールの詳細設計ドキュメントは、以下の観点で分割します：

1. **機能別分割**：モジュール内の主要な機能単位ごとに分割
2. **レイヤー別分割**：必要に応じて、ドメインモデル、サービス、インターフェース等を分離
3. **サイズ制限**：一つのマークダウンファイルは500行程度を目安に制限

### 2.2 標準的なファイル構成

各モジュールのドキュメントは、以下の標準ファイル構成に従います：

- `README.md`：モジュール概要と索引（必須）
- `01_概要.md`：モジュールの目的、主要機能、ユースケース（必須）
- `02_ドメインモデル.md`：エンティティ定義、値オブジェクト（必須）
- `03_インターフェース定義.md`：モジュールが提供/利用するインターフェース仕様（必須）
- `04_機能A.md`〜`0N_機能X.md`：個別機能の定義（必要に応じて作成）
- `DB設計.md`：データベース設計、テーブル定義（オプション）
- `API設計.md`：API仕様、エンドポイント定義（オプション）
- `テスト計画.md`：テスト方針、テストケース（オプション）

### 2.3 ドキュメント内容ガイドライン

各ドキュメントは以下の内容を簡潔に記述します：

1. **概要.md**
   - 目的と責務
   - 主要機能
   - システム内の位置づけ
   - ユースケース一覧
   - 外部システム連携

2. **ドメインモデル.md**
   - エンティティ定義（属性、バリデーションルール、ビジネスルール）
   - 値オブジェクト定義
   - 列挙型定義
   - ドメイン関連図（テキストベース）
   - 重要なビジネスルール

3. **インターフェース定義.md**
   - 提供インターフェース（サービス、API等）
   - 要求インターフェース（外部依存）
   - データ交換モデル
   - 非機能要件（パフォーマンス、トランザクション等）

4. **機能別ドキュメント**
   - 機能概要
   - 処理フロー（テキストベース）
   - 主要コンポーネント構成
   - 例外処理

## 3. インターフェース定義ガイドライン

### 3.1 インターフェース定義のポイント

各モジュール間の結合整合性を確保するため、明確なインターフェース定義を行います：

1. **明確な責務境界**：各インターフェースの責務範囲を明確にする
2. **依存関係の明示**：モジュール間の依存関係を明示的に記述する
3. **公開APIの最小化**：必要最小限のインターフェースのみを公開する
4. **抽象度の適切な設定**：適切な抽象度でインターフェースを定義する
5. **バージョニングへの考慮**：将来的な変更に対応できるインターフェース設計を行う

### 3.2 インターフェース定義の構成要素

インターフェース定義ドキュメントには、以下の要素を含めます：

1. **インターフェース概要**：目的、責務、使用コンテキスト
2. **提供インターフェース**：他モジュールに提供する機能
   - メソッド名
   - 入力パラメータ（型、制約）
   - 戻り値（型）
   - 例外
3. **要求インターフェース**：他モジュールから利用する機能
   - 利用するモジュール/インターフェース
   - 使用目的と文脈
   - 依存度
4. **データ交換モデル**：やり取りされるデータ構造
5. **非機能要件**：パフォーマンス、トランザクション、セキュリティ要件

## 4. ドキュメント記述のポイント

### 4.1 簡潔性

- 冗長な説明を避け、必要な情報のみを記載
- 長いコード例は避け、擬似コードまたは簡略化されたサンプルのみ使用
- 図解は文字ベースの表現（ASCII図など）で簡潔に

### 4.2 明確さ

- 曖昧な表現を避け、具体的な記述を心がける
- 専門用語は初出時に簡単な説明を付ける
- 箇条書きを積極的に活用する

### 4.3 整合性

- 用語の統一（用語集を参照）
- 命名規則の一貫性
- 他のドキュメントとの参照関係の明確化

## 5. READMEファイルのテンプレート

各モジュールのルートディレクトリには以下の構成のREADME.mdを配置します：

```markdown
# {モジュール名} 詳細設計

## 概要
{モジュールの簡潔な説明（3-5行）}

## ドキュメント構成

| ドキュメント | 内容 | 最終更新日 |
|------------|------|----------|
| [01_概要](./01_概要.md) | モジュールの目的、主要機能、アーキテクチャ | YYYY-MM-DD |
| [02_ドメインモデル](./02_ドメインモデル.md) | エンティティ定義、値オブジェクト | YYYY-MM-DD |
| [03_インターフェース定義](./03_インターフェース定義.md) | モジュールが提供/利用するインターフェース仕様 | YYYY-MM-DD |
| [04_機能A](./04_機能A.md) | 機能Aの詳細設計 | YYYY-MM-DD |
| ... | ... | ... |

## 提供インターフェース一覧

| インターフェース名 | 概要 | 利用モジュール |
|-----------------|------|--------------|
| XXXService | XXXに関する操作を提供 | モジュールA, モジュールB |
| YYYQuery | YYY情報の検索を提供 | モジュールC |

## 要求インターフェース一覧

| インターフェース名 | 提供モジュール | 概要 |
|-----------------|--------------|------|
| AAAService | モジュールD | AAAに関する操作を利用 |
| BBBQuery | モジュールE | BBB情報の検索を利用 |

## 関連モジュール

- [モジュールA](../モジュールA/)
- [モジュールB](../モジュールB/)

## 変更履歴

| 日付 | 変更者 | 内容 |
|------|-------|------|
| YYYY-MM-DD | XX | 初版作成 |
```

## 6. ドキュメント間の参照ルール

1. **相対パスの使用**：モジュール内の他ドキュメントを参照する際は相対パスを使用
2. **アンカーリンク**：同一ドキュメント内の参照はアンカーリンク（`#セクション名`）を使用
3. **重複の回避**：詳細情報は1箇所にのみ記述し、他の場所からは参照する形式を採用
4. **インターフェース参照**：インターフェースを参照する場合は `モジュール名.インターフェース名` の形式を使用

## 7. 効率的な記述のための注意事項

### 7.1 実装コードの扱い

- **実装コードの排除**：詳細設計ドキュメントには実際の実装コードを記載しないでください
- **擬似コード**：必要な場合は擬似コードで表現し、実装言語の具体的な構文は避ける
- **フローチャート**：複雑なロジックは簡略化されたフローチャートまたは文章で表現
- **インターフェース記述のみ**：実装詳細ではなく、インターフェース仕様、メソッドシグネチャ、データモデルの構造に焦点を当てる
- **アルゴリズム説明**：コードではなく、処理フローや条件分岐を文章で説明する

### 7.2 図表の簡略化

- 複雑な図表はUMLクラス図の簡略版（主要クラスのみ）を使用
- テキストベースの表現（ASCII図、マークダウンテーブル）を優先
- 画像の埋め込みは必要最小限にする

## 8. メンテナンスポリシー

1. **更新履歴**：各ファイルの冒頭にバージョン管理テーブルを配置し、変更履歴を記録
2. **一貫性維持**：モジュール間で影響のある変更は、関連するすべてのドキュメントを同時に更新
3. **最新性確認**：四半期ごとに全ドキュメントの内容を確認し、最新状態を維持

## 9. 移行計画

既存の大規模なモジュール設計ドキュメントは、以下の手順で分割を進めます：

1. インデックスファイル（README.md）の作成
2. ドメインモデル、概要部分の抽出
3. インターフェース定義ドキュメントの作成
4. 機能単位での分割
5. 相互参照リンクの整備
6. 元のファイルの廃止

各モジュールの分割は2025年5月末までに完了させる計画です。