# SES業務システム 基本設計ドキュメント作成手順

## 1. 概要

本文書は、SES業務システムの基本設計フェーズで作成すべきドキュメントとその作成手順について記載しています。基本設計フェーズでは、要件定義をもとに、システムの全体構成、機能仕様、画面、データベース、外部インターフェースなどの設計を行います。

## 2. 基本設計フェーズの目的

- 要件定義で決定した機能要件・非機能要件を技術的に実現するための設計を行う
- システム開発の基盤となる「設計書」を作成する
- 詳細設計・開発フェーズでのリスクを低減するための設計判断を行う
- 設計上の課題や制約を明確にし、対策を示す

## 3. 基本設計ドキュメント構成

基本設計フェーズでは、以下のドキュメントを作成します：

### 3.1 システム設計書

- **ファイル形式**: HTML
- **命名規則**: 機能ごとに分割したセクションファイル（`01_はじめに.html`, `02_システム概要.html`など）
- **保存場所**: `/docs/02_基本設計/システム設計/`
- **内容**:
  - システム全体構成図
  - マイクロサービス構成
  - サブシステム構成
  - デプロイメント図
  - ネットワーク構成図
  - サーバー構成（仮想/物理）
  - セキュリティ設計
  - 性能設計
  - 可用性設計（冗長構成など）
  - バックアップ設計
  - バッチ処理一覧
  - 権限設計
  - エラー処理設計
  - ログ設計

### 3.2 UI設計書

- **ファイル形式**: HTML + モックアップファイル
- **命名規則**: 機能モジュールごとに分割（`システム管理画面設計.html`, `案件管理画面設計.html`など）
- **保存場所**: `/docs/02_基本設計/UI設計/`
- **内容**:
  - 画面構成図（画面遷移図）
  - 画面一覧
  - 各画面のワイヤーフレーム/モックアップ
  - 画面項目定義
  - 入力チェック仕様
  - ボタンアクション定義
  - レスポンシブ対応指針
  - 共通部品定義

### 3.3 DB設計書

- **ファイル形式**: HTML + ER図（drawio）
- **命名規則**: 機能モジュールごとに分割（`案件管理_ER図.drawio`, `技術者管理_テーブル定義書.html`など）
- **保存場所**: `/docs/02_基本設計/DB設計/`
- **内容**:
  - ER図（論理/物理）
  - テーブル一覧
  - テーブル定義
  - カラム定義（型、制約、デフォルト値など）
  - インデックス設計
  - リレーション設計
  - トランザクション設計
  - パーティション設計
  - マスタデータ設計

### 3.4 インターフェース設計書

- **ファイル形式**: HTML + Swagger/OpenAPI仕様書
- **命名規則**: 機能モジュールごとに分割（`共通API.html`, `案件管理API.html`など）と細分化されたAPIファイル
- **保存場所**: `/docs/02_基本設計/IF設計/`
- **内容**:
  - 外部連携システム一覧
  - API一覧
  - API仕様（エンドポイント、パラメータ、レスポンスなど）
  - 認証・認可方式
  - データフォーマット定義
  - エラーハンドリング
  - タイムアウト設定
  - 通信プロトコル設定

### 3.5 共通機能設計書

- **ファイル形式**: HTML
- **命名規則**: 機能ごとに個別ファイル（`認証認可機能設計.html`, `検索機能設計.html`など）
- **内容分割**: 大規模な設計書は論理的なセクションごとに分割（例：`ファイル管理機能設計_01_概要とアーキテクチャ.html`, `ファイル管理機能設計_02_データモデル.html`など）
- **保存場所**: `/docs/02_基本設計/共通機能/`
- **内容**: 以下の機能それぞれについて個別の設計書を作成
  - 認証・認可機能
  - ユーザー管理機能
  - ロギング機能
  - エラー処理機能
  - コード値管理機能
  - 検索機能
  - 通知機能
  - ファイル管理機能
  - 国際化機能
  - トランザクション管理機能

## 4. 作成手順

基本設計ドキュメントの作成手順は以下の通りです：

### 4.1 準備作業

1. Git リポジトリから最新の情報を取得
   ```bash
   git pull origin main
   ```

2. 必要に応じて基本設計フォルダ構成を作成（既存の場合は不要）
   ```bash
   mkdir -p docs/02_基本設計/{システム設計,UI設計,DB設計,IF設計,共通機能}
   ```

3. 作業ブランチを作成
   ```bash
   git checkout -b feature/basic-design-[機能名]
   ```

### 4.2 設計作業の実施順序

1. **システム設計**
   - 全体アーキテクチャの検討
   - マイクロサービス分割の検討
   - デプロイメントモデルの検討
   - 技術選定の詳細化

2. **DB設計**
   - ER図の詳細化（既存ER図をベースに）
   - テーブル定義の作成
   - インデックス検討
   - マスタデータ設計

3. **UI設計**
   - 画面遷移図の作成
   - 主要画面のワイヤーフレーム作成
   - 詳細画面設計
   - モックアップ作成

4. **インターフェース設計**
   - API設計（Swagger/OpenAPI形式）
   - 外部連携方式の詳細化
   - データフォーマット定義

5. **共通機能設計**
   - 認証・認可設計
   - 共通部品設計
   - エラー処理設計
   - 国際化設計

### 4.3 レビュー手順

1. **ドキュメント作成者によるセルフレビュー**
   - 記述内容の正確性確認
   - 要件定義との整合性確認
   - 他の設計ドキュメントとの整合性確認
   - 技術的な実現可能性の確認

2. **チームレビュー（週次）**
   - レビュー対象ドキュメントを事前に共有（少なくともレビューの2営業日前まで）
   - レビュー観点：
     - 技術的な妥当性
     - 要件との適合性
     - ドキュメント品質（明確さ、網羅性）
     - 設計上のリスク
   - レビュー結果はPRコメントまたはレビュー議事録として記録

3. **ステークホルダーレビュー（隔週）**
   - チームレビューを通過したドキュメントを対象
   - ビジネス要件との整合性
   - 運用面での実現可能性
   - 将来の拡張性への対応

4. **レビュー指摘事項の修正**
   - 指摘事項ごとに対応状況を記録
   - 修正難易度の高い指摘事項は検討課題として記録し、対応方針を決定

5. **承認プロセス**
   - チームリードによる最終確認
   - 必要に応じてアーキテクトによる技術的確認
   - プロジェクトマネージャによる承認

### 4.4 バージョン管理

- 設計書はGitでバージョン管理
- 変更履歴を各ドキュメントの先頭または末尾に記載
- コミットメッセージには変更内容を明記
  ```bash
  git add docs/02_基本設計/システム設計/03_システムアーキテクチャ.html
  git commit -m "システム設計：マイクロサービスアーキテクチャ図を更新"
  git push origin feature/basic-design-architecture
  ```
- Pull Requestを作成してレビューを依頼
  ```bash
  # GitHub CLIを使用する場合
  gh pr create --title "システム設計：アーキテクチャ設計書の追加" --body "マイクロサービスアーキテクチャの設計書を追加しました。レビューをお願いします。"
  ```

## 5. 基本設計のポイント

### 5.1 技術スタックに関する考慮点

- **バックエンド**
  - Java 21 LTS
  - Spring Boot 3.2.x
    - Spring MVC: Webアプリケーションフレームワーク
    - Spring Data JDBC: データアクセス層
    - Spring Security: 認証・認可（JWT採用）
    - Spring Validation: バリデーション
    - Spring Cache: キャッシュ抽象化
    - Spring Actuator: 運用監視
    - Spring AOP: アスペクト指向プログラミング
  - QueryDSL: 型安全なクエリビルダー
  - Flyway: データベースマイグレーション

- **フロントエンド**
  - Thymeleaf 3.x: サーバーサイドテンプレートエンジン
  - Bootstrap 5.x: レスポンシブUIフレームワーク
  - jQuery 3.x: DOM操作とAjax
  - Chart.js: データ可視化

- **データストア**
  - PostgreSQL 17: メインデータベース
    - データ型の最適化
    - インデックス戦略
    - パーティショニング設計
  - Redis 6.x: キャッシュ
  - MinIO: S3互換オブジェクトストレージ
  - Elasticsearch: 全文検索（必要に応じて）

- **インフラストラクチャ**
  - Apache Tomcat: Spring Boot組み込みサーバー
  - Docker: アプリケーションコンテナ化
  - GitHub Actions: CI/CD
  - 監視・ロギング
    - Prometheus: メトリクス収集
    - Grafana: 可視化
    - ELK Stack: ログ管理

### 5.2 モノリシックアーキテクチャ設計のポイント

- **モジュール分割の原則**
  - ビジネスケイパビリティに基づく論理的分割
  - モジュール間の責務と境界の明確化
  - チーム構造に合わせた責務分担

- **モジュール間連携方式**
  - Spring DIを用いたコンポーネント間の直接呼び出し
  - Spring ApplicationEventを使用したイベント駆動連携
  - 共有データモデルによる情報共有

- **データ管理戦略**
  - 単一データベース内での適切なスキーマ設計
  - トランザクションの一貫性確保
  - リポジトリパターンによるデータアクセス層の抽象化
  - 必要に応じたCQRS(コマンドクエリ責務分離)パターンの適用

- **障害対策**
  - 例外ハンドリングの統一
  - リトライ・タイムアウト戦略
  - フォールバック処理
  - 監視・アラート体制の確立

### 5.3 セキュリティ設計のポイント

- **認証・認可**
  - OAuth2.0/OpenID Connect の実装
  - JWTトークン設計（クレーム、有効期限）
  - RBAC（ロールベースアクセス制御）
  - ABAC（属性ベースアクセス制御）

- **データ保護**
  - 機密データの暗号化（保存時・転送時）
  - 個人情報の取り扱い（仮名化、最小化）
  - データマスキング戦略

- **脆弱性対策**
  - OWASP Top 10 への対応（入力検証、XSS対策など）
  - セキュアコーディング規約
  - 脆弱性スキャン・静的解析の導入

- **監査・ログ**
  - セキュリティ関連操作の監査ログ
  - 不正アクセス検知
  - インシデント対応プロセス

## 6. 成果物チェックリスト

基本設計フェーズ完了時に以下の成果物が揃っていることを確認：

- [ ] システム設計書（全セクション）
- [ ] UI設計書（全機能モジュール分）
- [ ] 画面ワイヤーフレーム/モックアップ
- [ ] DB設計書（ER図と全テーブル定義書）
- [ ] インターフェース設計書（全API仕様）
- [ ] 共通機能設計書（全機能分）
- [ ] レビュー議事録
- [ ] 指摘事項対応表
- [ ] 設計上の検討課題・制約リスト
- [ ] 実装時の考慮事項リスト

## 7. 注意事項

- 要件定義書との整合性を常に確認すること
- 技術的な制約や課題が発見された場合は、対応方針を明確にし、必要に応じて要件との調整を行うこと
- 詳細設計・開発工程を意識し、実装可能な設計とすること
- 技術負債となる設計は避け、保守性・拡張性を重視すること
- セキュリティ要件を満たす設計を徹底すること

### 7.1 ドキュメントの細分化ガイドライン

基本設計ドキュメントは適切に細分化し、管理しやすくすることが重要です：

- **機能別の分割**：
  - 各業務領域（案件管理、技術者管理など）ごとに設計ドキュメントを分割
  - 各業務領域内でさらに、UI設計、DB設計、API設計などを分割
  - REST API設計はさらにサブ機能ごとに細分化（例：技術者管理API → 技術者基本API、スキル管理APIなど）

- **ドキュメントサイズの制限**：
  - 1つのHTMLドキュメントファイルは2000行以内を目安にする
  - 1つのMarkdownドキュメントファイルは1000行以内を目安にする
  - ER図は機能領域ごとに分割し、全体を俯瞰する概念ERと詳細ERに分ける
  - API仕様書は、概要ドキュメントと詳細仕様ドキュメントに分ける

- **標準化と参照の仕組み**：
  - インデックスファイル（index.html）を作成し、関連ドキュメント間をリンクで繋ぐ
  - 共通部分は別ファイルにし、参照する形にする
  - 命名規則を統一し、ファイル名からコンテンツを推測できるようにする
  - 同一カテゴリのドキュメントは番号プレフィックスで順序付けする（例：01_はじめに.html, 02_システム概要.html）

このような細分化により、チームメンバーによる並行作業が容易になり、レビュー効率が向上し、変更影響範囲が限定されます。また、ドキュメントの読み込み・編集時のパフォーマンスも向上します。

### 7.2 ドキュメント品質基準

すべての基本設計ドキュメントは以下の品質基準を満たす必要があります：

- **明確性**：
  - 曖昧な表現を避け、具体的かつ明確な記述をする
  - 図表を効果的に活用して複雑な概念を説明する
  - 専門用語には必要に応じて説明を付ける

- **一貫性**：
  - ドキュメント間で用語や表記方法を統一する
  - 設計方針や設計判断が一貫していることを確認する
  - 関連するドキュメント間で矛盾がないことを確認する

- **網羅性**：
  - 要件定義書で定義されたすべての機能要件・非機能要件をカバーする
  - 例外ケースや代替フローも考慮する
  - 設計上の前提条件や制約条件を明記する

- **追跡可能性**：
  - 要件からの追跡性を確保する（要件ID等の参照）
  - 設計判断の根拠を記録する
  - 保留事項や検討課題を明確に識別する

## 8. 基本設計プロセスの進捗管理

### 8.1 進捗測定方法

- **ドキュメント作成状況の可視化**：
  - 各設計ドキュメントの作成状況をステータス管理（未着手/作成中/レビュー中/完了）
  - GitHub Projectsを活用した進捗管理
  - 週次のステータスレポート作成

- **マイルストーン管理**：
  - システム設計書完了
  - DB設計書完了
  - UI設計書完了
  - インターフェース設計書完了
  - 共通機能設計書完了
  - 全体レビュー完了
  - 基本設計書確定

- **品質メトリクス**：
  - レビュー指摘件数と解決率
  - 設計変更の発生頻度
  - 要件カバレッジ率

### 8.2 リスク管理

- **リスク識別**：
  - 設計上の技術的リスク
  - スケジュールリスク
  - リソース不足リスク
  - 要件変更リスク

- **リスク評価**：
  - 影響度（高/中/低）
  - 発生確率（高/中/低）
  - 優先度（影響度×発生確率）

- **リスク対応**：
  - リスク回避策
  - リスク軽減策
  - コンティンジェンシープラン

## 9. 参考資料

- [Spring Framework Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/)
- [React Documentation](https://reactjs.org/docs/getting-started.html)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Kubernetes Documentation](https://kubernetes.io/docs/home/)
- [OWASP Top Ten](https://owasp.org/www-project-top-ten/)
- [マイクロサービスパターン](https://microservices.io/patterns/index.html)