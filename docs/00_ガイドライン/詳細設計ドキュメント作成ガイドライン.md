# SES業務システム 詳細設計ドキュメント作成手順

## 1. 概要

本文書は、SES業務システムの詳細設計フェーズで作成すべきドキュメントとその作成手順について記載しています。詳細設計フェーズでは、基本設計をもとに、実装レベルの詳細な設計を行います。プログラム構造、クラス設計、メソッド仕様、画面レイアウト詳細、データベースの物理設計などを具体化します。

## 2. 詳細設計フェーズの目的

- 基本設計を実装可能なレベルまで詳細化する
- プログラム構造を明確にし、コーディング作業の基盤を作る
- 画面・帳票の詳細仕様を決定する
- データベースの物理設計を完成させる
- テスト仕様を明確にする
- 開発フェーズでのリスクを最小化する

## 3. 詳細設計ドキュメント構成

詳細設計フェーズでは、以下のドキュメントを作成します：

### 3.1 詳細設計書（機能別）

- **ファイル形式**: HTML
- **命名規則**: `詳細設計書_[機能名].html`（例：`詳細設計書_マッチングエンジン.html`）
- **保存場所**: `/docs/詳細設計/機能設計/`
- **内容**:
  - 機能概要
  - 処理フロー
  - クラス設計
    - クラス図
    - クラス一覧
    - クラス間の関連
  - メソッド仕様
    - メソッド一覧
    - 引数・戻り値
    - 処理内容
  - 例外処理
  - トランザクション制御
  - 処理性能に関する考慮点

### 3.2 画面詳細設計書

- **ファイル形式**: HTML + Figma詳細設計
- **命名規則**: `画面詳細設計書_[機能名].html`
- **保存場所**: `/docs/詳細設計/画面設計/`
- **内容**:
  - 画面レイアウト詳細
  - コンポーネント仕様
  - 入力項目定義
    - 入力チェックルール
    - 初期値
    - 表示条件
  - ボタンアクション詳細
  - 画面遷移条件
  - エラーメッセージ
  - レスポンシブ対応仕様

### 3.3 API詳細設計書

- **ファイル形式**: HTML + Swagger/OpenAPI詳細仕様
- **命名規則**: `API詳細設計書_[モジュール名].html`
- **保存場所**: `/docs/詳細設計/API設計/`
- **内容**:
  - API一覧
  - エンドポイント詳細
  - リクエストパラメータ詳細
  - レスポンス詳細
    - 正常系レスポンス
    - エラー系レスポンス
  - 認証・認可詳細
  - レート制限
  - エラーハンドリング
  - サンプルコード

### 3.4 データベース物理設計書

- **ファイル形式**: HTML
- **命名規則**: `DB物理設計書.html`
- **保存場所**: `/docs/詳細設計/DB設計/`
- **内容**:
  - テーブル物理設計
    - テーブル名（物理名）
    - カラム定義（物理名、データ型、制約）
    - インデックス定義
    - パーティション設計
  - シーケンス定義
  - ビュー定義
  - ストアドプロシージャ/関数定義
  - トリガー定義
  - 初期データ設計
  - データ移行計画

### 3.5 テスト仕様書

- **ファイル形式**: HTML
- **命名規則**: `テスト仕様書_[テスト種別].html`（例：`テスト仕様書_単体テスト.html`）
- **保存場所**: `/docs/詳細設計/テスト仕様/`
- **内容**:
  - テスト方針
  - テスト環境
  - テスト項目一覧
  - テストケース
    - 前提条件
    - 入力値
    - 期待結果
    - 確認ポイント
  - 自動テスト仕様
  - 性能テスト仕様
  - セキュリティテスト仕様

### 3.6 セキュリティ実装仕様書

- **ファイル形式**: HTML
- **命名規則**: `セキュリティ実装仕様書.html`
- **保存場所**: `/docs/詳細設計/セキュリティ/`
- **内容**:
  - 認証・認可の実装詳細
  - パスワードポリシーと実装
  - セッション管理
  - CSRF対策
  - XSS対策
  - SQLインジェクション対策
  - ログ出力とセキュリティ監査
  - 暗号化実装詳細
  - 脆弱性対策チェックリスト

## 4. 作成手順

詳細設計ドキュメントの作成手順は以下の通りです：

### 4.1 準備作業

1. Git リポジトリから最新の情報を取得
   ```bash
   git pull origin main
   ```

2. 詳細設計フォルダ構成を作成
   ```bash
   mkdir -p docs/詳細設計/{機能設計,画面設計,API設計,DB設計,テスト仕様,セキュリティ}
   ```

3. 基本設計ドキュメントのレビュー
   - 基本設計の内容を十分に理解
   - 不明点や曖昧な点の洗い出し
   - 必要に応じて基本設計の修正提案

### 4.2 設計作業の実施順序

1. **データベース物理設計**（1週目）
   - 基本設計のER図から物理モデルへの変換
   - テーブル・カラムの物理名決定
   - インデックス詳細設計
   - 制約の詳細設計

2. **機能別詳細設計**（2-3週目）
   - クラス設計
   - シーケンス図作成
   - メソッド仕様の詳細化
   - 処理フローの詳細化

3. **画面詳細設計**（2-3週目、機能設計と並行）
   - 画面レイアウトの詳細化
   - 入力チェックルールの詳細設定
   - 画面遷移の詳細設計

4. **API詳細設計**（3-4週目）
   - API仕様の詳細化
   - リクエスト/レスポンスの詳細設計
   - エラーハンドリングの詳細設計

5. **セキュリティ実装仕様**（4週目）
   - 認証・認可の詳細設計
   - セキュリティ対策の詳細化

6. **テスト仕様作成**（5週目）
   - テスト方針の明確化
   - テストケースの作成
   - 自動テスト仕様の作成

### 4.3 レビュー手順

1. 各設計書作成後、担当者による内部レビュー
2. チームレビュー（機能グループごと）
3. テクニカルレビュー（技術的観点からのレビュー）
4. クロスチェック（他機能との整合性確認）
5. レビュー指摘事項の修正

### 4.4 バージョン管理

- 設計書はGitでバージョン管理
- 変更履歴を各ドキュメントの先頭に記載
- コミットメッセージには変更内容を明記
  ```bash
  git add docs/詳細設計/機能設計/詳細設計書_マッチングエンジン.html
  git commit -m "マッチングエンジン：クラス設計の詳細化"
  git push origin feature/detailed-design
  ```

## 5. 詳細設計のポイント

### 5.1 Java Spring Bootでの実装を考慮した設計

- **Spring MVCの活用**
  - コントローラー設計
  - サービスレイヤー設計
  - リポジトリレイヤー設計
  - DTOとエンティティの設計

- **Spring Securityの詳細設計**
  - 認証方式の詳細
  - 権限管理の詳細
  - セキュリティフィルターの設定

- **Spring Data JDBCの活用**
  - エンティティの設計
  - リポジトリインターフェースの設計
  - クエリメソッドとSQLの設計
  - Aggregate Rootパターンの適用

- **例外処理方針**
  - 例外クラス階層
  - @ControllerAdviceの活用
  - グローバル例外ハンドラーの設計

### 5.2 Thymeleafでの画面実装を考慮した設計

- **テンプレートレイアウト**
  - 共通レイアウトの設計
  - フラグメント設計
  - テンプレート継承の活用

- **Thymeleaf式と属性**
  - 変数式の使用方針
  - 条件分岐の実装詳細
  - 繰り返し処理の実装詳細
  - リンク生成の方法

- **フォーム処理**
  - バインディング仕様
  - バリデーション実装詳細
  - エラーメッセージ表示方法

- **国際化対応**
  - メッセージプロパティの設計
  - 地域別設定の方法

### 5.3 PostgreSQLの最適化を考慮した設計

- **インデックス戦略**
  - 適切なインデックスタイプの選定
  - 複合インデックスの設計
  - インデックスの運用方針

- **パーティショニング設計**
  - パーティション方式の選定
  - パーティションキーの設計
  - パーティション運用方針

- **パフォーマンスチューニング**
  - クエリ最適化の方針
  - 実行計画分析の活用方法
  - 大量データ処理の設計

- **バックアップ・リカバリ設計**
  - バックアップ方式の詳細
  - ポイントインタイムリカバリの設計

### 5.4 Dockerを活用した環境設計

- **コンテナ構成の詳細**
  - サービス単位のコンテナ設計
  - ネットワーク設定
  - ボリューム設計

- **Docker Compose設定**
  - 各サービスの設定詳細
  - 環境変数管理
  - ヘルスチェック設定

- **開発・テスト・本番環境の分離**
  - 環境ごとの設定差異
  - 環境変数の管理方法
  - シークレット管理

## 6. 成果物チェックリスト

詳細設計フェーズ完了時に以下の成果物が揃っていることを確認：

- [ ] 機能別詳細設計書
- [ ] 画面詳細設計書
- [ ] API詳細設計書
- [ ] データベース物理設計書
- [ ] テスト仕様書
- [ ] セキュリティ実装仕様書
- [ ] レビュー議事録
- [ ] 指摘事項対応表

## 7. 注意事項

- 実装者がスムーズに開発できるよう、十分な詳細を記載すること
- 曖昧な表現を避け、明確かつ具体的に記述すること
- 基本設計との整合性を常に確認すること
- 特に考慮すべき非機能要件（性能、セキュリティなど）を意識した設計とすること
- 技術的な制約や課題が見つかった場合は早期に報告し、対応方針を明確にすること
- アーキテクチャの一貫性を保つよう設計すること
- 将来の保守性・拡張性を意識した設計とすること

### 7.1 ドキュメントの細分化ガイドライン

詳細設計ドキュメントは以下のガイドラインに従って細分化してください：

- **機能単位の徹底的な分割**：
  - 各マイクロサービスや機能モジュールごとに詳細設計書を作成
  - クラス設計は機能単位（ユースケース単位）で分割
  - 画面設計は画面単位で分割し、複雑な画面はさらにコンポーネント単位で分割
  - API設計はエンドポイント群ごとに分割

- **サイズ制限の厳守**：
  - 詳細設計ドキュメントは1ファイルあたり1500行以内に収める
  - 一つのクラス設計書は最大10クラスまでとする
  - 一つのAPIドキュメントは最大10エンドポイントまでとする
  - UML図は複雑さに応じて分割し、一つの図に含める要素数を制限する

- **構造化と一貫性**：
  - 詳細設計書の構造を標準化し、全ての詳細設計書で同じ構造を採用
  - インデックスファイルを作成し、関連ドキュメント間の参照関係を明示
  - 変更影響範囲を最小化するため、独立性の高い単位でファイルを分割
  - 共通コンポーネントやユーティリティは独立したドキュメントとして作成

- **相互参照とトレーサビリティ**：
  - 基本設計書との対応関係を明記
  - 関連する他の詳細設計書へのリンクを設定
  - 要件定義書の項目とのトレーサビリティを確保

この細分化アプローチにより、並行開発、効率的なレビュー、変更管理の容易さ、ドキュメント更新の負担軽減を実現します。また、特定の実装に関する詳細を探しやすくなり、開発者の生産性向上にも貢献します。

## 8. Java Spring Boot技術スタック詳細設計ガイドライン

Spring Bootを使用した実装において、以下の点に特に注意して詳細設計を行うことを推奨します：

### 8.1 レイヤードアーキテクチャの詳細設計

```
[クライアント] → [Controllerレイヤー] → [Serviceレイヤー] → [Repositoryレイヤー] → [データベース]
```

- **Controllerレイヤー**
  - REST APIエンドポイント設計
  - リクエストパラメータのバリデーション
  - DTOからドメインモデルへの変換
  - レスポンス形式の標準化

- **Serviceレイヤー**
  - ビジネスロジックの実装
  - トランザクション境界の設定
  - 例外ハンドリング方針
  - 他サービスとの連携

- **Repositoryレイヤー**
  - Spring Data JDBCリポジトリの設計
  - クエリメソッドの命名規則
  - @Query アノテーションを使用したSQLの実装方針
  - リレーションシップマッピングの実装
  - 性能を考慮したクエリ設計

### 8.2 セキュリティ実装の詳細設計

- **認証方式**
  - Form認証 vs OAuth2/OIDC
  - JWTの使用方針と実装詳細
  - セッション管理の詳細設計

- **認可方式**
  - ロールベースアクセス制御（RBAC）の詳細
  - メソッドセキュリティの実装
  - 動的権限チェックの実装

- **セキュリティ対策**
  - CSRFトークンの実装詳細
  - XSS対策の実装方法
  - SQLインジェクション対策の実装

### 8.3 テスト実装の詳細設計

- **単体テスト**
  - JUnitとMockitoを使用したテスト設計
  - モックとスタブの使い分け
  - テストカバレッジ目標

- **統合テスト**
  - Spring Boot Testの活用方法
  - テスト用データベース設定
  - テストデータ準備方法

- **APIテスト**
  - RestAssuredを使用したテスト設計
  - テスト環境の構築方法
  - CI/CDパイプラインでの自動テスト

## 9. ドキュメントテンプレート

各詳細設計ドキュメントには、一貫性を持たせるために以下のようなセクション構成を推奨します：

```
1. 文書情報
   - 文書名
   - 作成日/更新日
   - 作成者/更新者
   - バージョン履歴

2. 概要
   - 設計対象の説明
   - 基本設計との関連性
   - 前提条件・制約条件

3. 詳細設計内容
   （ドキュメントの種類に応じた詳細）

4. 特記事項
   - 実装上の注意点
   - 懸念事項と対応策
   - 他システムとの関連

5. 参照ドキュメント
   - 関連する基本設計書
   - 参照した仕様・ガイドライン
```

これらのテンプレートを活用し、標準化された詳細設計ドキュメントを作成することで、開発チーム全体の理解を促進し、実装の効率化と品質向上を図ります。