# REST API開発のためのAI指示ガイドライン

このガイドラインは、AIアシスタントを活用してREST APIを効率的に開発するための指示方法をまとめたものです。設計書から実装までの一貫したプロセスを定義し、品質の高いREST APIを短時間で実装できるようにします。

## 1. 基本的な指示フロー

REST APIを開発する際の基本的な指示フローは以下の通りです：

1. **設計書の共有**: 実装すべきREST APIの設計書をAIに共有する
2. **実装計画の立案**: 必要なファイルとクラスの特定
3. **コア実装**: エンティティ、リポジトリ、DTOの作成
4. **ビジネスロジック実装**: サービスクラスの実装
5. **API実装**: コントローラーの作成
6. **テスト**: テストコードとスクリプトの作成
7. **検証**: 実装の一貫性とコーディング標準への準拠を確認

## 2. 詳細な指示方法

### 2.1 設計書の共有

```
以下の設計書に基づいてREST APIを実装してください：

[設計書のHTMLまたはマークダウンをここに貼り付ける]

この設計書に基づいて、APIエンドポイント、データモデル、ビジネスロジックを実装します。
```

### 2.2 実装計画の立案

```
上記の設計書に基づいて、以下の実装計画を立ててください：

1. 作成が必要なエンティティクラス
2. 作成が必要なDTOクラス
3. 作成が必要なリポジトリインターフェース
4. 作成が必要なサービスクラス
5. 作成が必要なコントローラークラス
6. テストケース

実装の順序と依存関係も示してください。
```

### 2.3 コア実装（エンティティ、リポジトリ、DTO）

```
まず、以下のコア要素を実装してください：

1. エンティティクラス：[エンティティ名]
   - 必要なフィールド
   - アノテーション
   - リレーションシップ

2. リポジトリインターフェース：[リポジトリ名]
   - 必要な検索メソッド
   - カスタムクエリ

3. DTOクラス：[DTO名]
   - リクエスト/レスポンス用のフィールド
   - 変換メソッド
```

### 2.4 ビジネスロジック実装（サービス）

```
次に、ビジネスロジックを実装するサービスクラスを作成してください：

1. サービスインターフェース：[インターフェース名]
   - 公開メソッドの定義

2. サービス実装クラス：[実装クラス名]
   - トランザクション管理
   - ビジネスルールの実装
   - エラーハンドリング
```

### 2.5 API実装（コントローラー）

```
最後に、REST APIのエンドポイントを提供するコントローラークラスを実装してください：

1. コントローラークラス：[コントローラー名]
   - 各APIエンドポイントの実装
   - リクエスト検証
   - レスポンス生成
   - 例外処理
```

### 2.6 テスト

```
APIの実装が完了したので、以下のテストを作成してください：

1. 単体テスト
   - サービスクラステスト
   - コントローラークラステスト

2. APIテストスクリプト
   - 各エンドポイント用のcurlコマンド
   - テスト用のシェルスクリプト
```

### 2.7 検証

```
実装したコードを検証して、以下の点を確認してください：

1. 設計書の要件を満たしているか
2. コーディング標準に準拠しているか
3. エラーハンドリングが適切か
4. パフォーマンス上の問題がないか
5. セキュリティ上の懸念がないか
```

## 3. 実装例：通知API

通知APIの設計書から実装までの一連の流れを示す例です。

### 3.1 設計書の共有

```
以下の通知API設計書に基づいて実装してください：

[03_通知API.html の内容]

この設計書に基づいて、通知の作成、取得、既読設定、削除などの機能を提供するAPIを実装します。
```

### 3.2 実装計画

```
通知API実装のために、以下のクラスを作成します：

1. エンティティ:
   - Notification.java - 通知エンティティ
   - NotificationType.java - 通知タイプの列挙型

2. DTO:
   - NotificationDto.java - 通知のデータ転送オブジェクト
   - NotificationListResponseDto.java - 通知一覧のレスポンス

3. リポジトリ:
   - NotificationRepository.java - 通知の永続化

4. サービス:
   - NotificationService.java - サービスインターフェース
   - NotificationServiceImpl.java - サービス実装

5. コントローラー:
   - NotificationRestController.java - REST APIコントローラー

6. テスト:
   - 単体テスト
   - APIテストスクリプト
```

### 3.3 エンティティ、DTO、リポジトリの実装

各ファイルの具体的な実装内容の例を示します。

#### 作成手順

1. NotificationType.java の作成
2. Notification.java の作成
3. NotificationDto.java の作成
4. NotificationRepository.java の作成

### 3.4 サービスの実装

通知サービスの具体的な実装内容の例を示します。

#### 作成手順

1. NotificationService.java インターフェースの作成
2. NotificationServiceImpl.java 実装クラスの作成

### 3.5 コントローラーの実装

REST APIコントローラーの具体的な実装内容の例を示します。

#### 作成手順

1. NotificationRestController.java の作成（全エンドポイント実装）

### 3.6 テストの実装

テストコードとスクリプトの例を示します。

#### 作成手順

1. NotificationServiceTest.java の作成
2. NotificationRestControllerTest.java の作成
3. notification_api_test.sh テストスクリプトの作成

## 4. 実装のベストプラクティス

### 4.1 命名規則

- **クラス名**: パスカルケース（例：`NotificationService`）
- **メソッド名**: キャメルケース（例：`getNotifications`）
- **変数名**: キャメルケース（例：`notificationList`）
- **定数名**: スネークケースの大文字（例：`MAX_NOTIFICATION_COUNT`）

### 4.2 コード構造

- **パッケージ構造**: 機能またはレイヤーごとに整理
- **クラス構造**: 関連する機能をまとめる
- **メソッド構造**: 単一責任の原則に従う

### 4.3 エラーハンドリング

- 適切な例外クラスを使用
- 意味のあるエラーメッセージ
- グローバル例外ハンドラーの使用

### 4.4 セキュリティ考慮事項

- 認証・認可の適切な実装
- 入力検証
- セキュリティヘッダーの設定

### 4.5 パフォーマンス最適化

- N+1問題の回避
- 適切なインデックス
- ページネーションの実装

## 5. ドキュメント作成

```
実装したAPIの使用方法を説明するドキュメントを作成してください。以下の内容を含めてください：

1. 各エンドポイントの概要
2. リクエスト/レスポンスの例
3. エラーコードと説明
4. 認証要件
5. 使用例（curlコマンドなど）
```

## 6. トラブルシューティング

API開発中によくある問題と解決策のガイドラインを提供します。

### 6.1 JPA関連の問題

- エンティティとリポジトリメソッドの不一致
- リレーションシップマッピングの問題
- トランザクション管理の問題

### 6.2 コントローラー関連の問題

- リクエスト/レスポンスのマッピング問題
- エラーハンドリングの不備
- セキュリティ設定の問題

## 7. まとめ

このガイドラインに従うことで、AIを活用して一貫性のある高品質なREST APIを効率的に開発することができます。実装プロセスを標準化し、コード品質を確保することで、開発時間を短縮し、メンテナンス性を向上させることができます。