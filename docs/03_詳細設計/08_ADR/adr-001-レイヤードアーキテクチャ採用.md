# ADR-001: レイヤードアーキテクチャの採用

## ステータス
承認

## 作成日
2025-05-08

## 作成者
XXXX (xxxx@example.com)

## コンテキスト
SES業務システムのアーキテクチャ設計において、コードの構造とモジュール間の依存関係を明確に定義する必要がある。システムは複数の業務機能を持ち、保守性、拡張性、テスト容易性を確保することが重要となる。

システムアーキテクチャとして、保守性と開発効率のバランスを考慮した最適な構造を検討する必要がある。

考慮すべき点：
- 機能の追加・変更の容易さ
- コードの保守性
- 責務の明確な分離
- テスト容易性
- チーム開発での理解しやすさ
- 既存技術スタック（Spring Boot）との親和性
- 将来的な拡張性

## 決定
SES業務システムのアーキテクチャとして、「モノリシックなレイヤードアーキテクチャ」を採用する。具体的には以下の4層構造とする：

1. **Presentationレイヤー** (UI/API層)
   - ユーザーインターフェース、API定義
   - Spring MVCコントローラー、Thymeleafテンプレート
   - リクエスト/レスポンスDTO、入力検証

2. **Applicationレイヤー** (サービス層)
   - ユースケースの実装
   - トランザクション境界の定義
   - 認可チェック
   - イベント発行
   - ドメインオブジェクトとDTOの変換

3. **Domainレイヤー** (ドメイン層)
   - ビジネスロジック
   - ドメインモデル（エンティティ、値オブジェクト）
   - ドメインサービス
   - リポジトリインターフェース

4. **Infrastructureレイヤー** (インフラ層)
   - データアクセスの実装
   - 外部サービス連携
   - 技術的な関心事（キャッシュ、ロギング等）

依存関係の原則：
- 内側のレイヤーは外側のレイヤーに依存してはならない（依存方向は外から内）
- ドメインレイヤーは他のレイヤーに依存しない
- 外部からの依存はインターフェースを介して行う

## 結果
この決定による影響と結果：

### メリット
- **責務の明確な分離**: 各レイヤーが明確な責務を持ち、コードの理解が容易になる
- **保守性の向上**: 変更の影響範囲が限定され、機能追加・変更が容易になる
- **テスト容易性**: 各レイヤーが独立しているため、ユニットテストが書きやすい
- **技術的な実装の交換性**: インフラレイヤーの実装を変更しても上位レイヤーへの影響が少ない
- **Spring Bootとの親和性**: Spring Bootのデフォルトアーキテクチャと親和性が高い
- **開発チームの学習コスト低減**: 広く採用されているパターンで学習コストが低い

### デメリット
- **ボイラープレートコードの増加**: レイヤー間の変換処理など、一部冗長なコードが発生する
- **オーバーヘッド**: レイヤー間の呼び出しとデータ変換によるパフォーマンスオーバーヘッド
- **過度の抽象化リスク**: 不必要に複雑な抽象化が生じる可能性がある

### トレードオフ
- **シンプルさ vs 複雑さ**: シンプルな統合アプリケーションとして設計し、モジュール間の明確な境界を維持
- **複雑性 vs 柔軟性**: 一定の複雑性を許容することで、より柔軟な設計を実現
- **抽象化 vs 具体性**: 適切なレベルでの抽象化を目指し、過度の抽象化は避ける

## 代替案
検討した他の選択肢：

### 1. 機能分割型モジュール構造
- **メリット**:
  - 機能ごとの独立性が高い
  - チーム間の並行開発が容易
  - 機能単位でのリリースサイクル管理が可能
- **デメリット**:
  - モジュール間の連携が複雑になりやすい
  - インターフェース管理のオーバーヘッド
  - パフォーマンス低下の可能性
- **不採用理由**:
  - 初期段階での過度なモジュール分割は複雑性を増す
  - 統合テストの難易度が上がる
  - 現時点の要件に対してコストパフォーマンスが低い

### 2. ヘキサゴナル/クリーンアーキテクチャ
- **メリット**:
  - より厳格な依存関係の制御
  - ドメイン中心の設計
  - フレームワークからの独立性
- **デメリット**:
  - 学習コストが高い
  - より多くのボイラープレートコード
  - Spring Bootとの統合が複雑になる可能性
- **不採用理由**:
  - レイヤードアーキテクチャで十分な分離と保守性を確保できる
  - チームの学習コストを考慮
  - ただし、レイヤードアーキテクチャにクリーンアーキテクチャの原則（依存方向の制御など）を部分的に取り入れる

### 3. アニーミックドメインモデル + トランザクションスクリプト
- **メリット**:
  - シンプルで理解しやすい
  - 短期的な開発速度向上
- **デメリット**:
  - ビジネスロジックの散在
  - ドメインの概念が希薄化
  - 長期的な保守性低下
- **不採用理由**:
  - 将来的な保守性と拡張性の低下
  - ビジネスロジックの一貫性確保が困難

## 参照情報
- [Layered Architecture Pattern](https://www.oreilly.com/library/view/software-architecture-patterns/9781491971437/ch01.html)
- [Spring Framework Reference](https://docs.spring.io/spring-framework/docs/current/reference/html/)
- [Domain-Driven Design](https://domainlanguage.com/ddd/)