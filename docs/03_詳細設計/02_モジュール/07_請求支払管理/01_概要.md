# 請求支払管理モジュール概要

## 1. 目的と責務

請求支払管理モジュールは、SES事業における請求・支払業務を効率的に管理するための機能を提供します。本モジュールは以下の責務を担います：

- クライアントへの請求書の作成・管理・発行
- クライアントからの入金情報の管理
- 技術者への報酬支払い情報の管理
- 請求・支払に関する財務報告の生成
- 未収金・支払予定の管理

## 2. 主要機能

### 2.1 請求管理機能

- 契約情報と勤怠データに基づく請求情報の自動生成
- 請求書データの作成・編集・削除
- 請求ステータス管理（下書き、確定、送付済み、入金済み等）
- 請求条件（請求先、支払条件、請求サイクル等）の管理
- 請求履歴の管理

### 2.2 請求書管理機能

- 請求データに基づく請求書ドキュメント生成
- 請求書テンプレート管理
- 請求書の電子配信（メール送信等）
- 請求書ダウンロードリンク生成
- 請求書閲覧履歴の管理

### 2.3 支払管理機能

- 契約情報と勤怠データに基づく支払情報の自動生成
- 支払データの作成・編集・削除
- 支払ステータス管理（予定、確定、支払済み等）
- 支払条件（支払先口座、支払サイクル、源泉徴収等）の管理
- 支払履歴の管理

### 2.4 入金管理機能

- 入金情報の登録・管理
- 請求書と入金の紐付け
- 入金ステータス管理（入金待ち、一部入金、入金完了等）
- 未収金の管理
- 入金予定日管理・督促管理

### 2.5 請求支払レポート機能

- 月次・四半期・年次売上レポート生成
- 未収金レポート生成
- 支払予定レポート生成
- 収支レポート生成
- カスタムレポート作成・管理

## 3. システム内の位置づけ

請求支払管理モジュールは、SES業務システムの中で以下のように位置づけられます：

1. **フロントエンド層**
   - 請求書作成・管理画面
   - 入金登録・管理画面
   - 支払管理画面
   - 請求支払レポート画面

2. **バックエンド層**
   - 請求管理サービス
   - 請求書ドキュメント管理サービス
   - 支払管理サービス
   - 入金管理サービス
   - レポート生成サービス

3. **データ層**
   - 請求テーブル
   - 請求明細テーブル
   - 請求書ドキュメントテーブル
   - 支払テーブル
   - 支払明細テーブル
   - 入金テーブル
   - 入金割当テーブル

4. **外部システム連携**
   - 銀行システム連携（入出金情報）
   - 会計システム連携（仕訳データ連携）
   - 電子請求書ポータル連携

## 4. ユースケース一覧

### 4.1 請求管理関連

| ID | ユースケース名 | 概要 | アクター |
|----|-------------|------|---------|
| UC-INV-01 | 請求書作成 | 契約・勤怠情報を元に請求書を作成する | 経理担当者 |
| UC-INV-02 | 請求書一括生成 | 月次処理として複数の請求書を一括生成する | システム管理者 |
| UC-INV-03 | 請求書編集 | 作成済みの請求書情報を編集する | 経理担当者 |
| UC-INV-04 | 請求書確定 | 作成した請求書を確定状態にし、請求番号を付与する | 経理担当者 |
| UC-INV-05 | 請求書取消 | 確定済みの請求書をキャンセルする | 経理担当者 |
| UC-INV-06 | 請求書検索 | 条件に基づいて請求書を検索する | 経理担当者、管理者 |

### 4.2 請求書管理関連

| ID | ユースケース名 | 概要 | アクター |
|----|-------------|------|---------|
| UC-DOC-01 | 請求書PDF生成 | 確定済み請求書からPDFドキュメントを生成する | 経理担当者 |
| UC-DOC-02 | 請求書メール送信 | 生成した請求書をクライアントにメール送信する | 経理担当者 |
| UC-DOC-03 | 請求書ダウンロード | 請求書PDFをダウンロードする | 経理担当者、クライアント |
| UC-DOC-04 | 請求書テンプレート管理 | 請求書のテンプレートを管理する | システム管理者 |
| UC-DOC-05 | 請求書閲覧履歴確認 | 請求書の閲覧状況を確認する | 経理担当者 |

### 4.3 支払管理関連

| ID | ユースケース名 | 概要 | アクター |
|----|-------------|------|---------|
| UC-PAY-01 | 支払情報作成 | 契約・勤怠情報を元に支払情報を作成する | 経理担当者 |
| UC-PAY-02 | 支払情報一括生成 | 月次処理として複数の支払情報を一括生成する | システム管理者 |
| UC-PAY-03 | 支払情報編集 | 作成済みの支払情報を編集する | 経理担当者 |
| UC-PAY-04 | 支払確定 | 支払情報を確定状態にする | 経理担当者 |
| UC-PAY-05 | 支払実行 | 確定済みの支払を実行済みとして記録する | 経理担当者 |
| UC-PAY-06 | 支払情報検索 | 条件に基づいて支払情報を検索する | 経理担当者、管理者 |
| UC-PAY-07 | 支払データエクスポート | 銀行振込用のデータ形式にエクスポートする | 経理担当者 |

### 4.4 入金管理関連

| ID | ユースケース名 | 概要 | アクター |
|----|-------------|------|---------|
| UC-REC-01 | 入金情報登録 | クライアントからの入金情報を登録する | 経理担当者 |
| UC-REC-02 | 入金と請求書の紐付け | 入金情報と対応する請求書を紐づける | 経理担当者 |
| UC-REC-03 | 入金情報編集 | 登録済みの入金情報を編集する | 経理担当者 |
| UC-REC-04 | 入金情報検索 | 条件に基づいて入金情報を検索する | 経理担当者、管理者 |
| UC-REC-05 | 未入金請求書確認 | 期限が過ぎた未入金の請求書を確認する | 経理担当者 |
| UC-REC-06 | 督促通知送信 | 未入金の請求書に対して督促通知を送信する | 経理担当者 |

### 4.5 レポート関連

| ID | ユースケース名 | 概要 | アクター |
|----|-------------|------|---------|
| UC-REP-01 | 売上レポート生成 | 期間・クライアント別の売上レポートを生成する | 経理担当者、管理者 |
| UC-REP-02 | 未収金レポート生成 | 未回収の請求金額レポートを生成する | 経理担当者、管理者 |
| UC-REP-03 | 支払予定レポート生成 | 今後の支払予定レポートを生成する | 経理担当者、管理者 |
| UC-REP-04 | 収支レポート生成 | 期間別の収支レポートを生成する | 経理担当者、管理者 |
| UC-REP-05 | レポートエクスポート | 各種レポートをExcel/PDF形式でエクスポートする | 経理担当者、管理者 |

## 5. 外部システム連携

### 5.1 銀行システム連携

- **入出金情報取得**
  - 銀行APIを利用した入金情報の自動取得
  - 振込データの送信（技術者への支払い）

- **連携方式**
  - API連携（REST/SOAP）
  - ファイル連携（全銀協フォーマット）

### 5.2 会計システム連携

- **仕訳データ連携**
  - 請求・入金・支払情報から会計仕訳データを生成
  - 会計システムへのデータ連携

- **連携方式**
  - バッチ処理によるCSV出力
  - API連携（システム依存）

### 5.3 電子請求書ポータル連携

- **請求書データ連携**
  - 電子インボイス対応
  - Peppol/JEDICなど標準規格への対応

- **連携方式**
  - API連携
  - XMLデータ交換

## 6. 非機能要件

### 6.1 パフォーマンス要件

- 請求書検索は500ms以内にレスポンスを返却すること
- 月次請求一括生成は100件につき5分以内に完了すること
- PDFレポート生成は10秒以内に完了すること

### 6.2 セキュリティ要件

- 請求・支払情報へのアクセスは権限管理により制御すること
- 銀行口座情報などの機密情報は暗号化して保存すること
- 請求書PDFなどのドキュメントはアクセス制御付きで保存すること
- 重要な操作（確定、支払実行など）はログを記録すること

### 6.3 可用性要件

- 請求書発行・支払処理など重要業務は24時間365日稼働を原則とする
- 計画メンテナンス以外のシステム停止時間は月間で0.1%未満（約43分）とする
- バックアップは日次で取得し、7年間保持すること（法定保存期間対応）

### 6.4 拡張性要件

- 複数通貨対応が可能な設計とすること
- 将来的な決済方法の追加に対応できる設計とすること
- クライアント別の請求書カスタマイズに対応できる設計とすること