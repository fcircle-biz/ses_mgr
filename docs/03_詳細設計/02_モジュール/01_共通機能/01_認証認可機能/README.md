# 認証認可機能 詳細設計

## 概要
本モジュールは、SES業務システムにおけるユーザー認証、アクセス制御、セッション管理を担当する基盤的な共通機能です。Spring Securityフレームワークを活用し、安全な認証プロセスとロールベース・属性ベースの組み合わせによる柔軟な認可制御を提供します。

## ドキュメント構成

| ドキュメント | 内容 | 最終更新日 |
|------------|------|----------|
| [01_概要](./01_概要.md) | モジュールの目的、主要機能、アーキテクチャ | 2025-05-15 |
| [02_ドメインモデル](./02_ドメインモデル.md) | エンティティ定義、値オブジェクト | 2025-05-15 |
| [03_インターフェース定義](./03_インターフェース定義.md) | モジュールが提供/利用するインターフェース仕様 | 2025-05-15 |
| [04_認証機能](./04_認証機能.md) | Spring Securityを活用した認証サービスの詳細設計 | 2025-05-15 |
| [05_認可機能](./05_認可機能.md) | Spring Securityを活用した認可サービスの詳細設計 | 2025-05-15 |

## 提供インターフェース一覧

| インターフェース名 | 概要 | 利用モジュール |
|-----------------|------|--------------|
| AuthenticationService | JWT認証とセッション管理の機能を提供 | 全モジュール |
| AuthorizationService | 権限チェックと認可管理の機能を提供 | 全モジュール |
| UserService | ユーザー管理機能を提供 | システム管理、マッチング |
| RoleService | ロール管理機能を提供 | システム管理 |

## 要求インターフェース一覧

| インターフェース名 | 提供モジュール | 概要 |
|-----------------|--------------|------|
| NotificationService | 通知機能 | パスワードリセットなどの通知送信に利用 |
| AuditLogService | ロギング機能 | セキュリティ関連操作のログ記録に利用 |

## 関連モジュール

- [システム管理](../02_システム管理/)
- [ファイル管理](../03_ファイル管理/)
- [通知機能](../04_通知機能/)

## Spring Securityの活用

本モジュールでは、以下のSpring Security標準機能を活用しています：

### 認証機能
- SecurityFilterChain: セキュリティフィルタ設定
- AuthenticationManager: 認証処理の中央管理
- UserDetailsService: ユーザー情報の取得
- PasswordEncoder: パスワードのハッシュ化と検証（BCrypt）
- TokenBasedAuthentication: JWTを使用したステートレス認証

### 認可機能
- @EnableMethodSecurity: メソッドレベルのセキュリティ有効化
- @PreAuthorize/@PostAuthorize: 宣言的な権限チェック
- RoleHierarchy: ロール階層の定義
- PermissionEvaluator: カスタム権限評価
- ExpressionBasedPredicates: SpEL式による柔軟な権限定義

### セキュリティインフラ
- SecurityContext: スレッドローカルな認証情報の保持
- AuthenticationEntryPoint: 未認証アクセスのハンドリング
- AccessDeniedHandler: 権限不足時のハンドリング
- AuthorizationEventPublisher: 認可イベントの発行と監査

これらのSpring Security標準機能を適切に組み合わせることで、カスタム認証・認可ロジックを簡潔に実装しながら、フレームワークの堅牢性とセキュリティのベストプラクティスを活用しています。