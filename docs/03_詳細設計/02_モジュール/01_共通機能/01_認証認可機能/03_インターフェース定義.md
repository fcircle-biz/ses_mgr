# <ï_ı ¤ó¿üÕ§ü¹š©

## 1. Ğ›¤ó¿üÕ§ü¹

<ïâ¸åüëoån¤ó¿üÕ§ü¹’Önâ¸åüëkĞ›W~Y

### 1.1 AuthenticationService

<æ’ÅSY‹µüÓ¹¤ó¿üÕ§ü¹gY

```java
public interface AuthenticationService {
    /**
     * æü¶ü<’LD<Èü¯ó’zLW~Y
     * @param credentials æü¶ü<Å1áüë¢Éì¹Ñ¹ïüÉI	
     * @return <ì¹İó¹¢¯»¹Èü¯óêÕìÃ·åÈü¯óI	
     * @throws AuthenticationException <1WB
     */
    AuthenticationResponse authenticate(Credentials credentials);
    
    /**
     * êÕìÃ·åÈü¯ó’(Wf°WD¢¯»¹Èü¯ó’zLW~Y
     * @param refreshToken êÕìÃ·åÈü¯ó
     * @return °WD<ì¹İó¹
     * @throws AuthenticationException Èü¯óL!¹j4
     */
    AuthenticationResponse refreshToken(String refreshToken);
    
    /**
     * æü¶ü’í°¢¦ÈW¢#Y‹Èü¯ó’!¹W~Y
     * @param accessToken ¢¯»¹Èü¯ó
     */
    void logout(String accessToken);
    
    /**
     * Ñ¹ïüÉê»ÃÈ×í»¹’‹ËW~Y
     * @param email æü¶ünáüë¢Éì¹
     * @return Ñ¹ïüÉê»ÃÈÈü¯ó
     */
    String initiatePasswordReset(String email);
    
    /**
     * Ñ¹ïüÉ’ê»ÃÈW~Y
     * @param token Ñ¹ïüÉê»ÃÈÈü¯ó
     * @param newPassword °WDÑ¹ïüÉ
     * @return æPœ
     * @throws InvalidTokenException Èü¯óL!¹j4
     */
    boolean resetPassword(String token, String newPassword);
    
    /**
     *  <×í»¹’‹ËW~Y
     * @param userId æü¶üID
     * @param method  <¹Õ
     * @return  <Áãìó¸
     */
    MfaChallenge initiateMfaAuthentication(UUID userId, AuthenticationMethod method);
    
    /**
     *  <’<W~Y
     * @param userId æü¶üID
     * @param code <³üÉ
     * @return <Pœ
     */
    boolean verifyMfaCode(UUID userId, String code);
}
```

#### 1.1.1 Çü¿Ë 

```java
// <ê¯¨¹È
public class Credentials {
    private String email;
    private String password;
    private boolean rememberMe;
    // getters, setters
}

// <ì¹İó¹
public class AuthenticationResponse {
    private String accessToken;
    private String refreshToken;
    private long expiresIn;
    private String tokenType = "Bearer";
    private boolean requiresMfa;
    // getters, setters
}

//  <Áãìó¸
public class MfaChallenge {
    private UUID challengeId;
    private AuthenticationMethod method;
    private int expiresIn;
    // getters, setters
}
```

### 1.2 AuthorizationService

ï)PÁ§Ã¯	’ÅSY‹µüÓ¹¤ó¿üÕ§ü¹gY

```java
public interface AuthorizationService {
    /**
     * šW_ê½ü¹kşY‹š¢¯·çónŸL)P’Á§Ã¯W~Y
     * @param userId æü¶üID
     * @param resourceType ê½ü¹.%
     * @param actionType ¢¯·çó.%
     * @return )P	!
     */
    boolean hasPermission(UUID userId, ResourceType resourceType, ActionType actionType);
    
    /**
     * šW_ê½ü¹kşY‹š¢¯·çónŸL)P’Á§Ã¯W~Yê½ü¹ID’š	
     * @param userId æü¶üID
     * @param resourceType ê½ü¹.%
     * @param resourceId ê½ü¹ID
     * @param actionType ¢¯·çó.%
     * @return )P	!
     */
    boolean hasPermission(UUID userId, ResourceType resourceType, UUID resourceId, ActionType actionType);
    
    /**
     * šW_)P‡WkşY‹)P’Á§Ã¯W~Y
     * @param userId æü¶üID
     * @param permission )P‡W‹: "user:read"	
     * @return )P	!
     */
    boolean hasPermission(UUID userId, String permission);
    
    /**
     * šW_íüë’cfD‹KÁ§Ã¯W~Y
     * @param userId æü¶üID
     * @param roleName íüë
     * @return íüë	!
     */
    boolean hasRole(UUID userId, String roleName);
    
    /**
     * æü¶ünYyfn)P’Ö—W~Y
     * @param userId æü¶üID
     * @return )Pê¹È
     */
    List<String> getUserPermissions(UUID userId);
    
    /**
     * æü¶ünYyfníüë’Ö—W~Y
     * @param userId æü¶üID
     * @return íüëê¹È
     */
    List<String> getUserRoles(UUID userId);
}
```

### 1.3 UserService

æü¶ü¡’ÅSY‹µüÓ¹¤ó¿üÕ§ü¹gY

```java
public interface UserService {
    /**
     * æü¶ü’IDg"W~Y
     * @param id æü¶üID
     * @return æü¶üÅ1
     */
    UserDto findById(UUID id);
    
    /**
     * áüë¢Éì¹gæü¶ü’"W~Y
     * @param email áüë¢Éì¹
     * @return æü¶üÅ1
     */
    UserDto findByEmail(String email);
    
    /**
     * hæü¶üê¹È’Ö—W~Y
     * @param pageable Úü¸ó°Å1
     * @return æü¶üê¹È
     */
    Page<UserDto> findAll(Pageable pageable);
    
    /**
     * æü¶ü’\W~Y
     * @param userCreateDto æü¶ü\Å1
     * @return \UŒ_æü¶ü
     */
    UserDto createUser(UserCreateDto userCreateDto);
    
    /**
     * æü¶üÅ1’ô°W~Y
     * @param id æü¶üID
     * @param userUpdateDto ô°Å1
     * @return ô°UŒ_æü¶ü
     */
    UserDto updateUser(UUID id, UserUpdateDto userUpdateDto);
    
    /**
     * æü¶ü’JdW~Y
     * @param id æü¶üID
     */
    void deleteUser(UUID id);
    
    /**
     * æü¶ünÑ¹ïüÉ’	ôW~Y
     * @param id æü¶üID
     * @param currentPassword ş(nÑ¹ïüÉ
     * @param newPassword °WDÑ¹ïüÉ
     * @return ô°ŸÕé°
     */
    boolean changePassword(UUID id, String currentPassword, String newPassword);
    
    /**
     * æü¶ü¢«¦óÈ’íÃ¯/¢óíÃ¯W~Y
     * @param id æü¶üID
     * @param locked íÃ¯¶K
     */
    void setAccountLocked(UUID id, boolean locked);
    
    /**
     * æü¶ün <’	¹/!¹kW~Y
     * @param id æü¶üID
     * @param enabled 	¹¶K
     * @param method <¹Õ
     * @return -š¶KÈü¯óji	
     */
    MfaSetupResponse setMfaEnabled(UUID id, boolean enabled, AuthenticationMethod method);
}
```

#### 1.3.1 Çü¿Ë 

```java
// æü¶üDTO
public class UserDto {
    private UUID id;
    private String email;
    private String name;
    private String department;
    private String position;
    private String phone;
    private List<String> roles;
    private boolean accountLocked;
    private boolean mfaEnabled;
    private LocalDateTime lastLoginAt;
    private LocalDateTime passwordExpiresAt;
    // getters, setters
}

// æü¶ü\DTO
public class UserCreateDto {
    private String email;
    private String password;
    private String name;
    private String department;
    private String position;
    private String phone;
    private UUID roleId;
    // getters, setters
}

// æü¶üô°DTO
public class UserUpdateDto {
    private String name;
    private String department;
    private String position; 
    private String phone;
    // getters, setters
}

//  <-šì¹İó¹
public class MfaSetupResponse {
    private String secretKey;
    private String qrCodeUrl;
    // getters, setters
}
```

### 1.4 RoleService

íüëh)Pn¡’ÅSY‹µüÓ¹¤ó¿üÕ§ü¹gY

```java
public interface RoleService {
    /**
     * íüë’IDg"W~Y
     * @param id íüëID
     * @return íüëÅ1
     */
    RoleDto findById(UUID id);
    
    /**
     * íüëgíüë’"W~Y
     * @param name íüë
     * @return íüëÅ1
     */
    RoleDto findByName(String name);
    
    /**
     * híüëê¹È’Ö—W~Y
     * @return íüëê¹È
     */
    List<RoleDto> findAll();
    
    /**
     * íüë’\W~Y
     * @param roleCreateDto íüë\Å1
     * @return \UŒ_íüë
     */
    RoleDto createRole(RoleCreateDto roleCreateDto);
    
    /**
     * íüëÅ1’ô°W~Y
     * @param id íüëID
     * @param roleUpdateDto ô°Å1
     * @return ô°UŒ_íüë
     */
    RoleDto updateRole(UUID id, RoleUpdateDto roleUpdateDto);
    
    /**
     * íüë’JdW~Y
     * @param id íüëID
     * @throws RoleInUseException íüëL(-n4
     */
    void deleteRole(UUID id);
    
    /**
     * íüëk)P’ı W~Y
     * @param roleId íüëID
     * @param permissionIds )PIDê¹È
     * @return ô°UŒ_íüë
     */
    RoleDto addPermissionsToRole(UUID roleId, List<UUID> permissionIds);
    
    /**
     * íüëK‰)P’JdW~Y
     * @param roleId íüëID
     * @param permissionIds )PIDê¹È
     * @return ô°UŒ_íüë
     */
    RoleDto removePermissionsFromRole(UUID roleId, List<UUID> permissionIds);
    
    /**
     * h)Pê¹È’Ö—W~Y
     * @return )Pê¹È
     */
    List<PermissionDto> findAllPermissions();
}
```

#### 1.4.1 Çü¿Ë 

```java
// íüëDTO
public class RoleDto {
    private UUID id;
    private String name;
    private String description;
    private List<PermissionDto> permissions;
    // getters, setters
}

// íüë\DTO
public class RoleCreateDto {
    private String name;
    private String description;
    private List<UUID> permissionIds;
    // getters, setters
}

// íüëô°DTO
public class RoleUpdateDto {
    private String name;
    private String description;
    // getters, setters
}

// )PDTO
public class PermissionDto {
    private UUID id;
    private String name;
    private String description;
    private ResourceType resourceType;
    private ActionType actionType;
    // getters, setters
}
```

## 2. B¤ó¿üÕ§ü¹

<ïâ¸åüëLÖnâ¸åüëkBY‹¤ó¿üÕ§ü¹gY

### 2.1 NotificationService

Ñ¹ïüÉê»ÃÈ„ <jinå’áY‹_n¤ó¿üÕ§ü¹gY

```java
public interface NotificationService {
    /**
     * Ñ¹ïüÉê»ÃÈáüë’áW~Y
     * @param email ›Háüë¢Éì¹
     * @param resetToken ê»ÃÈÈü¯ó
     * @param expirationMinutes 	¹P	
     * @return áŸÕé°
     */
    boolean sendPasswordResetEmail(String email, String resetToken, int expirationMinutes);
    
    /**
     *  <³üÉ’áüëgáW~Y
     * @param email ›Háüë¢Éì¹
     * @param verificationCode <³üÉ
     * @param expirationMinutes 	¹P	
     * @return áŸÕé°
     */
    boolean sendMfaVerificationEmail(String email, String verificationCode, int expirationMinutes);
    
    /**
     * ¢«¦óÈíÃ¯å’áW~Y
     * @param email ›Háüë¢Éì¹
     * @param reason íÃ¯1
     * @return áŸÕé°
     */
    boolean sendAccountLockedNotification(String email, String reason);
}
```

### 2.2 AuditLogService

»­åêÆ£¢#¤ÙóÈní°2’LF_n¤ó¿üÕ§ü¹gY

```java
public interface AuditLogService {
    /**
     * <¤ÙóÈ’í°k2W~Y
     * @param eventType ¤ÙóÈ.%
     * @param userId æü¶üID<1WBonullï	
     * @param email áüë¢Éì¹
     * @param success ŸÕé°
     * @param ipAddress IP¢Éì¹
     * @param userAgent æü¶ü¨ü¸§óÈ
     * @param details s0Å1
     */
    void logAuthenticationEvent(AuthEventType eventType, UUID userId, String email, 
                               boolean success, String ipAddress, String userAgent, 
                               Map<String, String> details);
    
    /**
     * ï¤ÙóÈ’í°k2W~Y
     * @param userId æü¶üID
     * @param resource ¢¯»¹şaê½ü¹
     * @param action ŸL¢¯·çó
     * @param success ŸÕé°
     * @param details s0Å1
     */
    void logAuthorizationEvent(UUID userId, String resource, String action, 
                              boolean success, Map<String, String> details);
    
    /**
     * æü¶ü¡¤ÙóÈ’í°k2W~Y
     * @param adminUserId ¡æü¶üID
     * @param targetUserId şaæü¶üID
     * @param action ŸL¢¯·çó
     * @param details s0Å1
     */
    void logUserManagementEvent(UUID adminUserId, UUID targetUserId, 
                               String action, Map<String, String> details);
}
```

#### 2.2.1 ‹

```java
public enum AuthEventType {
    LOGIN_ATTEMPT,
    LOGIN_SUCCESS,
    LOGIN_FAILURE,
    LOGOUT,
    PASSWORD_RESET_REQUEST,
    PASSWORD_RESET_SUCCESS,
    PASSWORD_CHANGE,
    MFA_ENABLED,
    MFA_DISABLED,
    MFA_VERIFICATION_SUCCESS,
    MFA_VERIFICATION_FAILURE,
    ACCOUNT_LOCKED,
    ACCOUNT_UNLOCKED,
    TOKEN_REFRESH
}
```

## 3. REST API ¤ó¿üÕ§ü¹

<ï_ıLĞ›Y‹REST APIn;¨óÉİ¤óÈoånŠgY

### 3.1 <API

| á½ÃÉ | ¨óÉİ¤óÈ | ¬ | ê¯¨¹È | ì¹İó¹ |
|---------|--------------|------|-----------|-----------|
| POST | /api/v1/auth/login | æü¶üí°¤ó | Credentials | AuthenticationResponse |
| POST | /api/v1/auth/refresh | Èü¯óêÕìÃ·å | {refreshToken} | AuthenticationResponse |
| POST | /api/v1/auth/logout | í°¢¦È | {accessToken} | - |
| POST | /api/v1/auth/password-reset | Ñ¹ïüÉê»ÃÈB | {email} | - |
| POST | /api/v1/auth/password-reset/confirm | Ñ¹ïüÉê»ÃÈŸL | {token, newPassword} | - |
| POST | /api/v1/auth/mfa/verify |  << | {userId, code} | AuthenticationResponse |

### 3.2 æü¶ü¡API

| á½ÃÉ | ¨óÉİ¤óÈ | ¬ | ê¯¨¹È | ì¹İó¹ |
|---------|--------------|------|-----------|-----------|
| GET | /api/v1/users | æü¶ü §Ö— | - | Page<UserDto> |
| GET | /api/v1/users/{id} | æü¶üs0Ö— | - | UserDto |
| POST | /api/v1/users | æü¶ü\ | UserCreateDto | UserDto |
| PUT | /api/v1/users/{id} | æü¶üô° | UserUpdateDto | UserDto |
| DELETE | /api/v1/users/{id} | æü¶üJd | - | - |
| PUT | /api/v1/users/{id}/password | Ñ¹ïüÉ	ô | {currentPassword, newPassword} | - |
| PUT | /api/v1/users/{id}/lock | ¢«¦óÈíÃ¯/¢óíÃ¯ | {locked} | UserDto |
| PUT | /api/v1/users/{id}/mfa |  <-š | {enabled, method} | MfaSetupResponse |

### 3.3 íüëû)P¡API

| á½ÃÉ | ¨óÉİ¤óÈ | ¬ | ê¯¨¹È | ì¹İó¹ |
|---------|--------------|------|-----------|-----------|
| GET | /api/v1/roles | íüë §Ö— | - | List<RoleDto> |
| GET | /api/v1/roles/{id} | íüës0Ö— | - | RoleDto |
| POST | /api/v1/roles | íüë\ | RoleCreateDto | RoleDto |
| PUT | /api/v1/roles/{id} | íüëô° | RoleUpdateDto | RoleDto |
| DELETE | /api/v1/roles/{id} | íüëJd | - | - |
| POST | /api/v1/roles/{id}/permissions | íüëk)P’ı  | {permissionIds} | RoleDto |
| DELETE | /api/v1/roles/{id}/permissions | íüëK‰)P’Jd | {permissionIds} | RoleDto |
| GET | /api/v1/permissions | )P §Ö— | - | List<PermissionDto> |

## 4. …è¤ó¿üÕ§ü¹

â¸åüë…èg(Y‹;j¤ó¿üÕ§ü¹gY

### 4.1 UserRepository

æü¶ü¨óÆ£Æ£n8š’ÅSY‹êİ¸ÈêgY

```java
public interface UserRepository {
    Optional<User> findById(UUID id);
    Optional<User> findByEmail(String email);
    List<User> findAll();
    Page<User> findAll(Pageable pageable);
    User save(User user);
    void delete(User user);
    boolean existsByEmail(String email);
}
```

### 4.2 RoleRepository

íüë¨óÆ£Æ£n8š’ÅSY‹êİ¸ÈêgY

```java
public interface RoleRepository {
    Optional<Role> findById(UUID id);
    Optional<Role> findByName(String name);
    List<Role> findAll();
    Role save(Role role);
    void delete(Role role);
    boolean existsByName(String name);
}
```

### 4.3 PermissionRepository

)P¨óÆ£Æ£n8š’ÅSY‹êİ¸ÈêgY

```java
public interface PermissionRepository {
    Optional<Permission> findById(UUID id);
    Optional<Permission> findByName(String name);
    List<Permission> findAll();
    List<Permission> findByIdIn(List<UUID> ids);
    Permission save(Permission permission);
    void delete(Permission permission);
}
```

### 4.4 RefreshTokenRepository

êÕìÃ·åÈü¯ón8š’ÅSY‹êİ¸ÈêgY

```java
public interface RefreshTokenRepository {
    Optional<RefreshToken> findById(UUID id);
    Optional<RefreshToken> findByTokenHash(String tokenHash);
    List<RefreshToken> findByUserId(UUID userId);
    RefreshToken save(RefreshToken refreshToken);
    void delete(RefreshToken refreshToken);
    void deleteAllByUserIdAndRevoked(UUID userId, boolean revoked);
}
```

### 4.5 JwtTokenProvider

JWTÈü¯ónh<’ÅSY‹µüÓ¹gY

```java
public interface JwtTokenProvider {
    String generateAccessToken(User user);
    String generateRefreshToken(User user);
    UUID getUserIdFromToken(String token);
    boolean validateToken(String token);
    Claims getClaimsFromToken(String token);
    long getExpirationTime();
}
```

### 4.6 PasswordEncoder

Ñ¹ïüÉnÏÃ·åh<’LFµüÓ¹gY

```java
public interface PasswordEncoder {
    String encode(String rawPassword);
    boolean matches(String rawPassword, String encodedPassword);
}
```

## 5. ·ü±ó¹ó

### 5.1 æü¶ü<Õíü

```mermaid
sequenceDiagram
    Client->>+AuthController: POST /api/v1/auth/login
    AuthController->>+AuthenticationService: authenticate(credentials)
    AuthenticationService->>+UserRepository: findByEmail(email)
    UserRepository-->>-AuthenticationService: User
    AuthenticationService->>+PasswordEncoder: matches(password, encodedPassword)
    PasswordEncoder-->>-AuthenticationService: result
    
    alt <Ÿ
        AuthenticationService->>+JwtTokenProvider: generateAccessToken(user)
        JwtTokenProvider-->>-AuthenticationService: accessToken
        AuthenticationService->>+JwtTokenProvider: generateRefreshToken(user)
        JwtTokenProvider-->>-AuthenticationService: refreshToken
        AuthenticationService->>+RefreshTokenRepository: save(refreshToken)
        RefreshTokenRepository-->>-AuthenticationService: savedToken
        AuthenticationService->>+AuditLogService: logAuthenticationEvent(LOGIN_SUCCESS, ...)
        AuditLogService-->>-AuthenticationService: void
    else <1W
        AuthenticationService->>+AuditLogService: logAuthenticationEvent(LOGIN_FAILURE, ...)
        AuditLogService-->>-AuthenticationService: void
        AuthenticationService-->>AuthController: throw AuthenticationException
    end
    
    AuthenticationService-->>-AuthController: AuthenticationResponse
    AuthController-->>-Client: 200 OK (tokens)
```

### 5.2 ïÁ§Ã¯Õíü

```mermaid
sequenceDiagram
    Client->>+ResourceController: GET /api/v1/protected-resource
    ResourceController->>+AuthorizationService: hasPermission(userId, resourceType, action)
    AuthorizationService->>+UserRepository: findById(userId)
    UserRepository-->>-AuthorizationService: User with roles
    AuthorizationService->>+RoleRepository: findByIdIn(roleIds)
    RoleRepository-->>-AuthorizationService: Roles with permissions
    
    alt )PBŠ
        AuthorizationService-->>-ResourceController: true
        ResourceController->>ResourceController: æŸL
        ResourceController-->>Client: 200 OK (resource)
    else )PjW
        AuthorizationService-->>-ResourceController: false
        ResourceController-->>Client: 403 Forbidden
    end
```

## 6. ‹š©

<ïâ¸åüëg(Y‹;j‹¯é¹gY

```java
// <‹ú•¯é¹	
public class AuthenticationException extends RuntimeException {
    public AuthenticationException(String message) {
        super(message);
    }
}

// <1W‹
public class InvalidCredentialsException extends AuthenticationException {
    public InvalidCredentialsException() {
        super("!¹j<Å1gY");
    }
}

// ¢«¦óÈíÃ¯‹
public class AccountLockedException extends AuthenticationException {
    public AccountLockedException() {
        super("¢«¦óÈLíÃ¯UŒfD~Y");
    }
}

// Èü¯ó‹ú•¯é¹	
public class TokenException extends RuntimeException {
    public TokenException(String message) {
        super(message);
    }
}

// !¹Èü¯ó‹
public class InvalidTokenException extends TokenException {
    public InvalidTokenException() {
        super("!¹jÈü¯ógY");
    }
}

// Èü¯óPŒ‹
public class TokenExpiredException extends TokenException {
    public TokenExpiredException() {
        super("Èü¯ón	¹PLŒfD~Y");
    }
}

// ï‹
public class AuthorizationException extends RuntimeException {
    public AuthorizationException(String message) {
        super(message);
    }
}

// ¢¯»¹Ò&‹
public class AccessDeniedException extends AuthorizationException {
    public AccessDeniedException() {
        super("ê½ü¹xn¢¯»¹LÒ&UŒ~W_");
    }
}

// íüë(-‹
public class RoleInUseException extends RuntimeException {
    public RoleInUseException(String roleName) {
        super("íüë '" + roleName + "' o(-n_JdgM~[“");
    }
}
```

## 7. »­åêÆ£n‹

<ïâ¸åüën¤ó¿üÕ§ü¹(kJQ‹Íj»­åêÆ£n‹gY

1. **Èü¯ónÖŠqD**:
   - ¢¯»¹Èü¯óo8kHTTPªóêün¯Ã­ü~_oíü«ë¹Èìü¸kİX
   - Èü¯óoHTTPSgnáY‹Sh’76
   - êÕìÃ·åÈü¯óoykØD»­åêÆ£gİw

2. **Ñ¹ïüÉ¡**:
   - Ñ¹ïüÉo8kÏÃ·åWfİXWs‡gqjD
   - Ñ¹ïüÉê»ÃÈÕíüoij¿¤à¢¦Èh nÈü¯ó’(

3. **ïÁ§Ã¯**:
   - ïÁ§Ã¯oÅZpì¤äügŸ½APIdµüÓ¹dÇü¿¢¯»¹d	
   - ÇÕ©ëÈÒ&nŸG’i(:„k1ïUŒfDjD¢¯»¹oYyfÒ&	

4. **ãûí°**:
   - Yyfn<ûï¤ÙóÈ’ikí°k2
   - í°koAj‡Å1’+‹L_ÆÅ1o+jD

5. **Èü¯ó!¹**:
   - Ñ¹ïüÉ	ôB„í°¢¦ÈBko¢#Y‹YyfnÈü¯ó’!¹

6. ** <**:
   - ¡¢«¦óÈko <’ÅhY‹
   -  <n·ü¯ìÃÈoik—÷WfİX