# 国際化機能 - インターフェース定義

## 1. インターフェース概要

国際化機能モジュールは、システム全体に多言語対応機能を提供するためのインターフェースを定義しています。これらのインターフェースにより、他のモジュールは言語依存のコンポーネントを表示したり、ユーザーの地域設定に応じたフォーマットを適用することができます。

## 2. 提供インターフェース

### 2.1 MessageSourceService

メッセージ解決の中核機能を提供するインターフェースです。

#### インターフェース概要
- メッセージキーに対応するテキストを取得
- パラメータを含むメッセージの置換処理
- 異なるロケールでのメッセージ解決

#### メソッド

- **getMessage**
  - 説明: メッセージキーに対応するメッセージを取得する
  - パラメータ:
    - key: String - メッセージキー
    - args: Object[] - メッセージパラメータ（省略可）
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - 解決されたメッセージ
  - 例外:
    - NoSuchMessageException - メッセージが見つからない場合

- **getAllMessages**
  - 説明: 指定された名前空間のすべてのメッセージを取得する
  - パラメータ:
    - namespace: String - メッセージ名前空間
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: Map<String, String> - メッセージキーとメッセージのマップ

- **hasMessage**
  - 説明: 指定されたメッセージキーが存在するか確認する
  - パラメータ:
    - key: String - メッセージキー
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: boolean - メッセージが存在する場合はtrue

- **reloadMessages**
  - 説明: メッセージリソースを再読み込みする
  - パラメータ: なし
  - 戻り値: void

### 2.2 LocaleService

ロケール管理機能を提供するインターフェースです。

#### インターフェース概要
- 現在のロケールの解決と管理
- サポートされているロケールの提供
- ユーザーごとのロケール設定の管理

#### メソッド

- **getCurrentLocale**
  - 説明: 現在のリクエストのロケールを取得する
  - パラメータ: なし
  - 戻り値: Locale - 現在のロケール

- **getSupportedLocales**
  - 説明: サポートされているロケールのリストを取得する
  - パラメータ: なし
  - 戻り値: List<Locale> - サポートされているロケールのリスト

- **getUserLocale**
  - 説明: 指定されたユーザーのデフォルトロケールを取得する
  - パラメータ:
    - userId: String - ユーザーID
  - 戻り値: Locale - ユーザーのデフォルトロケール
  - 例外:
    - UserNotFoundException - ユーザーが存在しない場合

- **setUserLocale**
  - 説明: ユーザーのデフォルトロケールを設定する
  - パラメータ:
    - userId: String - ユーザーID
    - locale: Locale - 設定するロケール
  - 戻り値: void
  - 例外:
    - UserNotFoundException - ユーザーが存在しない場合
    - UnsupportedLocaleException - サポートされていないロケールの場合

- **isLocaleSupported**
  - 説明: 指定されたロケールがサポートされているか確認する
  - パラメータ:
    - locale: Locale - 確認するロケール
  - 戻り値: boolean - サポートされている場合はtrue

### 2.3 DateTimeFormatService

日付と時刻のフォーマット機能を提供するインターフェースです。

#### インターフェース概要
- ロケールに応じた日付と時刻のフォーマット
- 定義済みパターンによるフォーマット
- カスタムパターンによるフォーマット

#### メソッド

- **formatDate**
  - 説明: 日付をフォーマットする
  - パラメータ:
    - date: LocalDate - フォーマット対象の日付
    - formatType: String - フォーマットタイプ (default, short, long, weekday)
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - フォーマットされた日付

- **formatTime**
  - 説明: 時刻をフォーマットする
  - パラメータ:
    - time: LocalTime - フォーマット対象の時刻
    - formatType: String - フォーマットタイプ (default, short, long)
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - フォーマットされた時刻

- **formatDateTime**
  - 説明: 日時をフォーマットする
  - パラメータ:
    - dateTime: LocalDateTime - フォーマット対象の日時
    - formatType: String - フォーマットタイプ (default, short, long)
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - フォーマットされた日時

- **formatWithPattern**
  - 説明: カスタムパターンで日時をフォーマットする
  - パラメータ:
    - temporal: TemporalAccessor - フォーマット対象の時間型オブジェクト
    - pattern: String - カスタムパターン
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - フォーマットされた日時
  - 例外:
    - IllegalPatternException - パターンが不正な場合

- **getFormatPattern**
  - 説明: ロケールとフォーマットタイプに対応するパターンを取得する
  - パラメータ:
    - formatType: String - フォーマットタイプ
    - locale: Locale - 対象ロケール
  - 戻り値: String - フォーマットパターン

### 2.4 NumberFormatService

数値と通貨のフォーマット機能を提供するインターフェースです。

#### インターフェース概要
- ロケールに応じた数値と通貨のフォーマット
- 定義済みパターンによるフォーマット
- カスタムパターンによるフォーマット

#### メソッド

- **formatNumber**
  - 説明: 数値をフォーマットする
  - パラメータ:
    - number: Number - フォーマット対象の数値
    - formatType: String - フォーマットタイプ (integer, decimal, percent)
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - フォーマットされた数値

- **formatCurrency**
  - 説明: 通貨をフォーマットする
  - パラメータ:
    - amount: Number - フォーマット対象の金額
    - formatType: String - フォーマットタイプ (default, thousands, millions)
    - currencyCode: String - 通貨コード（省略可）
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - フォーマットされた通貨

- **formatPercent**
  - 説明: パーセント値をフォーマットする
  - パラメータ:
    - value: Number - フォーマット対象の値
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - フォーマットされたパーセント値

- **parseNumber**
  - 説明: ロケール固有の数値文字列をパースする
  - パラメータ:
    - text: String - パース対象の文字列
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: Number - パースされた数値
  - 例外:
    - ParseException - パースに失敗した場合

- **getCurrencySymbol**
  - 説明: 指定された通貨コードの通貨記号を取得する
  - パラメータ:
    - currencyCode: String - 通貨コード
    - locale: Locale - 対象ロケール（省略可）
  - 戻り値: String - 通貨記号

### 2.5 TranslationService

多言語対応データの翻訳管理機能を提供するインターフェースです。

#### インターフェース概要
- エンティティの翻訳データの管理
- ロケールに応じた翻訳の取得
- 翻訳の作成と更新

#### メソッド

- **getTranslation**
  - 説明: エンティティのフィールドの翻訳を取得する
  - パラメータ:
    - entityType: String - エンティティの種類
    - entityId: String - エンティティのID
    - fieldName: String - フィールド名
    - locale: Locale - 対象ロケール
  - 戻り値: String - 翻訳テキスト
  - 例外:
    - TranslationNotFoundException - 翻訳が見つからない場合

- **getTranslations**
  - 説明: エンティティのすべてのフィールドの翻訳を取得する
  - パラメータ:
    - entityType: String - エンティティの種類
    - entityId: String - エンティティのID
    - locale: Locale - 対象ロケール
  - 戻り値: Map<String, String> - フィールド名と翻訳のマップ

- **saveTranslation**
  - 説明: エンティティのフィールドの翻訳を保存する
  - パラメータ:
    - entityType: String - エンティティの種類
    - entityId: String - エンティティのID
    - fieldName: String - フィールド名
    - locale: Locale - 対象ロケール
    - translation: String - 翻訳テキスト
  - 戻り値: void

- **saveTranslations**
  - 説明: エンティティの複数フィールドの翻訳を一括保存する
  - パラメータ:
    - entityType: String - エンティティの種類
    - entityId: String - エンティティのID
    - translations: Map<String, Map<Locale, String>> - フィールド名、ロケール、翻訳のマップ
  - 戻り値: void

- **deleteTranslations**
  - 説明: エンティティのすべての翻訳を削除する
  - パラメータ:
    - entityType: String - エンティティの種類
    - entityId: String - エンティティのID
  - 戻り値: void

## 3. 要求インターフェース

### 3.1 UserService

ユーザー情報管理機能を提供するインターフェースです。

#### インターフェース概要
- ユーザー情報の取得と検証
- ユーザーの設定情報管理

#### 主要メソッド

- **getUserById**
  - 説明: IDによるユーザー取得
  - パラメータ:
    - userId: String - ユーザーID
  - 戻り値: User - ユーザー情報
  - 例外:
    - UserNotFoundException - ユーザーが存在しない場合

- **getUserPreference**
  - 説明: ユーザーの設定情報を取得する
  - パラメータ:
    - userId: String - ユーザーID
    - key: String - 設定キー
  - 戻り値: String - 設定値
  - 例外:
    - UserNotFoundException - ユーザーが存在しない場合

- **setUserPreference**
  - 説明: ユーザーの設定情報を保存する
  - パラメータ:
    - userId: String - ユーザーID
    - key: String - 設定キー
    - value: String - 設定値
  - 戻り値: void
  - 例外:
    - UserNotFoundException - ユーザーが存在しない場合

### 3.2 ResourceService

リソースアクセス機能を提供するインターフェースです。

#### インターフェース概要
- ファイルシステム上のリソースへのアクセス
- リソースの読み込みと書き込み

#### 主要メソッド

- **getResource**
  - 説明: 指定されたパスのリソースを取得する
  - パラメータ:
    - path: String - リソースパス
  - 戻り値: Resource - リソースオブジェクト
  - 例外:
    - ResourceNotFoundException - リソースが存在しない場合

- **readResource**
  - 説明: リソースの内容を読み込む
  - パラメータ:
    - resource: Resource - リソースオブジェクト
    - encoding: String - エンコーディング（省略可）
  - 戻り値: String - リソースの内容
  - 例外:
    - IOException - 読み込みに失敗した場合

- **listResources**
  - 説明: 指定されたパターンに一致するリソースを列挙する
  - パラメータ:
    - locationPattern: String - 検索パターン
  - 戻り値: Resource[] - リソースの配列
  - 例外:
    - IOException - 検索に失敗した場合

### 3.3 CacheService

キャッシュ管理機能を提供するインターフェースです。

#### インターフェース概要
- メッセージリソースのキャッシュ
- フォーマットパターンのキャッシュ
- キャッシュの管理と制御

#### 主要メソッド

- **get**
  - 説明: キャッシュから値を取得する
  - パラメータ:
    - cacheName: String - キャッシュ名
    - key: Object - キャッシュキー
  - 戻り値: Object - キャッシュされた値（存在しない場合はnull）

- **put**
  - 説明: キャッシュに値を格納する
  - パラメータ:
    - cacheName: String - キャッシュ名
    - key: Object - キャッシュキー
    - value: Object - キャッシュする値
    - ttl: Duration - 生存時間（省略可）
  - 戻り値: void

- **evict**
  - 説明: キャッシュから特定のキーのエントリを削除する
  - パラメータ:
    - cacheName: String - キャッシュ名
    - key: Object - キャッシュキー
  - 戻り値: void

- **clear**
  - 説明: 指定されたキャッシュをクリアする
  - パラメータ:
    - cacheName: String - キャッシュ名
  - 戻り値: void

## 4. データ交換モデル

### 4.1 LocaleDTO

ロケール情報のデータ転送オブジェクトです。

```java
public class LocaleDTO {
    private String language;
    private String country;
    private String variant;
    private String displayName;
    
    // getters, setters
}
```

### 4.2 MessageDTO

メッセージのデータ転送オブジェクトです。

```java
public class MessageDTO {
    private String key;
    private String value;
    private String namespace;
    
    // getters, setters
}
```

### 4.3 TranslationDTO

翻訳エントリのデータ転送オブジェクトです。

```java
public class TranslationDTO {
    private String entityType;
    private String entityId;
    private String fieldName;
    private String locale;
    private String translation;
    
    // getters, setters
}
```

### 4.4 LocalePreferenceDTO

ユーザーのロケール設定のデータ転送オブジェクトです。

```java
public class LocalePreferenceDTO {
    private String userId;
    private String locale;
    private String dateFormat;
    private String timeFormat;
    private String numberFormat;
    
    // getters, setters
}
```

## 5. 非機能要件

### 5.1 パフォーマンス要件

- メッセージ解決: 平均応答時間 5ms以内
- 日付・数値フォーマット: 平均応答時間 3ms以内
- 翻訳取得: 平均応答時間 10ms以内
- メッセージキャッシュヒット率: 99%以上
- リソースバンドルのロード時間: 最大100ms

### 5.2 セキュリティ要件

- メッセージリソースファイルへの不正アクセス防止
- ロケール設定の改ざん防止
- XSS攻撃防止のためのメッセージエスケープ
- 権限に基づくロケール設定の制限

### 5.3 可用性要件

- メッセージリソースの動的更新機能
- リソースバンドルの障害時のフォールバック機構
- キャッシュ障害時の直接読み込み機能
- パフォーマンス劣化時の自動検知と通知

### 5.4 運用要件

- メッセージリソースの変更監視と自動リロード
- リソースバンドルの整合性チェック
- 未翻訳メッセージの検出と通知
- ロケール使用状況の統計収集