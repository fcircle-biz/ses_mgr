# 国際化機能 - ドメインモデル

## 1. 値オブジェクト

### 1.1 Locale（ロケール）

ユーザーの言語と地域の組み合わせを表す値オブジェクトです。

#### 属性

| 属性名 | 型 | 説明 | 制約 |
|-------|------|------|------|
| language | String | 言語コード | 必須、ISO 639-1準拠の2文字コード |
| country | String | 国コード | 省略可、ISO 3166-1準拠の2文字コード |
| variant | String | バリアント | 省略可 |

#### ビジネスルール

- 言語コードは小文字のみ許容（例：ja, en）
- 国コードは大文字のみ許容（例：JP, US）
- 言語と国の組み合わせは「言語_国」形式で表現（例：ja_JP）
- サポート対象言語と国の組み合わせのみ有効

#### 関連メソッド

- toString(): String - ロケールを文字列で表現（例：ja_JP）
- toLanguageTag(): String - BCP 47言語タグ形式での表現（例：ja-JP）
- getDisplayName(): String - 現在のロケールでの表示名（例：「日本語（日本）」）

### 1.2 MessageKey（メッセージキー）

メッセージリソースを識別するためのキーを表す値オブジェクトです。

#### 属性

| 属性名 | 型 | 説明 | 制約 |
|-------|------|------|------|
| module | String | モジュール名 | 必須 |
| category | String | カテゴリ名 | 必須 |
| element | String | 要素名 | 必須 |
| detail | String | 詳細 | 省略可 |

#### ビジネスルール

- 各セグメントは小文字のアルファベットとアンダースコアのみ許容
- ドット区切りで階層構造を表現（例：common.button.save）
- 最短で2階層、最長で4階層まで許容

#### 関連メソッド

- toString(): String - メッセージキーを文字列で表現（例：common.button.save）
- fromString(String): MessageKey - 文字列からMessageKeyオブジェクトを生成

### 1.3 FormatPattern（フォーマットパターン）

日付・時刻・数値・通貨のフォーマットパターンを表す値オブジェクトです。

#### 属性

| 属性名 | 型 | 説明 | 制約 |
|-------|------|------|------|
| patternType | PatternType | パターンの種類 | 必須 |
| pattern | String | フォーマットパターン | 必須 |
| locale | Locale | 対象ロケール | 必須 |

#### パターン種類（PatternType）

| 値 | 説明 |
|-----|------|
| DATE | 日付フォーマット |
| TIME | 時刻フォーマット |
| DATETIME | 日時フォーマット |
| NUMBER | 数値フォーマット |
| CURRENCY | 通貨フォーマット |
| PERCENT | パーセントフォーマット |

#### ビジネスルール

- パターンはJava DateTimeFormatter、DecimalFormatterの書式に準拠
- ロケールごとに異なるパターンを設定可能
- パターン種類ごとに複数のバリエーション（標準、短縮、詳細など）を持つ

#### 関連メソッド

- format(Object): String - 対象をパターンに従ってフォーマット

## 2. エンティティ

### 2.1 LocalePreference（ロケール設定）

ユーザーのロケール設定を管理するエンティティです。

#### 属性

| 属性名 | 型 | 説明 | 制約 |
|-------|------|------|------|
| id | Long | 設定ID | 主キー |
| userId | String | ユーザーID | NOT NULL |
| locale | String | ロケール文字列 | NOT NULL |
| dateFormat | String | 日付フォーマット | NOT NULL |
| timeFormat | String | 時刻フォーマット | NOT NULL |
| numberFormat | String | 数値フォーマット | NOT NULL |
| createdAt | LocalDateTime | 作成日時 | NOT NULL |
| updatedAt | LocalDateTime | 更新日時 | NOT NULL |

#### ビジネスルール

- ユーザーごとに1つのロケール設定のみ許容
- 保存時にロケールの有効性を検証
- サポート対象外のロケールの場合はデフォルトロケールに変換

#### 関連

- User（ユーザー）と1対1で関連

### 2.2 TranslationEntry（翻訳エントリ）

多言語対応データのある言語における翻訳を表すエンティティです。

#### 属性

| 属性名 | 型 | 説明 | 制約 |
|-------|------|------|------|
| id | Long | 翻訳ID | 主キー |
| entityType | String | エンティティ種別 | NOT NULL |
| entityId | String | エンティティID | NOT NULL |
| fieldName | String | フィールド名 | NOT NULL |
| locale | String | ロケール | NOT NULL |
| translation | String | 翻訳テキスト | NOT NULL |
| createdAt | LocalDateTime | 作成日時 | NOT NULL |
| updatedAt | LocalDateTime | 更新日時 | NOT NULL |

#### ビジネスルール

- エンティティ種別、エンティティID、フィールド名、ロケールの組み合わせは一意
- 翻訳テキストは最大4000文字
- ロケールは有効なLocale形式であること

#### 関連

- エンティティと多対1で関連

## 3. ドメインサービス

### 3.1 LocaleResolver（ロケール解決サービス）

ユーザーのロケールを解決するサービスです。

#### 主要操作

- リクエストからのロケール解決
- ユーザーのデフォルトロケール管理
- ロケール変更の検出と処理

### 3.2 MessageResolver（メッセージ解決サービス）

メッセージキーに対応するメッセージを解決するサービスです。

#### 主要操作

- メッセージキーからメッセージの取得
- パラメータのメッセージへの埋め込み
- メッセージバンドルの管理

### 3.3 FormatService（フォーマットサービス）

ロケールに応じた各種フォーマットを提供するサービスです。

#### 主要操作

- 日付・時刻のフォーマット
- 数値のフォーマット
- 通貨のフォーマット
- カスタムフォーマットパターンの管理

### 3.4 TranslationService（翻訳サービス）

エンティティの翻訳を管理するサービスです。

#### 主要操作

- エンティティの翻訳取得
- 翻訳の追加・更新
- 翻訳のバルク処理

## 4. 集約

### 4.1 LocaleConfiguration（ロケール構成）

ロケール関連の設定を集約します。

#### 構成要素

- ロケール設定（LocalePreference）
- サポート対象ロケール一覧
- デフォルトロケール

### 4.2 MessageBundle（メッセージバンドル）

特定のロケールに対応するメッセージ集約です。

#### 構成要素

- ロケール
- モジュール別メッセージマップ
- フォールバックメッセージバンドル

### 4.3 TranslatableEntity（翻訳可能エンティティ）

多言語に対応したエンティティの集約です。

#### 構成要素

- エンティティ本体
- フィールド別翻訳エントリ
- デフォルト言語データ