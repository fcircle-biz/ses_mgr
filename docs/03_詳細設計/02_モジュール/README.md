# モジュール設計

## 概要

本ディレクトリでは、SES業務システムの各機能モジュールの詳細設計を管理します。詳細設計フェーズでは、基本設計フェーズで定義された設計方針に基づき、より実装に近いレベルでの詳細な設計を行います。[詳細設計ガイドライン](https://fcircle-biz.github.io/ses_mgr/00_ガイドライン/詳細設計ガイドライン.md)および[モジュール設計方針](https://fcircle-biz.github.io/ses_mgr/00_ガイドライン/詳細設計/モジュール設計方針.md)に従い、ドキュメントを作成しています。

## モジュール構成図

SES業務システムは以下のようなモジュール構成となっています：

```
+-------------------------------------------------------------+
|                        API Gateway                          |
+-------------------------------------------------------------+
                              |
+-------------------------------------------------------------+
|                     Presentation Layer                      |
|    +----------------+  +------------------+  +-----------+  |
|    | Web Controllers|  | REST Controllers |  | Validators|  |
|    +----------------+  +------------------+  +-----------+  |
+-------------------------------------------------------------+
                              |
+-------------------------------------------------------------+
|                      Business Layer                         |
|   +----------------+   +---------------+   +------------+   |
|   | Domain Services|   | Domain Models |   | Factories  |   |
|   +----------------+   +---------------+   +------------+   |
+-------------------------------------------------------------+
                              |
+-------------------------------------------------------------+
|                      Data Access Layer                      |
|   +----------------+   +---------------+   +------------+   |
|   | Repositories   |   | Entity Models |   | DAOs       |   |
|   +----------------+   +---------------+   +------------+   |
+-------------------------------------------------------------+
                              |
+-------------------------------------------------------------+
|                      Common Services                        |
| +--------+ +-------+ +------+ +-------+ +--------+ +------+ |
| |認証認可| |ユーザー| |コード| |ファイル| |ロギング| |検索  | |
| +--------+ +-------+ +------+ +-------+ +--------+ +------+ |
+-------------------------------------------------------------+
```

## モジュール一覧

### 1. [共通機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/)
システム全体で共通して使用する横断的機能を提供するモジュール

- **[認証認可機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/01_認証認可機能/)**: JWT認証と権限管理
- **[ユーザー管理機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/02_ユーザー管理機能/)**: ユーザーアカウント管理
- **[コード値管理機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/03_コード値管理機能/)**: システム共通コード管理
- **[エラー処理機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/04_エラー処理機能/)**: 統一的な例外処理
- **[ファイル管理機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/05_ファイル管理機能/)**: ファイルストレージと管理
- **[ロギング機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/06_ロギング機能/)**: アプリケーション・監査ログ
- **[検索機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/07_検索機能/)**: 全文検索とフィルタリング
- **[トランザクション管理機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/08_トランザクション管理機能/)**: トランザクション制御
- **[通知機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/09_通知機能/)**: ユーザー通知管理
- **[国際化機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/10_国際化機能/)**: 多言語対応
- **[WebAPIゲートウェイ機能](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/01_共通機能/11_WebAPIゲートウェイ機能/)**: APIルーティングと制御

### 2. [技術者管理](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/02_技術者管理/)
技術者の基本情報・スキル・稼働状況の管理を担当するモジュール

- **技術者基本情報管理**: 技術者の基本情報CRUD操作
- **スキル管理**: 技術者のスキル情報の管理
- **稼働状況管理**: 技術者の稼働状況の管理
- **スキルシート管理**: スキルシートの生成、編集、エクスポート

### 3. [案件管理](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/03_案件管理/)
案件情報の登録・管理・検索を担当するモジュール

- **案件基本情報管理**: 案件の基本情報CRUD操作
- **案件検索**: 高度な案件検索機能
- **案件ステータス管理**: 案件のライフサイクル管理
- **案件関連情報管理**: 契約条件などの関連情報管理

### 4. [マッチング](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/04_マッチング/)
技術者と案件のマッチング機能を提供するモジュール

- **マッチング検索**: 技術者と案件のマッチング検索
- **マッチング結果管理**: マッチング結果の保存と管理
- **提案管理**: クライアントへの提案管理
- **提案書管理**: 提案書の作成と管理

### 5. [契約管理](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/05_契約管理/)
契約の作成・管理・電子署名を担当するモジュール

- **契約基本機能**: 契約情報のCRUD操作
- **契約書ドキュメント機能**: 契約書の生成と管理
- **電子署名機能**: 電子署名による契約締結
- **契約テンプレート管理機能**: 契約テンプレートの管理

### 6. [勤怠工数管理](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/06_勤怠工数管理/)
勤怠入力・承認・工数管理を担当するモジュール

- **勤怠管理機能**: 勤怠情報の入力と管理
- **工数管理機能**: 工数情報の入力と管理
- **承認管理機能**: 勤怠・工数の承認ワークフロー
- **集計レポート機能**: 勤怠・工数の集計と分析

### 7. [請求支払管理](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/07_請求支払管理/)
請求書発行・入金管理・支払処理を担当するモジュール

- **請求管理機能**: 請求情報の管理
- **請求書管理機能**: 請求書の作成と管理
- **支払管理機能**: 支払情報の管理
- **入金管理機能**: 入金情報の記録と管理
- **請求支払レポート機能**: 請求・支払の分析とレポート

### 8. [レポーティング](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/02_モジュール/08_レポーティング/)
各種レポート・ダッシュボードを提供するモジュール

- **KPIダッシュボード機能**: 主要指標のダッシュボード
- **レポート管理機能**: レポートの作成と管理
- **データ収集機能**: レポート用データの収集
- **予測分析機能**: 売上予測などの分析機能
- **カスタムレポート機能**: ユーザー定義レポート

## 実装方針

### レイヤードアーキテクチャ

各モジュールは以下の層構造で実装します：

1. **プレゼンテーション層**
   - Webコントローラー（Thymeleaf用）
   - RESTコントローラー（API用）
   - DTOクラス（データ転送オブジェクト）
   - バリデーター（入力検証）

2. **ビジネス層**
   - サービスクラス（業務ロジック）
   - ドメインモデル（ビジネスエンティティ）
   - ファクトリークラス（オブジェクト生成）
   - バリデーションロジック（業務ルール検証）

3. **データアクセス層**
   - リポジトリインターフェース
   - エンティティクラス（DB対応モデル）
   - DAOクラス（必要に応じて）
   - クエリビルダー

詳細な実装方針は[アーキテクチャ決定記録（ADR）](https://fcircle-biz.github.io/ses_mgr/03_詳細設計/08_ADR/adr-001-レイヤードアーキテクチャ採用.md)を参照してください。

### パッケージ構成

各モジュールのパッケージ構成は以下の命名規則に従います：

```
com.example.sesapp.[module].[layer].[component]
```

例：
- `com.example.sesapp.engineer.controller`
- `com.example.sesapp.engineer.service`
- `com.example.sesapp.engineer.repository`
- `com.example.sesapp.engineer.domain`
- `com.example.sesapp.engineer.dto`

### 依存関係の方針

モジュール間の依存関係は以下の原則に従います：

1. **疎結合の原則**
   - モジュール間の依存は最小限に抑える
   - インターフェースを通じた連携を基本とする
   - 共通機能モジュールには他のビジネスモジュールへの依存を持たせない

2. **依存方向の制約**
   - ビジネスモジュール → 共通機能モジュール の依存は許可
   - 共通機能モジュール → ビジネスモジュール の依存は禁止
   - 同レベルのビジネスモジュール間の直接依存は極力避け、必要な場合はインターフェースを介する

3. **循環依存の回避**
   - モジュール間の循環依存を絶対に作らない
   - 相互依存が必要な場合はイベント駆動アーキテクチャを採用

### 共通コーディング規約

すべてのモジュールは以下のコーディング規約に従います：

1. **命名規則**
   - クラス名: PascalCase（例: EngineerService）
   - メソッド名: camelCase（例: findBySkillId）
   - 変数名: camelCase（例: skillList）
   - 定数名: UPPER_SNAKE_CASE（例: MAX_RETRY_COUNT）
   - パッケージ名: ドットで区切られた小文字（例: com.example.sesapp.engineer）

2. **例外処理**
   - 業務例外とシステム例外を明確に区別
   - チェック例外は実装/技術エラー用、非チェック例外はビジネスルール違反用
   - 例外は適切なレベルでキャッチし、上位層に適切に変換して伝播

3. **コメント**
   - パブリックAPIには必ずJavaDocコメントを記載
   - 複雑なロジックには説明コメントを付与
   - TODO/FIXMEコメントには必ず課題管理システムのID参照を含める

4. **ユニットテスト**
   - 各クラスに対応するテストクラスを作成
   - ビジネスロジックは100%のテストカバレッジを目指す
   - モック/スタブを活用して依存コンポーネントを分離

## 各モジュールの設計詳細

各モジュールの詳細設計は、対応するサブディレクトリ内のドキュメントを参照してください。各モジュール設計書は以下の内容を含みます：

1. **概要**
   - 目的と機能範囲
   - 関連モジュールとの連携ポイント

2. **コンポーネント構成**
   - コントローラー
   - サービス
   - リポジトリ
   - ドメインモデル/エンティティ
   - DTOとバリデーション

3. **主要処理フロー**
   - シーケンス図による処理フロー
   - API通信シーケンス
   - 異常系の処理

4. **特記事項**
   - 実装上の注意点
   - パフォーマンス考慮点
   - テストの観点

## トレーサビリティ

各詳細設計は基本設計との相互トレーサビリティを確保しています。詳細設計書内には、対応する基本設計書へのリンクが含まれており、要件から基本設計、詳細設計への追跡が可能です。