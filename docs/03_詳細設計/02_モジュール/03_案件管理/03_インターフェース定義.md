# 案件管理モジュール インターフェース定義

## 1. インターフェース概要

案件管理モジュールは、案件の基本情報管理、検索、ステータス管理、関連情報管理の機能を他モジュールに提供します。これらのインターフェースにより、マッチングや契約管理などの他モジュールは案件情報を活用した業務機能を実現できます。また、案件管理モジュール自身は認証・認可、ファイル管理、通知機能などのサービスを他モジュールから利用します。

## 2. 提供インターフェース

案件管理モジュールが他のモジュールに提供するインターフェースを定義します。

### 2.1 案件基本情報サービス (ProjectService)

案件の基本情報を操作するためのサービスインターフェースです。

#### 目的と責務
案件の基本情報の登録・更新・参照・検索機能を提供します。

#### 使用コンテキスト
- 営業担当者による案件情報の登録・更新
- マッチング担当者による案件情報の参照
- 契約管理における案件情報の参照
- 請求管理における案件情報の参照

```
public interface ProjectService {
    // 案件情報の取得
    ProjectDTO getProject(Long projectId);
    
    // 案件情報の登録
    Long registerProject(ProjectRegistrationDTO project);
    
    // 案件情報の更新
    void updateProject(ProjectUpdateDTO project);
    
    // 案件情報の論理削除
    void deleteProject(Long projectId);
    
    // 指定された条件に基づいて案件情報のリストを取得
    Page<ProjectSummaryDTO> listProjects(ProjectFilterDTO filter, Pageable pageable);
    
    // 案件IDの一覧から案件情報のリストを取得
    List<ProjectDTO> getProjectsByIds(List<Long> projectIds);
    
    // 特定の顧客の案件リストを取得
    List<ProjectSummaryDTO> getProjectsByCustomer(Long customerId);
    
    // 案件コードから案件情報を取得
    ProjectDTO getProjectByCode(String projectCode);
}
```

#### データ転送オブジェクト

**ProjectDTO**
```
public class ProjectDTO {
    private Long projectId;
    private String projectCode;
    private String projectName;
    private Long customerId;
    private String customerName;
    private Long customerDepartmentId;
    private String customerDepartmentName;
    private String description;
    private ProjectTypeEnum projectType;
    private ProjectCategoryEnum projectCategory;
    private LocalDate startDate;
    private LocalDate endDate;
    private String workLocation;
    private WorkStyleEnum workStyle;
    private Long statusId;
    private String statusName;
    private PriorityEnum priority;
    private ConfidentialLevelEnum confidentialLevel;
    private Boolean isPublic;
    private Long salesRepId;
    private String salesRepName;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    
    // getters and setters
}
```

**ProjectRegistrationDTO**
```
public class ProjectRegistrationDTO {
    private String projectName;
    private Long customerId;
    private Long customerDepartmentId;
    private String description;
    private ProjectTypeEnum projectType;
    private ProjectCategoryEnum projectCategory;
    private LocalDate startDate;
    private LocalDate endDate;
    private String workLocation;
    private WorkStyleEnum workStyle;
    private Long statusId;
    private PriorityEnum priority;
    private ConfidentialLevelEnum confidentialLevel;
    private Boolean isPublic;
    private Long salesRepId;
    
    // getters and setters
}
```

**ProjectUpdateDTO**
```
public class ProjectUpdateDTO {
    private Long projectId;
    private String projectName;
    private Long customerId;
    private Long customerDepartmentId;
    private String description;
    private ProjectTypeEnum projectType;
    private ProjectCategoryEnum projectCategory;
    private LocalDate startDate;
    private LocalDate endDate;
    private String workLocation;
    private WorkStyleEnum workStyle;
    private Long statusId;
    private PriorityEnum priority;
    private ConfidentialLevelEnum confidentialLevel;
    private Boolean isPublic;
    private Long salesRepId;
    
    // getters and setters
}
```

**ProjectSummaryDTO**
```
public class ProjectSummaryDTO {
    private Long projectId;
    private String projectCode;
    private String projectName;
    private String customerName;
    private ProjectTypeEnum projectType;
    private LocalDate startDate;
    private LocalDate endDate;
    private String statusName;
    private PriorityEnum priority;
    private String salesRepName;
    
    // getters and setters
}
```

**ProjectFilterDTO**
```
public class ProjectFilterDTO {
    private String keyword;
    private List<ProjectTypeEnum> projectTypes;
    private List<ProjectCategoryEnum> projectCategories;
    private List<Long> statusIds;
    private List<Long> customerIds;
    private LocalDate startDateFrom;
    private LocalDate startDateTo;
    private LocalDate endDateFrom;
    private LocalDate endDateTo;
    private List<String> workLocations;
    private List<WorkStyleEnum> workStyles;
    private List<PriorityEnum> priorities;
    private List<Long> salesRepIds;
    private Boolean onlyPublic;
    
    // getters and setters
}
```

#### 非機能要件

- **パフォーマンス**：
  - getProject()：レスポンスタイム 100ms以内
  - listProjects()：100件あたり 500ms以内
  - その他メソッド：1秒以内

- **トランザクション**：
  - registerProject()、updateProject()、deleteProject()はトランザクション管理されます
  - 参照系メソッドはトランザクションの読み取り専用として実行されます

- **セキュリティ**：
  - 全メソッドはユーザー認証が必要
  - リソースへのアクセスは認可サービスによる権限チェックあり
  - isPublic=falseの案件は特定の権限を持つユーザーのみアクセス可能

- **使用コンテキスト**：
  - 案件の登録・更新・照会の際に利用
  - マッチング時の案件情報参照に利用
  - 契約管理時の案件情報参照に利用

### 2.2 案件検索サービス (ProjectQueryService)

案件を高度な条件で検索するためのサービスインターフェースです。

#### 目的と責務
スキル要件、期間、予算などの複合条件に基づいた高度な案件検索機能を提供します。

#### 使用コンテキスト
- マッチング担当者による技術者に適した案件の検索
- 営業担当者による顧客要件に近い案件の検索
- レポーティングにおける案件分析
- 検索条件の保存と再利用による業務効率化

```
public interface ProjectQueryService {
    // 複合条件に基づく高度な案件検索
    Page<ProjectSummaryDTO> findProjects(ProjectSearchCriteriaDTO searchCriteria, Pageable pageable);
    
    // キーワードベースの案件検索
    Page<ProjectSummaryDTO> searchProjectsByKeyword(String keyword, Pageable pageable);
    
    // スキル要件に基づく案件検索
    Page<ProjectSummaryDTO> findProjectsBySkillRequirements(List<SkillRequirementCriteriaDTO> skillCriteria, Pageable pageable);
    
    // 期間条件に基づく案件検索
    Page<ProjectSummaryDTO> findProjectsByPeriod(LocalDate fromDate, LocalDate toDate, Pageable pageable);
    
    // 検索条件の保存
    Long saveSearchCriteria(SavedSearchDTO savedSearch);
    
    // 保存済み検索条件のロード
    SavedSearchDTO getSavedSearch(Long savedSearchId);
    
    // ユーザーの保存済み検索条件一覧の取得
    List<SavedSearchSummaryDTO> listSavedSearches(Long userId);
}
```

#### データ転送オブジェクト

**ProjectSearchCriteriaDTO**
```
public class ProjectSearchCriteriaDTO {
    private ProjectFilterDTO basicFilter;
    private List<SkillRequirementCriteriaDTO> skillRequirements;
    private BudgetRangeDTO budgetRange;
    private Boolean requiresResources;
    private Integer minRequiredResources;
    private Integer maxRequiredResources;
    
    // getters and setters
}
```

**SkillRequirementCriteriaDTO**
```
public class SkillRequirementCriteriaDTO {
    private Long skillDefinitionId;
    private Integer minimumLevel;
    private Boolean isRequired;
    
    // getters and setters
}
```

**BudgetRangeDTO**
```
public class BudgetRangeDTO {
    private BigDecimal minAmount;
    private BigDecimal maxAmount;
    private CurrencyEnum currency;
    private BudgetTypeEnum budgetType;
    
    // getters and setters
}
```

**SavedSearchDTO**
```
public class SavedSearchDTO {
    private Long savedSearchId;
    private String searchName;
    private String description;
    private Long userId;
    private ProjectSearchCriteriaDTO searchCriteria;
    private Boolean isPublic;
    private LocalDateTime createdAt;
    
    // getters and setters
}
```

**SavedSearchSummaryDTO**
```
public class SavedSearchSummaryDTO {
    private Long savedSearchId;
    private String searchName;
    private String description;
    private Boolean isPublic;
    private LocalDateTime createdAt;
    private LocalDateTime lastUsedAt;
    
    // getters and setters
}
```

#### 非機能要件

- **パフォーマンス**：
  - 検索メソッド：複雑な検索条件でも3秒以内
  - 保存済み検索関連：1秒以内

- **キャッシング**：
  - 頻繁に使用される検索結果やマスタデータはキャッシュされます
  - キャッシュの有効期間：マスタデータは1時間、検索結果は15分

- **セキュリティ**：
  - 全メソッドはユーザー認証が必要
  - 保存済み検索条件は作成者のみが編集可能
  - 公開フラグが付いた検索条件のみ他ユーザーが閲覧可能

### 2.3 案件ステータス管理サービス (ProjectStatusService)

案件のステータスを管理するためのサービスインターフェースです。

#### 目的と責務
案件のライフサイクル管理、ステータス遷移制御、ステータス履歴管理の機能を提供します。

#### 使用コンテキスト
- 営業担当者による案件ステータスの更新
- 管理者による案件進捗状況の確認
- マッチングや契約プロセスでの状態連携
- イベント通知によるステータス変更の伝達

```
public interface ProjectStatusService {
    // 案件のステータス変更
    void changeProjectStatus(ProjectStatusChangeDTO statusChange);
    
    // ステータス変更の検証
    boolean validateStatusChange(Long projectId, Long newStatusId);
    
    // 次に遷移可能なステータス一覧を取得
    List<ProjectStatusDTO> getAvailableNextStatuses(Long projectId);
    
    // 案件のステータス履歴取得
    List<ProjectStatusHistoryDTO> getStatusHistory(Long projectId);
    
    // ステータス一覧の取得
    List<ProjectStatusDTO> getAllStatuses();
    
    // ステータスIDによるステータス情報取得
    ProjectStatusDTO getStatusById(Long statusId);
    
    // ステータスコードによるステータス情報取得
    ProjectStatusDTO getStatusByCode(String statusCode);
}
```

#### データ転送オブジェクト

**ProjectStatusChangeDTO**
```
public class ProjectStatusChangeDTO {
    private Long projectId;
    private Long newStatusId;
    private String changeReason;
    
    // getters and setters
}
```

**ProjectStatusDTO**
```
public class ProjectStatusDTO {
    private Long statusId;
    private String statusCode;
    private String statusName;
    private String description;
    private Integer displayOrder;
    private Boolean isActive;
    private String color;
    private List<String> allowedNextStatusCodes;
    
    // getters and setters
}
```

**ProjectStatusHistoryDTO**
```
public class ProjectStatusHistoryDTO {
    private Long historyId;
    private Long projectId;
    private String previousStatusName;
    private String newStatusName;
    private String changeReason;
    private LocalDateTime changedAt;
    private String changedByUserName;
    
    // getters and setters
}
```

#### 非機能要件

- **パフォーマンス**：
  - ステータス変更：500ms以内
  - ステータス一覧取得：100ms以内
  - 履歴取得：300ms以内

- **トランザクション**：
  - changeProjectStatus()はトランザクション管理されます
  - ステータス変更時に案件テーブルの更新と履歴テーブルの挿入を単一トランザクションで処理

- **セキュリティ**：
  - 全メソッドはユーザー認証が必要
  - ステータス変更は権限を持つユーザーのみ実行可能
  - 特定のステータス遷移（例：「成約」→「契約締結」）は特別な権限が必要

- **通知**：
  - ステータス変更時には関係者に通知が送信されます

### 2.4 案件関連情報サービス (ProjectRelatedInfoService)

案件の関連情報（要員要件、予算、ドキュメント）を管理するためのサービスインターフェースです。

#### 目的と責務
案件に関連する要員要件、予算情報、ドキュメント、担当者情報などの付加情報の管理機能を提供します。

#### 使用コンテキスト
- 営業担当者による要員要件の登録・更新
- マッチング担当者による案件要件の参照
- 予算情報の管理による収益計画策定
- 関連ドキュメントの管理による情報共有
- 案件担当者の管理によるコミュニケーション効率化

```
public interface ProjectRelatedInfoService {
    // === 要員要件管理 ===
    
    // 要員要件の登録
    Long addResourceRequirement(ResourceRequirementDTO requirement);
    
    // 要員要件の更新
    void updateResourceRequirement(ResourceRequirementDTO requirement);
    
    // 要員要件の削除
    void deleteResourceRequirement(Long requirementId);
    
    // 案件の要員要件一覧取得
    List<ResourceRequirementDTO> getResourceRequirements(Long projectId);
    
    // 要員要件の詳細取得
    ResourceRequirementDTO getResourceRequirement(Long requirementId);
    
    // スキル要件の追加
    Long addSkillRequirement(SkillRequirementDTO skillRequirement);
    
    // スキル要件の更新
    void updateSkillRequirement(SkillRequirementDTO skillRequirement);
    
    // スキル要件の削除
    void deleteSkillRequirement(Long skillRequirementId);
    
    // 要員要件のスキル要件一覧取得
    List<SkillRequirementDTO> getSkillRequirements(Long requirementId);
    
    // === 予算情報管理 ===
    
    // 予算情報の登録
    Long addProjectBudget(ProjectBudgetDTO budget);
    
    // 予算情報の更新
    void updateProjectBudget(ProjectBudgetDTO budget);
    
    // 予算情報の削除
    void deleteProjectBudget(Long budgetId);
    
    // 案件の予算情報一覧取得
    List<ProjectBudgetDTO> getProjectBudgets(Long projectId);
    
    // 予算情報の詳細取得
    ProjectBudgetDTO getProjectBudget(Long budgetId);
    
    // === ドキュメント管理 ===
    
    // ドキュメントの登録
    Long addProjectDocument(ProjectDocumentDTO document);
    
    // ドキュメントの更新
    void updateProjectDocument(ProjectDocumentDTO document);
    
    // ドキュメントの削除
    void deleteProjectDocument(Long documentId);
    
    // 案件のドキュメント一覧取得
    List<ProjectDocumentDTO> getProjectDocuments(Long projectId);
    
    // ドキュメントの詳細取得
    ProjectDocumentDTO getProjectDocument(Long documentId);
    
    // ドキュメント種別による一覧取得
    List<ProjectDocumentDTO> getProjectDocumentsByType(Long projectId, DocumentTypeEnum documentType);
    
    // === 案件担当者管理 ===
    
    // 担当者の追加
    Long addProjectMember(ProjectMemberDTO member);
    
    // 担当者の更新
    void updateProjectMember(ProjectMemberDTO member);
    
    // 担当者の削除
    void deleteProjectMember(Long memberId);
    
    // 案件の担当者一覧取得
    List<ProjectMemberDTO> getProjectMembers(Long projectId);
    
    // 担当者の詳細取得
    ProjectMemberDTO getProjectMember(Long memberId);
    
    // 役割タイプによる担当者取得
    List<ProjectMemberDTO> getProjectMembersByRole(Long projectId, ProjectRoleTypeEnum roleType);
}
```

#### データ転送オブジェクト

**ResourceRequirementDTO**
```
public class ResourceRequirementDTO {
    private Long requirementId;
    private Long projectId;
    private String positionName;
    private Integer requiredNumber;
    private JobTypeEnum jobType;
    private Integer minimumExperience;
    private Integer preferredExperience;
    private String description;
    private PriorityEnum priority;
    private Boolean isRequired;
    private RequirementStatusEnum status;
    private Long assignedEngineerId;
    private String assignedEngineerName;
    
    // getters and setters
}
```

**SkillRequirementDTO**
```
public class SkillRequirementDTO {
    private Long skillRequirementId;
    private Long resourceRequirementId;
    private Long skillDefinitionId;
    private String skillName;
    private String categoryName;
    private Integer minimumLevel;
    private Integer preferredLevel;
    private Boolean isRequired;
    private Integer weight;
    
    // getters and setters
}
```

**ProjectBudgetDTO**
```
public class ProjectBudgetDTO {
    private Long budgetId;
    private Long projectId;
    private BudgetTypeEnum budgetType;
    private BillingTypeEnum billingType;
    private BigDecimal amount;
    private CurrencyEnum currency;
    private BigDecimal unitAmount;
    private BigDecimal taxRate;
    private LocalDate startDate;
    private LocalDate endDate;
    private String remarks;
    private Boolean isConfidential;
    
    // getters and setters
}
```

**ProjectDocumentDTO**
```
public class ProjectDocumentDTO {
    private Long documentId;
    private Long projectId;
    private DocumentTypeEnum documentType;
    private String title;
    private String description;
    private Long fileId;
    private String fileName;
    private Long fileSize;
    private String fileType;
    private String version;
    private Boolean isConfidential;
    private Boolean isActive;
    private String createdByUserName;
    private LocalDateTime createdAt;
    
    // getters and setters
}
```

**ProjectMemberDTO**
```
public class ProjectMemberDTO {
    private Long memberId;
    private Long projectId;
    private Long userId;
    private String userName;
    private String userEmail;
    private ProjectRoleTypeEnum roleType;
    private Boolean isMainContact;
    private LocalDate startDate;
    private LocalDate endDate;
    private String remarks;
    private Boolean isActive;
    
    // getters and setters
}
```

#### 非機能要件

- **パフォーマンス**：
  - 要員要件、予算情報、ドキュメント、担当者の取得：200ms以内
  - 更新系操作：500ms以内

- **トランザクション**：
  - 更新系メソッドはすべてトランザクション管理されます
  - 要員要件とスキル要件の追加は単一トランザクションで処理

- **セキュリティ**：
  - 全メソッドはユーザー認証が必要
  - 機密フラグのある予算情報やドキュメントは特別な権限を持つユーザーのみアクセス可能
  - ドキュメント操作はログに詳細に記録

- **ストレージ**：
  - ドキュメントファイルは共通のファイルストレージサービスで管理
  - ファイルのアクセス制御は案件の機密レベルに準拠

## 3. 要求インターフェース

案件管理モジュールが他のモジュールに要求するインターフェースを定義します。

### 3.1 認証サービス (AuthenticationService)

#### 目的と使用文脈
ユーザー認証を行うためのインターフェースです。案件管理モジュールの全ての機能は認証済みユーザーによってのみ利用可能であり、このインターフェースを用いてユーザーの認証状態を確認します。共通機能モジュールから提供されます。

```
public interface AuthenticationService {
    // ユーザー認証情報の検証
    AuthenticationResult authenticate(String token);
    
    // 認証情報のリフレッシュ
    String refreshToken(String refreshToken);
}
```

### 3.2 認可サービス (AuthorizationService)

#### 目的と使用文脈
ユーザー権限管理を行うためのインターフェースです。案件情報や案件関連情報の参照・更新などの各操作に対して、ユーザーが適切な権限を持っているかを確認します。特に機密情報（予算情報など）へのアクセス制御に重要です。共通機能モジュールから提供されます。

```
public interface AuthorizationService {
    // リソースへのアクセス権限チェック
    boolean hasPermission(Long userId, String resource, String action);
    
    // ロールの取得
    List<String> getUserRoles(Long userId);
    
    // 機密レベルに対するアクセス権限チェック
    boolean hasConfidentialAccess(Long userId, ConfidentialLevelEnum level);
}
```

### 3.3 顧客サービス (CustomerService)

#### 目的と使用文脈
顧客情報の管理を行うためのインターフェースです。案件登録・更新時の顧客情報参照や顧客部署情報の取得、案件検索時の顧客情報との関連付けに利用します。案件管理モジュール内から提供されます。

```
public interface CustomerService {
    // 顧客情報の取得
    CustomerDTO getCustomer(Long customerId);
    
    // 顧客一覧の取得
    List<CustomerSummaryDTO> listActiveCustomers();
    
    // 顧客部署の取得
    CustomerDepartmentDTO getCustomerDepartment(Long departmentId);
    
    // 顧客の部署一覧取得
    List<CustomerDepartmentDTO> getCustomerDepartments(Long customerId);
}
```

### 3.4 ファイルストレージサービス (FileStorageService)

#### 目的と使用文脈
ファイルの保存と取得を行うためのインターフェースです。案件関連ドキュメント（RFP、仕様書、契約書ドラフトなど）の保存・取得・削除に利用します。ファイルのメタデータ管理とアクセス制御も含みます。共通機能モジュールから提供されます。

```
public interface FileStorageService {
    // ファイルの保存
    Long saveFile(FileUploadDTO fileUpload);
    
    // ファイルの取得
    FileDownloadDTO getFile(Long fileId);
    
    // ファイルの削除
    void deleteFile(Long fileId);
    
    // ファイルメタデータの取得
    FileMetadataDTO getFileMetadata(Long fileId);
}
```

### 3.5 通知サービス (NotificationService)

#### 目的と使用文脈
ユーザーへの通知を行うためのインターフェースです。案件ステータス変更時の関係者への通知、重要な案件更新の通知、締切日の接近通知など、案件の状態変化や重要なイベントをシステム内通知やメールで関係者に伝達する際に利用します。共通機能モジュールから提供されます。

```
public interface NotificationService {
    // 通知の送信
    void sendNotification(NotificationDTO notification);
    
    // メールの送信
    void sendEmail(EmailDTO email);
    
    // 複数ユーザーへの通知送信
    void sendNotificationToUsers(NotificationDTO notification, List<Long> userIds);
    
    // 案件関係者全員への通知
    void sendNotificationToProjectMembers(NotificationDTO notification, Long projectId);
}
```

### 3.6 コード値管理サービス (CodeValueService)

#### 目的と使用文脈
コード値の管理を行うためのインターフェースです。案件区分、案件種別、ステータス、予算種別などのマスタデータを参照する際に利用します。これにより、マスタデータの一元管理と整合性維持を実現します。共通機能モジュールから提供されます。

```
public interface CodeValueService {
    // コード値一覧の取得
    List<CodeValueDTO> getCodeValues(String categoryCode);
    
    // コード値の詳細取得
    CodeValueDTO getCodeValue(String categoryCode, String codeValue);
}
```

### 3.7 ロギングサービス (LoggingService)

#### 目的と使用文脈
操作ログと監査ログを記録するためのインターフェースです。案件情報の更新、ステータス変更、予算情報の変更など、重要な操作やセキュリティ関連の操作を記録する際に利用します。特に機密情報へのアクセスや変更は詳細に記録されます。共通機能モジュールから提供されます。

```
public interface LoggingService {
    // 操作ログの記録
    void logOperation(OperationLogDTO log);
    
    // 監査ログの記録
    void logAudit(AuditLogDTO log);
    
    // セキュリティログの記録
    void logSecurity(SecurityLogDTO log);
}
```

## 4. データ交換モデル

案件管理モジュールが提供および要求するインターフェースで使用されるデータ交換モデル（DTO）を定義します。

### 4.1 案件基本情報モデル

- **ProjectDTO**: 案件の詳細情報を表すDTO
- **ProjectRegistrationDTO**: 案件登録時に使用するDTO
- **ProjectUpdateDTO**: 案件更新時に使用するDTO
- **ProjectSummaryDTO**: 案件の概要情報を表すDTO
- **ProjectFilterDTO**: 案件検索条件を表すDTO

### 4.2 検索関連モデル

- **ProjectSearchCriteriaDTO**: 高度な案件検索条件を表すDTO
- **SkillRequirementCriteriaDTO**: スキル要件検索条件を表すDTO
- **BudgetRangeDTO**: 予算範囲条件を表すDTO
- **SavedSearchDTO**: 保存済み検索条件を表すDTO
- **SavedSearchSummaryDTO**: 保存済み検索条件の概要を表すDTO

### 4.3 ステータス関連モデル

- **ProjectStatusChangeDTO**: ステータス変更情報を表すDTO
- **ProjectStatusDTO**: ステータス情報を表すDTO
- **ProjectStatusHistoryDTO**: ステータス変更履歴を表すDTO

### 4.4 関連情報モデル

- **ResourceRequirementDTO**: 要員要件情報を表すDTO
- **SkillRequirementDTO**: スキル要件情報を表すDTO
- **ProjectBudgetDTO**: 予算情報を表すDTO
- **ProjectDocumentDTO**: ドキュメント情報を表すDTO
- **ProjectMemberDTO**: 案件担当者情報を表すDTO

### 4.5 共通モデル

- **MoneyDTO**: 金額情報を表すDTO
- **FileMetadataDTO**: ファイルメタデータを表すDTO
- **AddressDTO**: 住所情報を表すDTO

## 5. イベント定義

案件管理モジュールが発行および購読するイベントを定義します。

### 5.1 発行イベント

#### 案件登録イベント (ProjectRegisteredEvent)
```
public class ProjectRegisteredEvent {
    private Long projectId;
    private String projectCode;
    private String projectName;
    private Long customerId;
    private LocalDate startDate;
    private LocalDate endDate;
    private ProjectTypeEnum projectType;
    private LocalDateTime registeredAt;
    
    // getters and setters
}
```

#### 案件更新イベント (ProjectUpdatedEvent)
```
public class ProjectUpdatedEvent {
    private Long projectId;
    private Set<String> updatedFields;
    private LocalDateTime updatedAt;
    
    // getters and setters
}
```

#### 案件ステータス変更イベント (ProjectStatusChangedEvent)
```
public class ProjectStatusChangedEvent {
    private Long projectId;
    private String projectName;
    private String previousStatusCode;
    private String previousStatusName;
    private String newStatusCode;
    private String newStatusName;
    private String changeReason;
    private Long changedBy;
    private LocalDateTime changedAt;
    
    // getters and setters
}
```

#### 要員要件追加イベント (ResourceRequirementAddedEvent)
```
public class ResourceRequirementAddedEvent {
    private Long requirementId;
    private Long projectId;
    private String projectName;
    private String positionName;
    private Integer requiredNumber;
    private JobTypeEnum jobType;
    private LocalDateTime addedAt;
    
    // getters and setters
}
```

#### 要員要件ステータス変更イベント (RequirementStatusChangedEvent)
```
public class RequirementStatusChangedEvent {
    private Long requirementId;
    private Long projectId;
    private String positionName;
    private RequirementStatusEnum previousStatus;
    private RequirementStatusEnum newStatus;
    private Long changedBy;
    private LocalDateTime changedAt;
    
    // getters and setters
}
```

### 5.2 購読イベント

#### 技術者アサインイベント (EngineerAssignedEvent)
```
public class EngineerAssignedEvent {
    private Long engineerId;
    private String engineerName;
    private Long projectId;
    private Long requirementId;
    private LocalDate startDate;
    private LocalDate endDate;
    private Long assignedBy;
    private LocalDateTime assignedAt;
    
    // getters and setters
}
```

#### マッチング成立イベント (MatchingConfirmedEvent)
```
public class MatchingConfirmedEvent {
    private Long matchingId;
    private Long projectId;
    private Long engineerId;
    private Long requirementId;
    private LocalDate startDate;
    private LocalDate endDate;
    private LocalDateTime confirmedAt;
    
    // getters and setters
}
```

#### 契約締結イベント (ContractSignedEvent)
```
public class ContractSignedEvent {
    private Long contractId;
    private Long projectId;
    private String contractCode;
    private LocalDate contractDate;
    private LocalDate startDate;
    private LocalDate endDate;
    private LocalDateTime signedAt;
    
    // getters and setters
}
```

## 6. 非機能要件

案件管理モジュール全体に関する非機能要件を定義します。

### 6.1 パフォーマンス要件

- API応答時間：
  - 参照系API: 平均応答時間 500ms以内
  - 更新系API: 平均応答時間 1秒以内
  - 一括処理API: 平均応答時間 3秒以内
  - 検索API: 平均応答時間 3秒以内（複雑な条件でも）

- スケーラビリティ:
  - 同時アクセスユーザー数: 最大50ユーザー
  - 案件データ件数: 最大10,000件
  - 要員要件データ件数: 最大30,000件（案件×要員）
  - ドキュメント件数: 最大50,000件

### 6.2 可用性要件

- 稼働時間: 24時間365日
- 計画メンテナンス時間: 月1回、深夜2時間以内
- 目標稼働率: 99.9%
- 障害復旧時間（RTO）: 2時間以内
- データ復旧時点（RPO）: 5分以内

### 6.3 セキュリティ要件

- 認証: すべてのAPIアクセスでJWTによるトークン認証を実施
- 認可: リソースへのアクセスは権限ベースのアクセス制御（RBAC）により制限
- 監査: 重要なデータ操作はすべて監査ログに記録
- データ保護:
  - 機密情報（予算情報など）は保存時に暗号化
  - 機密レベルに応じたアクセス制御
  - 案件の公開/非公開設定による可視性制御

### 6.4 耐障害性

- 一時的なネットワーク障害に対して自動リトライ機能を実装
- 外部サービス障害時のフォールバック動作を定義
- 重要な操作（ステータス変更など）のタイムアウト処理と再実行メカニズム

### 6.5 トランザクション

- 更新系操作はすべてACID属性を持つトランザクションで管理
- 複数リソースにまたがる操作はサガパターンもしくは分散トランザクションで整合性を確保
- 楽観的ロックによる同時更新競合の検出と解決

### 6.6 キャッシング

- マスタデータ（ステータス、コード値等）はアプリケーションキャッシュで高速化
- キャッシュの有効期間:
  - ステータス定義: 60分
  - コード値: 60分
  - 顧客情報: 15分
  - 検索結果: 5分

### 6.7 監視

- API応答時間の監視とアラート設定
- エラー率の監視とアラート設定
- リソース使用率（CPU、メモリ、ディスク）の監視
- バッチ処理の完了状態監視

### 6.8 バックアップ

- 日次フルバックアップ
- 差分バックアップ（1時間ごと）
- トランザクションログのバックアップ（5分ごと）
- バックアップデータのオフサイト保管