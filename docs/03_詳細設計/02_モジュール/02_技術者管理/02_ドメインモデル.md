# 技術者管理モジュール ドメインモデル

## 1. エンティティ

### 1.1 技術者 (Engineer)

技術者エンティティは、SES事業の中核となる人的リソースを表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| engineerId | Long | 技術者ID | 主キー、自動採番 |
| employeeCode | String | 社員コード | 必須、一意 |
| companyId | Long | 所属会社ID | FK(companies)、必須 |
| departmentId | Long | 所属部署ID | FK(departments)、必須 |
| lastName | String | 姓 | 必須、100文字以内 |
| firstName | String | 名 | 必須、100文字以内 |
| lastNameKana | String | 姓（カナ） | 必須、100文字以内 |
| firstNameKana | String | 名（カナ） | 必須、100文字以内 |
| gender | Gender | 性別 | 必須（列挙型） |
| birthDate | Date | 生年月日 | 必須 |
| emailAddress | String | メールアドレス | 必須、メール形式 |
| phoneNumber | String | 電話番号 | 必須、電話番号形式 |
| address | Address | 住所 | 値オブジェクト |
| employmentType | EmploymentType | 雇用形態 | 必須（列挙型） |
| employmentStatus | EmploymentStatus | 雇用状態 | 必須（列挙型） |
| joinDate | Date | 入社日 | 必須 |
| leaveDate | Date | 退職日 | 退職時のみ必須 |
| yearsOfExperience | Integer | 経験年数 | 必須、0以上 |
| primaryJobType | JobType | 主な職種 | 必須（列挙型） |
| unitPrice | Money | 標準単金 | 必須、値オブジェクト |
| unitPriceMin | Money | 最低単金 | 任意、値オブジェクト |
| note | String | 備考 | 任意、1000文字以内 |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

**ビジネスルール：**
- 退職日は入社日より後の日付である必要がある
- 入社後に経験年数は自動的に更新される
- 標準単金は最低単金以上である必要がある
- 技術者の削除は論理削除（status変更）で行う

### 1.2 スキル定義 (SkillDefinition)

スキル定義エンティティは、システムで管理するスキル項目のマスタデータを表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| skillDefinitionId | Long | スキル定義ID | 主キー、自動採番 |
| skillCode | String | スキルコード | 必須、一意 |
| skillName | String | スキル名称 | 必須、100文字以内 |
| skillCategoryId | Long | スキルカテゴリID | FK(skill_categories)、必須 |
| description | String | 説明 | 任意、500文字以内 |
| evalCriteria | String | 評価基準 | 任意、1000文字以内 |
| isActive | Boolean | 有効フラグ | 必須、デフォルトtrue |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

### 1.3 技術者スキル (EngineerSkill)

技術者スキルエンティティは、技術者が持つ個別のスキルとそのレベルを表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| engineerSkillId | Long | 技術者スキルID | 主キー、自動採番 |
| engineerId | Long | 技術者ID | FK(engineers)、必須 |
| skillDefinitionId | Long | スキル定義ID | FK(skill_definitions)、必須 |
| skillLevel | SkillLevel | スキルレベル | 必須（列挙型:1-5） |
| experienceMonths | Integer | 経験月数 | 必須、0以上 |
| isVerified | Boolean | 検証済フラグ | 必須、デフォルトfalse |
| verifiedBy | Long | 検証者ID | 検証済の場合必須、FK(users) |
| verifiedAt | Timestamp | 検証日時 | 検証済の場合必須 |
| note | String | 備考 | 任意、500文字以内 |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

**ビジネスルール：**
- 技術者とスキル定義の組み合わせは一意である必要がある
- スキルレベルは1-5の整数で評価される
- 検証済フラグがtrueの場合、検証者と検証日時は必須

### 1.4 スキルカテゴリ (SkillCategory)

スキルカテゴリエンティティは、スキルのグループ化のためのカテゴリを表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| skillCategoryId | Long | スキルカテゴリID | 主キー、自動採番 |
| categoryCode | String | カテゴリコード | 必須、一意 |
| categoryName | String | カテゴリ名称 | 必須、100文字以内 |
| parentCategoryId | Long | 親カテゴリID | FK(skill_categories)、任意 |
| displayOrder | Integer | 表示順 | 必須、0以上 |
| description | String | 説明 | 任意、500文字以内 |
| isActive | Boolean | 有効フラグ | 必須、デフォルトtrue |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

### 1.5 資格 (Certification)

資格エンティティは、技術者が取得した資格情報を表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| certificationId | Long | 資格ID | 主キー、自動採番 |
| engineerId | Long | 技術者ID | FK(engineers)、必須 |
| certificationTypeId | Long | 資格種別ID | FK(certification_types)、必須 |
| certificationCode | String | 資格番号 | 任意、100文字以内 |
| acquisitionDate | Date | 取得日 | 必須 |
| expirationDate | Date | 有効期限 | 任意 |
| verificationStatus | VerificationStatus | 検証状態 | 必須（列挙型） |
| fileId | Long | 証明書ファイルID | FK(files)、任意 |
| note | String | 備考 | 任意、500文字以内 |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

**ビジネスルール：**
- 有効期限がある場合、取得日より後である必要がある
- 検証状態は「未検証」「検証中」「検証済」「検証失敗」のいずれか

### 1.6 技術者稼働状況 (EngineerAvailability)

技術者稼働状況エンティティは、技術者の現在および将来の稼働状況を表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| availabilityId | Long | 稼働状況ID | 主キー、自動採番 |
| engineerId | Long | 技術者ID | FK(engineers)、必須 |
| availabilityType | AvailabilityType | 稼働状況種別 | 必須（列挙型） |
| projectId | Long | 案件ID | FK(projects)、任意 |
| startDate | Date | 開始日 | 必須 |
| endDate | Date | 終了日 | 任意 |
| workRate | Integer | 稼働率 | 必須、0-100 |
| location | String | 勤務地 | 任意、100文字以内 |
| note | String | 備考 | 任意、500文字以内 |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

**ビジネスルール：**
- 終了日が指定される場合、開始日より後である必要がある
- 稼働状況種別により、必須項目が変わる（稼働中の場合はprojectIdが必須など）
- 同一技術者の稼働期間が重複する場合、稼働率の合計は100%を超えてはならない
- 有効なレコードは常に1つ以上存在する必要がある（デフォルトは「待機中」）

### 1.7 スキルシート (SkillSheet)

スキルシートエンティティは、技術者のスキルシート（職務経歴書）を表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| skillSheetId | Long | スキルシートID | 主キー、自動採番 |
| engineerId | Long | 技術者ID | FK(engineers)、必須 |
| templateId | Long | テンプレートID | FK(skill_sheet_templates)、必須 |
| version | Integer | バージョン | 必須、1以上 |
| title | String | タイトル | 必須、100文字以内 |
| content | Clob | 内容 | 必須 |
| fileId | Long | ファイルID | FK(files)、任意 |
| isPublic | Boolean | 公開フラグ | 必須、デフォルトfalse |
| approvalStatus | ApprovalStatus | 承認状態 | 必須（列挙型） |
| approvedBy | Long | 承認者ID | 承認済の場合必須、FK(users) |
| approvedAt | Timestamp | 承認日時 | 承認済の場合必須 |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

**ビジネスルール：**
- スキルシートのバージョンは技術者ごとに一意である必要がある
- 承認状態が「承認済」の場合、承認者と承認日時は必須
- 公開フラグがtrueの場合、承認状態は「承認済」である必要がある

### 1.8 職務経歴 (WorkHistory)

職務経歴エンティティは、技術者の過去の職務経歴を表現します。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| workHistoryId | Long | 職務経歴ID | 主キー、自動採番 |
| engineerId | Long | 技術者ID | FK(engineers)、必須 |
| companyName | String | 会社名 | 必須、100文字以内 |
| projectName | String | プロジェクト名 | 必須、100文字以内 |
| role | String | 役割 | 必須、100文字以内 |
| startDate | Date | 開始日 | 必須 |
| endDate | Date | 終了日 | 任意 |
| description | String | 業務内容 | 必須、1000文字以内 |
| technologies | String | 使用技術 | 任意、500文字以内 |
| teamSize | Integer | チーム規模 | 任意、1以上 |
| status | Status | レコード状態 | 必須（列挙型） |
| createdAt | Timestamp | 作成日時 | 必須、自動設定 |
| updatedAt | Timestamp | 更新日時 | 必須、自動設定 |
| createdBy | Long | 作成者ID | 必須、FK(users) |
| updatedBy | Long | 更新者ID | 必須、FK(users) |

**ビジネスルール：**
- 終了日が指定される場合、開始日より後である必要がある
- 職務経歴は新しい順に表示される

## 2. 値オブジェクト

### 2.1 住所 (Address)

住所は技術者の住所情報を表現する値オブジェクトです。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| postalCode | String | 郵便番号 | 必須、郵便番号形式 |
| prefecture | String | 都道府県 | 必須、都道府県名 |
| city | String | 市区町村 | 必須、100文字以内 |
| street | String | 町名・番地 | 必須、100文字以内 |
| building | String | 建物名・部屋番号 | 任意、100文字以内 |

### 2.2 金額 (Money)

金額は通貨付きの金額を表現する値オブジェクトです。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| amount | BigDecimal | 金額 | 必須、0以上 |
| currency | Currency | 通貨 | 必須（列挙型） |

### 2.3 スキル検索条件 (SkillSearchCriteria)

スキル検索条件は技術者検索時のスキル条件を表現する値オブジェクトです。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| skillDefinitionId | Long | スキル定義ID | 必須 |
| minimumLevel | Integer | 最低レベル | 必須、1-5 |
| minimumExperience | Integer | 最低経験月数 | 任意、0以上 |
| isRequired | Boolean | 必須フラグ | 必須、デフォルトtrue |

### 2.4 稼働検索条件 (AvailabilitySearchCriteria)

稼働検索条件は技術者検索時の稼働条件を表現する値オブジェクトです。

| 属性 | 型 | 説明 | 制約 |
|------|------|------|------|
| availabilityType | AvailabilityType | 稼働状況種別 | 任意（列挙型） |
| startDate | Date | 開始日 | 必須 |
| endDate | Date | 終了日 | 必須 |
| minimumWorkRate | Integer | 最低稼働率 | 必須、0-100 |
| locationPreference | List<String> | 希望勤務地 | 任意 |

## 3. 列挙型

### 3.1 性別 (Gender)
- MALE: 男性
- FEMALE: 女性
- OTHER: その他
- UNDISCLOSED: 未回答

### 3.2 雇用形態 (EmploymentType)
- PERMANENT: 正社員
- CONTRACT: 契約社員
- PART_TIME: パートタイム
- TEMPORARY: 派遣社員
- FREELANCE: フリーランス

### 3.3 雇用状態 (EmploymentStatus)
- ACTIVE: 在籍中
- PROBATION: 試用期間中
- LEAVE_OF_ABSENCE: 休職中
- RETIRED: 退職

### 3.4 職種 (JobType)
- PROGRAMMER: プログラマー
- SYSTEM_ENGINEER: システムエンジニア
- PROJECT_MANAGER: プロジェクトマネージャー
- INFRASTRUCTURE_ENGINEER: インフラエンジニア
- DATABASE_ENGINEER: データベースエンジニア
- NETWORK_ENGINEER: ネットワークエンジニア
- SECURITY_ENGINEER: セキュリティエンジニア
- QA_ENGINEER: QAエンジニア
- UI_UX_DESIGNER: UI/UXデザイナー
- DATA_SCIENTIST: データサイエンティスト
- DEVOPS_ENGINEER: DevOpsエンジニア
- FRONTEND_ENGINEER: フロントエンドエンジニア
- BACKEND_ENGINEER: バックエンドエンジニア
- MOBILE_ENGINEER: モバイルエンジニア
- OTHER: その他

### 3.5 スキルレベル (SkillLevel)
- LEVEL_1: 基本的な知識がある（1）
- LEVEL_2: 基本的な業務経験がある（2）
- LEVEL_3: 一人で業務遂行可能（3）
- LEVEL_4: 高度な知識と経験あり（4）
- LEVEL_5: エキスパート/指導可能（5）

### 3.6 稼働状況種別 (AvailabilityType)
- AVAILABLE: 待機中
- ASSIGNED: 稼働中
- PARTIALLY_AVAILABLE: 一部稼働可能
- TRAINING: 研修中
- LEAVE: 休暇中
- PLANNED_ASSIGNMENT: アサイン予定

### 3.7 検証状態 (VerificationStatus)
- UNVERIFIED: 未検証
- PENDING: 検証中
- VERIFIED: 検証済
- REJECTED: 検証失敗

### 3.8 承認状態 (ApprovalStatus)
- DRAFT: 下書き
- PENDING: 承認待ち
- APPROVED: 承認済
- REJECTED: 却下

### 3.9 レコード状態 (Status)
- ACTIVE: 有効
- DELETED: 削除済
- TEMPORARY: 一時的

## 4. ドメインサービス

### 4.1 技術者検索サービス (EngineerSearchService)

技術者検索サービスは、複雑な検索条件を用いて技術者を検索するためのドメインサービスです。

**主要メソッド:**
- findEngineersBySkills(List<SkillSearchCriteria> skillCriteria)
- findEngineersByAvailability(AvailabilitySearchCriteria availabilityCriteria)
- findEngineersByCompoundCriteria(EngineerSearchCriteria criteria)

### 4.2 スキル評価サービス (SkillEvaluationService)

スキル評価サービスは、技術者のスキルを評価・検証するためのドメインサービスです。

**主要メソッド:**
- evaluateSkill(EngineerSkill skill, User evaluator)
- verifySkill(EngineerSkill skill, User verifier)
- recalculateSkillLevel(Engineer engineer, SkillDefinition skillDefinition)

### 4.3 稼働状況管理サービス (AvailabilityManagementService)

稼働状況管理サービスは、技術者の稼働状況を管理するためのドメインサービスです。

**主要メソッド:**
- updateAvailability(Engineer engineer, EngineerAvailability availability)
- checkAvailabilityConflicts(EngineerAvailability availability)
- getAvailabilityCalendar(Engineer engineer, YearMonth month)
- calculateUtilizationRate(List<Engineer> engineers, YearMonth month)

### 4.4 スキルシート生成サービス (SkillSheetGenerationService)

スキルシート生成サービスは、技術者のスキルシートを生成するためのドメインサービスです。

**主要メソッド:**
- generateSkillSheet(Engineer engineer, SkillSheetTemplate template)
- exportSkillSheetToPdf(SkillSheet skillSheet)
- exportSkillSheetToWord(SkillSheet skillSheet)
- approveSkillSheet(SkillSheet skillSheet, User approver)

## 5. 集約

技術者管理モジュールでは、以下の集約を定義します。

### 5.1 技術者集約

技術者を中心とした集約で、技術者の基本情報とそれに関連する情報をまとめます。

**ルート：** 技術者 (Engineer)
**含まれるエンティティ：**
- 技術者スキル (EngineerSkill)
- 資格 (Certification)
- 職務経歴 (WorkHistory)

### 5.2 稼働状況集約

技術者の稼働状況を中心とした集約です。

**ルート：** 技術者稼働状況 (EngineerAvailability)

### 5.3 スキルシート集約

スキルシートを中心とした集約です。

**ルート：** スキルシート (SkillSheet)

### 5.4 スキル定義集約

スキル定義を中心とした集約です。

**ルート：** スキル定義 (SkillDefinition)
**含まれるエンティティ：**
- スキルカテゴリ (SkillCategory)

## 6. ドメインイベント

### 6.1 技術者登録イベント (EngineerRegisteredEvent)

新しい技術者が登録された際に発行されるイベントです。

**属性:**
- engineerId: 登録された技術者のID
- timestamp: イベント発生時刻

### 6.2 スキル更新イベント (EngineerSkillUpdatedEvent)

技術者のスキルが更新された際に発行されるイベントです。

**属性:**
- engineerId: 技術者ID
- skillDefinitionId: 更新されたスキル定義ID
- oldSkillLevel: 更新前のスキルレベル
- newSkillLevel: 更新後のスキルレベル
- timestamp: イベント発生時刻

### 6.3 稼働状況変更イベント (AvailabilityChangedEvent)

技術者の稼働状況が変更された際に発行されるイベントです。

**属性:**
- engineerId: 技術者ID
- oldAvailabilityType: 変更前の稼働状況種別
- newAvailabilityType: 変更後の稼働状況種別
- startDate: 開始日
- projectId: 案件ID（該当する場合）
- timestamp: イベント発生時刻

### 6.4 スキルシート承認イベント (SkillSheetApprovedEvent)

スキルシートが承認された際に発行されるイベントです。

**属性:**
- skillSheetId: スキルシートID
- engineerId: 技術者ID
- approverId: 承認者ID
- version: スキルシートのバージョン
- timestamp: イベント発生時刻