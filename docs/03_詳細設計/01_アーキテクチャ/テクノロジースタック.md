# SES業務システム テクノロジースタック詳細

## 1. 概要

本ドキュメントでは、SES業務システムで採用する技術スタックの詳細を定義します。技術選定の理由、バージョン、主要な特徴、および利用方針について説明します。

## 2. バックエンド技術スタック

### 2.1 Java

- **採用バージョン**: Java 21 LTS
- **選定理由**:
  - 最新の長期サポート（LTS）バージョンによる安定性
  - 最新の言語機能（レコード、パターンマッチング、仮想スレッド等）
  - Spring Boot 3.xとの互換性
  - 広い開発者エコシステムと豊富なライブラリ
  - プロジェクト・ランバル機能による開発効率向上
- **使用方針**:
  - 全モジュールを Java 21 で統一的に実装
  - モダンな言語機能を積極的に活用

### 2.2 Spring Framework

- **採用バージョン**: Spring Boot 3.2.x
- **主要コンポーネント**:
  - Spring MVC: Webアプリケーションフレームワーク
  - Spring Data JDBC: データアクセス層
  - Spring Security: 認証・認可
  - Spring Validation: バリデーション
  - Spring Cache: キャッシュ抽象化
  - Spring Actuator: 運用監視
  - Spring AOP: アスペクト指向プログラミング
- **選定理由**:
  - 高度な依存性注入とアスペクト指向プログラミング
  - 広範なエコシステムとコミュニティサポート
  - エンタープライズでの豊富な実績
  - 宣言的なトランザクション管理
  - Jakarta EE 10対応
- **使用方針**:
  - アノテーションベースの設定を基本とする
  - 必要に応じてJava/Kotlinベースの設定も使用
  - ボイラープレートコードの削減と標準パターンの適用

### 2.3 データアクセス

- **採用技術**: Spring Data JDBC
- **補助ライブラリ**:
  - QueryDSL: 型安全なクエリビルダー
  - Flyway: データベースマイグレーション
- **選定理由**:
  - JPA/Hibernateと比較して軽量かつシンプル
  - N+1問題の回避が容易
  - 明示的なデータアクセスパターン
  - オブジェクトのライフサイクル管理が容易
  - クエリのパフォーマンス最適化が容易
- **使用方針**:
  - リポジトリインターフェースによるデータアクセス抽象化
  - 集約ルート（Aggregate Root）パターンの適用
  - 複雑なクエリには`@Query`アノテーションまたはQueryDSLを使用
  - ページネーション処理の標準化

### 2.4 データベース

- **採用技術**: PostgreSQL 17
- **選定理由**:
  - オープンソースで広く採用されているRDBMS
  - 豊富な機能（JSON型、全文検索、地理データ型など）
  - 優れたパフォーマンスと信頼性
  - スケーラビリティ（レプリケーション、パーティショニング）
- **使用方針**:
  - スキーマ駆動設計
  - 適切なインデックス設計
  - 状態変化のためのAudit列の採用（created_at, updated_at）
  - ストアドプロシージャの最小限使用

### 2.5 キャッシュ

- **採用技術**: Redis 6.x
- **選定理由**:
  - 高速インメモリデータストア
  - 多様なデータ構造（文字列、ハッシュ、リスト、セット、ソート済みセット）
  - パブリッシュ/サブスクライブメカニズム
  - 分散キャッシュとしての活用
- **使用方針**:
  - Spring Cacheによる透過的なキャッシュ
  - セッション管理
  - レート制限の実装
  - 一時的なデータ保存

## 3. フロントエンド技術スタック

### 3.1 Thymeleaf

- **採用バージョン**: Thymeleaf 3.x
- **選定理由**:
  - Springとの緊密な統合
  - 自然なテンプレート構文
  - プロトタイピングしやすいHTML互換性
  - サーバーサイドレンダリングによるSEO対応
- **使用方針**:
  - レイアウトシステムを活用した画面構成
  - フラグメントによるコンポーネント化
  - Spring Security連携

### 3.2 CSS/JavaScript

- **採用技術**:
  - Bootstrap 5.x: レスポンシブUIフレームワーク
  - jQuery 3.x: DOM操作とAjax
  - Chart.js: データ可視化
- **選定理由**:
  - 広い普及率とドキュメント
  - モバイルファーストのレスポンシブデザイン
  - クロスブラウザ互換性
  - 開発効率の向上
- **使用方針**:
  - Bootstrapグリッドシステムによるレスポンシブレイアウト
  - カスタムCSSは必要最小限に留める
  - Ajaxによる部分的な画面更新
  - フォームバリデーションはサーバーサイドとクライアントサイドの両方で実施

## 4. インフラストラクチャとDevOps

### 4.1 アプリケーションサーバー

- **採用技術**: Apache Tomcat (Spring Boot組み込み)
- **選定理由**:
  - Spring Bootとの統合
  - 軽量かつ高パフォーマンス
  - 設定の容易さ
- **使用方針**:
  - Spring Bootの自動設定を活用
  - 必要に応じてサーバーパラメータをチューニング

### 4.2 コンテナ化

- **採用技術**: Docker
- **選定理由**:
  - アプリケーション実行環境の一貫性
  - 開発・テスト・本番環境の統一
  - モノリシックアプリケーションの効率的な運用
- **使用方針**:
  - マルチステージビルドによる軽量イメージ構築
  - Docker Composeによるローカル開発環境
  - 各環境固有の設定は環境変数で注入

### 4.3 CI/CD

- **採用技術**: GitHub Actions
- **選定理由**:
  - GitHubリポジトリとの統合
  - パイプライン設定の柔軟性
  - 容易なスケーリングと構成
  - 豊富なプリセットアクションの活用
- **使用方針**:
  - ビルド、テスト、デプロイの自動化
  - ブランチベースのCI/CD戦略
  - 品質ゲートの設定（テスト成功、コードカバレッジ、静的解析）

### 4.4 監視とロギング

- **採用技術**:
  - Prometheus: メトリクス収集
  - Grafana: 可視化
  - ELK Stack (Elasticsearch, Logstash, Kibana): ログ管理
- **選定理由**:
  - オープンソースの充実したエコシステム
  - アラート機能と詳細な可視化
  - スケーラブルなログ収集と検索
- **使用方針**:
  - アプリケーションメトリクスの定義と収集
  - ダッシュボードによる主要KPIの可視化
  - ログの構造化と集中管理

## 5. テスト環境

### 5.1 単体テスト

- **採用技術**:
  - JUnit 5: テストフレームワーク
  - Mockito: モック作成
  - AssertJ: アサーションライブラリ
- **選定理由**:
  - 最新のJUnitプラットフォーム
  - テストの可読性と表現力
  - Spring Bootとの統合
- **使用方針**:
  - BDDスタイル（given-when-then）のテスト記述
  - テストカバレッジ目標: 80%以上
  - パラメータ化テストの活用

### 5.2 統合・E2Eテスト

- **採用技術**:
  - Spring Boot Test: 統合テスト
  - TestContainers: 一時的なDockerコンテナによるテスト
  - Playwright: ブラウザ自動化テスト
- **選定理由**:
  - 実際の環境に近いテスト環境
  - データベースやキャッシュを含めた統合テスト
  - ブラウザ互換性テスト
- **使用方針**:
  - CIパイプラインでの自動実行
  - 重要なユーザーフローのE2Eテスト
  - スナップショットテストによるUI変更の検出

## 6. セキュリティ関連技術

### 6.1 認証・認可

- **採用技術**:
  - Spring Security: 認証・認可フレームワーク
  - JWT (JSON Web Token): ステートレス認証
  - PBKDF2/BCrypt: パスワードハッシュ化
- **選定理由**:
  - 包括的なセキュリティソリューション
  - フレキシブルな認証メカニズム
  - ロールベースのアクセス制御
- **使用方針**:
  - JWTベースの認証（アクセストークン+リフレッシュトークン）
  - 細粒度の権限管理
  - メソッドレベルのセキュリティ

### 6.2 暗号化

- **採用技術**:
  - AES-256: 対称暗号
  - RSA-2048: 非対称暗号
  - HTTPS/TLS 1.3: 通信暗号化
- **選定理由**:
  - 業界標準の堅牢な暗号アルゴリズム
  - 十分な鍵長
  - 将来にわたる安全性
- **使用方針**:
  - 機密情報（個人情報など）の保存時の暗号化
  - 機密性の高い通信の暗号化
  - 適切な鍵管理と定期的なローテーション

## 7. その他のユーティリティライブラリ

### 7.1 汎用ユーティリティ

- Apache Commons: 汎用ユーティリティ
- Guava: Google Coreライブラリ
- Jackson: JSON処理
- ModelMapper: オブジェクトマッピング
- SLF4J + Logback: ロギング

### 7.2 PDF/Excel処理

- Apache POI: Excel処理
- iText/PDFBox: PDF生成・処理

### 7.3 API文書化

- SpringDoc OpenAPI (Swagger): API文書自動生成
- Spring REST Docs: テストベースのAPI文書生成

## 8. バージョン管理とライフサイクル

- 四半期ごとのライブラリバージョン評価
- セキュリティパッチは適宜適用
- メジャーバージョンアップグレードは慎重に計画
- 依存関係管理はGradle/Maven + BOMで一元管理

## 9. 技術スタックの評価と決定プロセス

新しい技術の採用または既存技術のバージョンアップには以下の評価基準を使用します：

1. 安定性と成熟度
2. コミュニティサポートとエコシステム
3. パフォーマンスと効率性
4. セキュリティと脆弱性履歴
5. チームの習熟度と学習コスト
6. ライセンスとコンプライアンス
7. 長期サポート見通し

## 10. 参照情報

- [基本設計書：システムアーキテクチャ](/docs/02_基本設計/システム設計/03_システムアーキテクチャ.html)
- [詳細設計：アーキテクチャ概要](/docs/03_詳細設計/01_アーキテクチャ/アーキテクチャ概要.md)
- [Spring Framework Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/)
- [Spring Boot Documentation](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/17/index.html)
- [Redis Documentation](https://redis.io/documentation)