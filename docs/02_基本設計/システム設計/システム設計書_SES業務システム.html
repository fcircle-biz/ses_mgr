<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>システム設計書 - SES業務システム</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #2c3e50;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        h1 {
            font-size: 28px;
            text-align: center;
            margin-top: 1em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            font-size: 24px;
            border-left: 5px solid #3498db;
            padding-left: 10px;
            background-color: #f8f9fa;
            padding: 8px 12px;
        }
        h3 {
            font-size: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        h4 {
            font-size: 18px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        pre, code {
            background-color: #f6f8fa;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
            padding: 2px 4px;
        }
        pre {
            padding: 10px;
            overflow: auto;
            line-height: 1.45;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .cover {
            text-align: center;
            margin: 50px 0;
        }
        .cover h1 {
            font-size: 36px;
            margin-bottom: 20px;
            border: none;
        }
        .cover p {
            font-size: 18px;
            margin-bottom: 5px;
        }
        .cover .version {
            margin-top: 50px;
        }
        .update-history {
            margin-bottom: 40px;
        }
        .comment {
            color: #666;
            font-style: italic;
            background-color: #fffde7;
            padding: 10px;
            border-left: 3px solid #fdd835;
            margin: 10px 0;
        }
        .todo {
            color: #d81b60;
            font-weight: bold;
            background-color: #fce4ec;
            padding: 10px;
            border-left: 3px solid #d81b60;
            margin: 10px 0;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }
        .image-placeholder {
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 40px;
            text-align: center;
            color: #999;
            background-color: #f9f9f9;
            width: 80%;
        }
        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: center;
            color: #777;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="cover">
        <h1>システム設計書</h1>
        <p>SES業務システム</p>
        <p class="version">Version 1.0.0</p>
        <p>作成日: 2025年5月4日</p>
    </div>

    <div class="update-history">
        <h2>変更履歴</h2>
        <table>
            <tr>
                <th>版数</th>
                <th>日付</th>
                <th>変更内容</th>
                <th>変更者</th>
            </tr>
            <tr>
                <td>1.0.0</td>
                <td>2025/05/04</td>
                <td>初版作成</td>
                <td>設計担当者</td>
            </tr>
        </table>
    </div>

    <h2>目次</h2>
    <ol>
        <li><a href="#introduction">はじめに</a></li>
        <li><a href="#system-overview">システム概要</a></li>
        <li><a href="#architecture">システムアーキテクチャ</a>
            <ol>
                <li><a href="#system-architecture">システム全体構成</a></li>
                <li><a href="#microservices">マイクロサービス構成</a></li>
                <li><a href="#subsystems">サブシステム構成</a></li>
            </ol>
        </li>
        <li><a href="#deployment">デプロイメント設計</a>
            <ol>
                <li><a href="#deployment-diagram">デプロイメント図</a></li>
                <li><a href="#network">ネットワーク構成</a></li>
                <li><a href="#server">サーバー構成</a></li>
            </ol>
        </li>
        <li><a href="#security">セキュリティ設計</a>
            <ol>
                <li><a href="#authentication">認証設計</a></li>
                <li><a href="#authorization">認可設計</a></li>
                <li><a href="#data-protection">データ保護</a></li>
            </ol>
        </li>
        <li><a href="#performance">性能設計</a>
            <ol>
                <li><a href="#response-time">レスポンスタイム</a></li>
                <li><a href="#throughput">スループット</a></li>
                <li><a href="#scaling">スケーリング方針</a></li>
            </ol>
        </li>
        <li><a href="#availability">可用性設計</a>
            <ol>
                <li><a href="#redundancy">冗長構成</a></li>
                <li><a href="#failover">フェイルオーバー</a></li>
                <li><a href="#disaster-recovery">災害対策</a></li>
            </ol>
        </li>
        <li><a href="#backup">バックアップ設計</a></li>
        <li><a href="#batch">バッチ処理設計</a></li>
        <li><a href="#authority">権限設計</a></li>
        <li><a href="#error">エラー処理設計</a></li>
        <li><a href="#logging">ログ設計</a></li>
        <li><a href="#monitoring">監視設計</a></li>
        <li><a href="#migration">移行設計</a></li>
        <li><a href="#appendix">付録</a></li>
    </ol>

    <h2 id="introduction">1. はじめに</h2>
    <p>本書は、SES業務システムの基本設計を記述したものである。要件定義フェーズで決定した機能要件・非機能要件を実現するための技術的な設計方針およびシステム構成について定義する。</p>

    <h3>1.1 目的</h3>
    <p>本書の目的は以下の通りである：</p>
    <ul>
        <li>SES業務システムの全体構成を明確にすること</li>
        <li>システムアーキテクチャと技術選定の根拠を示すこと</li>
        <li>品質特性（性能、可用性、セキュリティなど）を確保するための設計を記述すること</li>
        <li>詳細設計・実装フェーズの前提となる設計指針を提供すること</li>
    </ul>

    <h3>1.2 対象読者</h3>
    <p>本書の想定読者は以下の通りである：</p>
    <ul>
        <li>プロジェクト管理者</li>
        <li>システムアーキテクト</li>
        <li>アプリケーション開発者</li>
        <li>テスト担当者</li>
        <li>システム運用担当者</li>
    </ul>

    <h3>1.3 関連ドキュメント</h3>
    <p>本書は以下のドキュメントと関連している：</p>
    <table>
        <tr>
            <th>ドキュメント名</th>
            <th>版数</th>
            <th>説明</th>
        </tr>
        <tr>
            <td>要件定義書</td>
            <td>1.0</td>
            <td>SES業務システムの機能要件・非機能要件を記述したドキュメント</td>
        </tr>
        <tr>
            <td>UI設計書</td>
            <td>1.0</td>
            <td>SES業務システムのユーザーインターフェース設計を記述したドキュメント</td>
        </tr>
        <tr>
            <td>DB設計書</td>
            <td>1.0</td>
            <td>SES業務システムのデータベース設計を記述したドキュメント</td>
        </tr>
        <tr>
            <td>インターフェース設計書</td>
            <td>1.0</td>
            <td>SES業務システムの外部インターフェース設計を記述したドキュメント</td>
        </tr>
    </table>

    <h2 id="system-overview">2. システム概要</h2>
    <p>SES業務システムは、SES（System Engineering Service）事業者向けの業務管理システムである。案件管理、技術者管理、マッチング、契約管理、勤怠・工数管理、請求・支払、レポーティングなどの機能を提供し、SES事業の効率化と収益性向上を支援する。</p>

    <h3>2.1 システムの目的</h3>
    <p>SES業務システムの目的は以下の通りである：</p>
    <ul>
        <li>SES事業の基幹業務プロセスを統合的に管理すること</li>
        <li>案件と技術者のマッチング精度を向上させ、稼働率を高めること</li>
        <li>契約から請求までのプロセスを効率化し、事務作業を削減すること</li>
        <li>リアルタイムな経営情報を提供し、意思決定を支援すること</li>
    </ul>

    <h3>2.2 システムの特徴</h3>
    <p>SES業務システムの主な特徴は以下の通りである：</p>
    <ul>
        <li>マイクロサービスアーキテクチャによる柔軟なシステム構成</li>
        <li>AI技術を活用したマッチングエンジン</li>
        <li>電子契約システムとの連携による契約業務のペーパーレス化</li>
        <li>クラウドネイティブな設計によるスケーラビリティの確保</li>
        <li>レスポンシブデザインによるマルチデバイス対応</li>
    </ul>

    <h2 id="architecture">3. システムアーキテクチャ</h2>
    <h3 id="system-architecture">3.1 システム全体構成</h3>
    <div class="container">
        <div class="image-placeholder">
            [システム全体構成図]<br>
            ここにシステム全体の構成図を挿入
        </div>
    </div>
    <p>SES業務システムは、マイクロサービスアーキテクチャとクラウドネイティブ設計を採用し、以下のレイヤー構造で構成される。</p>
    
    <h4>3.1.1 アーキテクチャ概要</h4>
    <ul>
        <li><strong>プレゼンテーション層</strong>：ユーザーインターフェース
            <ul>
                <li>Web UI（レスポンシブデザイン）</li>
                <li>モバイルアプリケーション</li>
                <li>管理者向けダッシュボード</li>
            </ul>
        </li>
        <li><strong>API層</strong>：外部インターフェース
            <ul>
                <li>API Gateway</li>
                <li>RESTful API</li>
                <li>GraphQL API（※将来拡張予定）</li>
            </ul>
        </li>
        <li><strong>アプリケーション層</strong>：業務ロジック
            <ul>
                <li>ドメイン駆動設計に基づくマイクロサービス群</li>
                <li>イベント駆動アーキテクチャ</li>
                <li>ワークフロー管理</li>
            </ul>
        </li>
        <li><strong>データ層</strong>：データ管理
            <ul>
                <li>リレーショナルデータベース（PostgreSQL）</li>
                <li>NoSQLデータベース（特定用途向け）</li>
                <li>キャッシュ（Redis）</li>
                <li>メッセージキュー（RabbitMQ）</li>
                <li>オブジェクトストレージ（MinIO/S3互換）</li>
            </ul>
        </li>
        <li><strong>インフラストラクチャ層</strong>：基盤
            <ul>
                <li>Kubernetesによるコンテナオーケストレーション</li>
                <li>クラウドインフラ（AWS/Azure/GCP等）</li>
                <li>CI/CDパイプライン</li>
                <li>監視・ロギング基盤</li>
            </ul>
        </li>
    </ul>
    
    <h4>3.1.2 アーキテクチャスタイル</h4>
    <p>SES業務システムでは、以下のアーキテクチャスタイルとパターンを適用する：</p>
    <table>
        <tr>
            <th>アーキテクチャスタイル</th>
            <th>適用範囲</th>
            <th>選定理由</th>
        </tr>
        <tr>
            <td><strong>マイクロサービスアーキテクチャ</strong></td>
            <td>システム全体</td>
            <td>
                <ul>
                    <li>機能ごとの独立した開発・デプロイが可能</li>
                    <li>異なるチームによる並行開発の促進</li>
                    <li>技術スタックの柔軟な選択</li>
                    <li>個別のサービスの独立したスケーリング</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td><strong>イベント駆動アーキテクチャ</strong></td>
            <td>サービス間連携</td>
            <td>
                <ul>
                    <li>疎結合の実現</li>
                    <li>非同期処理によるスケーラビリティ向上</li>
                    <li>サービス障害時の耐障害性</li>
                    <li>ビジネスイベントの明示的モデリング</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td><strong>レイヤードアーキテクチャ</strong></td>
            <td>各マイクロサービス内部</td>
            <td>
                <ul>
                    <li>関心の分離による保守性向上</li>
                    <li>テスト容易性の確保</li>
                    <li>構造化された設計によるコード品質の維持</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td><strong>CQRS</strong><br>(Command Query Responsibility Segregation)</td>
            <td>特定のマイクロサービス<br>（レポーティング、検索機能等）</td>
            <td>
                <ul>
                    <li>読み取りと書き込みの最適化分離</li>
                    <li>複雑なクエリ処理の効率化</li>
                    <li>高負荷な読み取り処理のスケーラビリティ向上</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td><strong>API Gateway</strong></td>
            <td>外部インターフェース</td>
            <td>
                <ul>
                    <li>クライアントリクエストの一元管理</li>
                    <li>認証・認可の集中処理</li>
                    <li>マイクロサービスへのルーティング</li>
                    <li>クライアント向けAPIの最適化</li>
                </ul>
            </td>
        </tr>
    </table>
    
    <h4>3.1.3 技術スタック概要</h4>
    <p>SES業務システムは、要件定義に基づく以下の技術スタックを採用する：</p>
    <table>
        <tr>
            <th>カテゴリ</th>
            <th>採用技術</th>
            <th>選定理由</th>
        </tr>
        <tr>
            <td>バックエンド言語</td>
            <td>Java 21</td>
            <td>最新のLTS版、バーチャルスレッド対応、パフォーマンス向上、長期サポート</td>
        </tr>
        <tr>
            <td>バックエンドフレームワーク</td>
            <td>Spring Boot</td>
            <td>高い拡張性と保守性、豊富なライブラリ、企業利用に最適</td>
        </tr>
        <tr>
            <td>フロントエンド</td>
            <td>Thymeleaf</td>
            <td>Springとの親和性、サーバーサイドレンダリング、迅速な開発</td>
        </tr>
        <tr>
            <td>データベース</td>
            <td>PostgreSQL</td>
            <td>高信頼性、データ整合性の確保、拡張性の高さ</td>
        </tr>
        <tr>
            <td>コンテナ技術</td>
            <td>Docker</td>
            <td>環境の一貫性、開発・本番環境の差異解消、デプロイ効率化</td>
        </tr>
        <tr>
            <td>CI/CD</td>
            <td>GitHub Actions</td>
            <td>Gitリポジトリとの連携、ワークフロー自動化、柔軟なパイプライン</td>
        </tr>
        <tr>
            <td>アプリケーションアーキテクチャ</td>
            <td>レイヤードアーキテクチャ</td>
            <td>責務の分離、保守性向上、テスト容易性</td>
        </tr>
    </table>
    
    <h4>3.1.4 アーキテクチャの進化計画</h4>
    <p>SES業務システムのアーキテクチャは、以下のフェーズで進化させる計画である：</p>
    <ol>
        <li><strong>フェーズ1（初期リリース）</strong>: コア機能のモノリシック実装</li>
        <li><strong>フェーズ2（機能拡張）</strong>: 全機能モジュールの実装と改善</li>
        <li><strong>フェーズ3（最適化）</strong>: パフォーマンス改善、セキュリティ強化</li>
        <li><strong>フェーズ4（機能強化）</strong>: 高度なマッチングアルゴリズム、予測分析機能の実装</li>
    </ol>
    
    <h4>3.1.5 アーキテクチャ選定の根拠</h4>
    <p>本アーキテクチャを選定した主な理由は以下の通り：</p>
    <ul>
        <li>要件定義書で指定された技術スタック（Java Spring Boot, Thymeleaf, PostgreSQL, Docker）との整合性</li>
        <li>レイヤードアーキテクチャによる関心の分離と保守性の向上</li>
        <li>Spring Bootのモジュール構成による機能単位の開発効率化</li>
        <li>段階的な開発・リリースに対応できる柔軟性</li>
        <li>シンプルな構成によるコードの理解しやすさと運用管理の容易さ</li>
    </ul>

    <h3 id="system-modules">3.2 モジュール構成</h3>
    <div class="container">
        <div class="image-placeholder">
            [モジュール構成図]<br>
            ここにモジュール構成図を挿入
        </div>
    </div>
    <p>SES業務システムは、ドメイン駆動設計（DDD）の考え方に基づき、ビジネスドメインごとに独立したモジュールで構成される。各モジュールは、そのドメイン内での責任を持ち、適切なインターフェースを通じて連携する。</p>
    
    <h4>3.2.1 レイヤード・アーキテクチャの特徴</h4>
    <ul>
        <li><strong>関心の分離</strong>: 各レイヤーは特定の責務のみを持ち、保守性を向上</li>
        <li><strong>依存関係の一方向化</strong>: 上位レイヤーから下位レイヤーへの依存のみを許可</li>
        <li><strong>テスト容易性</strong>: レイヤー単位でのテストが可能</li>
        <li><strong>コード再利用</strong>: 共通機能の抽出と再利用が容易</li>
        <li><strong>変更の影響範囲限定</strong>: レイヤー内の変更がシステム全体に波及しない設計</li>
    </ul>
    
    <h4>3.2.2 レイヤー構成</h4>
    <p>SES業務システムは、以下のレイヤーで構成される：</p>
    <ul>
        <li><strong>プレゼンテーション層</strong>: ユーザーインターフェースを担当 (Thymeleaf)</li>
        <li><strong>アプリケーション層</strong>: ユースケースの実現、トランザクション管理を担当 (Spring MVC, Spring Services)</li>
        <li><strong>ドメイン層</strong>: ビジネスロジック、ドメインモデルを担当 (Domain Objects, Business Rules)</li>
        <li><strong>インフラストラクチャ層</strong>: 永続化、外部システム連携を担当 (Spring Data JPA, APIs)</li>
    </ul>
    
    <h4>3.2.3 機能モジュール構成</h4>
    <p>SES業務システムは、以下の機能モジュールで構成される：</p>
    <table>
        <tr>
            <th>モジュール名</th>
            <th>機能概要</th>
            <th>主要コンポーネント</th>
            <th>データモデル</th>
        </tr>
        <tr>
            <td>案件管理機能</td>
            <td>
                <ul>
                    <li>案件情報の登録・管理</li>
                    <li>案件検索・フィルタリング</li>
                    <li>案件ステータス管理</li>
                    <li>顧客情報管理</li>
                    <li>案件履歴管理</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>ProjectController</li>
                    <li>ProjectService</li>
                    <li>CustomerService</li>
                    <li>ProjectRepository</li>
                </ul>
            </td>
            <td>Project, Customer, ProjectStatus, ProjectHistory</td>
        </tr>
        <tr>
            <td>技術者管理機能</td>
            <td>
                <ul>
                    <li>技術者情報の登録・管理</li>
                    <li>スキル情報管理</li>
                    <li>稼働状況管理</li>
                    <li>キャリア管理</li>
                    <li>評価・パフォーマンス管理</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>EngineerController</li>
                    <li>EngineerService</li>
                    <li>SkillService</li>
                    <li>EngineerRepository</li>
                </ul>
            </td>
            <td>Engineer, Skill, Assignment, Performance</td>
        </tr>
        <tr>
            <td>マッチング機能</td>
            <td>
                <ul>
                    <li>案件と技術者のマッチング</li>
                    <li>マッチングアルゴリズム</li>
                    <li>提案書生成</li>
                    <li>マッチング履歴管理</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>MatchingController</li>
                    <li>MatchingService</li>
                    <li>ProposalService</li>
                    <li>MatchingRepository</li>
                </ul>
            </td>
            <td>Matching, MatchingHistory, Proposal</td>
        </tr>
        <tr>
            <td>契約管理機能</td>
            <td>
                <ul>
                    <li>契約書テンプレート管理</li>
                    <li>契約書生成</li>
                    <li>電子署名連携</li>
                    <li>契約管理・更新</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>ContractController</li>
                    <li>ContractService</li>
                    <li>TemplateService</li>
                    <li>ContractRepository</li>
                </ul>
            </td>
            <td>Contract, ContractTemplate, Signature</td>
        </tr>
        <tr>
            <td>勤怠工数管理機能</td>
            <td>
                <ul>
                    <li>勤怠情報登録</li>
                    <li>勤怠承認ワークフロー</li>
                    <li>工数入力・管理</li>
                    <li>シフト管理</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>TimesheetController</li>
                    <li>TimesheetService</li>
                    <li>ApprovalService</li>
                    <li>TimesheetRepository</li>
                </ul>
            </td>
            <td>Timesheet, TimeEntry, Approval, WorkSchedule</td>
        </tr>
        <tr>
            <td>請求支払機能</td>
            <td>
                <ul>
                    <li>請求書生成</li>
                    <li>入金管理</li>
                    <li>支払管理</li>
                    <li>税務処理</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>BillingController</li>
                    <li>InvoiceService</li>
                    <li>PaymentService</li>
                    <li>BillingRepository</li>
                </ul>
            </td>
            <td>Invoice, Payment, BillingCycle, TaxInfo</td>
        </tr>
        <tr>
            <td>レポーティング機能</td>
            <td>
                <ul>
                    <li>各種レポート生成</li>
                    <li>ダッシュボード</li>
                    <li>KPI管理</li>
                    <li>データ分析</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>ReportController</li>
                    <li>ReportService</li>
                    <li>DashboardService</li>
                    <li>ReportRepository</li>
                </ul>
            </td>
            <td>Report, KPI, Dashboard, ReportTemplate</td>
        </tr>
        <tr>
            <td>認証認可機能</td>
            <td>
                <ul>
                    <li>ユーザー認証</li>
                    <li>ロール・権限管理</li>
                    <li>セッション管理</li>
                    <li>アクセス制御</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>SecurityConfig</li>
                    <li>UserDetailsService</li>
                    <li>AuthorizationService</li>
                    <li>UserRepository</li>
                </ul>
            </td>
            <td>User, Role, Permission, Session</td>
        </tr>
        <tr>
            <td>通知機能</td>
            <td>
                <ul>
                    <li>メール通知</li>
                    <li>システム内通知</li>
                    <li>通知テンプレート管理</li>
                    <li>通知履歴管理</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>NotificationController</li>
                    <li>EmailService</li>
                    <li>NotificationService</li>
                    <li>NotificationRepository</li>
                </ul>
            </td>
            <td>Notification, NotificationTemplate, EmailLog</td>
        </tr>
    </table>
    
    <h4>3.2.4 モジュール間の連携</h4>
    <p>モジュール間の連携は以下の方法で実現する：</p>
    <ul>
        <li><strong>サービス呼び出し</strong>: 依存性注入（DI）を用いたサービス間の直接呼び出し</li>
        <li><strong>イベント駆動</strong>: Spring ApplicationEvent を利用したイベント通知</li>
        <li><strong>共有データベース</strong>: モジュール間で共有するエンティティの適切な設計</li>
    </ul>
    
    <h4>3.2.5 共通コンポーネント</h4>
    <p>複数のモジュールで共有される共通コンポーネントを提供する：</p>
    <ul>
        <li><strong>共通ユーティリティ</strong>: 日付操作、文字列操作、ファイル操作など</li>
        <li><strong>例外処理</strong>: 一貫した例外階層とハンドリング</li>
        <li><strong>監査ログ</strong>: 操作履歴の記録と管理</li>
        <li><strong>設定管理</strong>: システム設定の集中管理</li>
        <li><strong>国際化</strong>: 多言語対応の仕組み</li>
    </ul>

    <h3 id="subsystems">3.3 サブシステム構成</h3>
    <p>SES業務システムは、以下のサブシステムで構成される：</p>
    <table>
        <tr>
            <th>サブシステム名</th>
            <th>概要</th>
            <th>関連マイクロサービス</th>
        </tr>
        <tr>
            <td>営業支援サブシステム</td>
            <td>案件管理、提案書作成、顧客情報管理</td>
            <td>案件管理サービス</td>
        </tr>
        <tr>
            <td>人材管理サブシステム</td>
            <td>技術者情報管理、スキル管理、稼働状況管理</td>
            <td>技術者管理サービス</td>
        </tr>
        <tr>
            <td>マッチングサブシステム</td>
            <td>案件と技術者のマッチング、提案書作成</td>
            <td>マッチングサービス</td>
        </tr>
        <tr>
            <td>契約管理サブシステム</td>
            <td>契約書作成、電子署名、契約情報管理</td>
            <td>契約管理サービス</td>
        </tr>
        <tr>
            <td>勤怠管理サブシステム</td>
            <td>勤怠情報登録、承認ワークフロー</td>
            <td>勤怠工数管理サービス</td>
        </tr>
        <tr>
            <td>請求支払サブシステム</td>
            <td>請求書生成、入金管理、支払管理</td>
            <td>請求支払サービス</td>
        </tr>
        <tr>
            <td>経営分析サブシステム</td>
            <td>各種レポート生成、KPI管理、予測分析</td>
            <td>レポーティングサービス</td>
        </tr>
    </table>

    <h2 id="deployment">4. デプロイメント設計</h2>
    <p>SES業務システムは、Kubernetesベースのコンテナオーケストレーションプラットフォーム上に展開され、Infrastructure as Code（IaC）の原則に従って管理される。</p>
    
    <h3 id="deployment-diagram">4.1 デプロイメント図</h3>
    <div class="container">
        <div class="image-placeholder">
            [デプロイメント図]<br>
            ここにデプロイメント図を挿入
        </div>
    </div>
    
    <h4>4.1.1 環境構成</h4>
    <p>SES業務システムは、以下の環境を用意する：</p>
    <table>
        <tr>
            <th>環境</th>
            <th>用途</th>
            <th>インフラ構成</th>
            <th>データ</th>
        </tr>
        <tr>
            <td><strong>開発環境 (DEV)</strong></td>
            <td>日常的な開発作業・機能テスト</td>
            <td>小規模 Kubernetes クラスター<br>（単一アベイラビリティゾーン）</td>
            <td>開発用データ<br>（本番データのマスキング版）</td>
        </tr>
        <tr>
            <td><strong>テスト環境 (TEST)</strong></td>
            <td>統合テスト・性能テスト・セキュリティテスト</td>
            <td>中規模 Kubernetes クラスター<br>（複数アベイラビリティゾーン）</td>
            <td>テスト用データセット<br>（本番データのサブセット）</td>
        </tr>
        <tr>
            <td><strong>ステージング環境 (STG)</strong></td>
            <td>本番リリース前の検証・受入テスト</td>
            <td>本番同等 Kubernetes クラスター<br>（複数アベイラビリティゾーン）</td>
            <td>本番データのクローン<br>（マスキング処理済み）</td>
        </tr>
        <tr>
            <td><strong>本番環境 (PROD)</strong></td>
            <td>実サービス提供</td>
            <td>大規模 Kubernetes クラスター<br>（複数リージョン・アベイラビリティゾーン）</td>
            <td>本番データ</td>
        </tr>
        <tr>
            <td><strong>災害復旧環境 (DR)</strong></td>
            <td>災害時のバックアップ運用</td>
            <td>本番同等 Kubernetes クラスター<br>（別リージョン）</td>
            <td>本番データのレプリケーション</td>
        </tr>
    </table>
    
    <h4>4.1.2 Kubernetesクラスター構成</h4>
    <p>各環境のKubernetesクラスターは、以下の構成で展開される：</p>
    <table>
        <tr>
            <th>コンポーネント</th>
            <th>構成（本番環境）</th>
            <th>役割</th>
        </tr>
        <tr>
            <td>マスターノード</td>
            <td>3台（各AZに1台）</td>
            <td>Kubernetesコントロールプレーン</td>
        </tr>
        <tr>
            <td>アプリケーションノード</td>
            <td>9台以上（各AZに3台以上、Auto Scaling）</td>
            <td>アプリケーションコンテナの実行</td>
        </tr>
        <tr>
            <td>データベースノード</td>
            <td>6台（各AZに2台）</td>
            <td>データベースコンテナの実行</td>
        </tr>
        <tr>
            <td>ユーティリティノード</td>
            <td>3台（各AZに1台）</td>
            <td>監視・ロギングコンポーネントの実行</td>
        </tr>
        <tr>
            <td>ストレージ</td>
            <td>分散ストレージシステム（各AZに複製）</td>
            <td>永続データの保存</td>
        </tr>
    </table>
    
    <h4>4.1.3 デプロイメントプロセス</h4>
    <p>SES業務システムは、以下のCI/CDパイプラインに従ってデプロイされる：</p>
    <ol>
        <li><strong>コード変更</strong>: 開発者がGitリポジトリに変更をプッシュ</li>
        <li><strong>ビルド＆テスト</strong>: Jenkins/GitHub Actionsによる自動ビルドとユニットテスト実行</li>
        <li><strong>コンテナイメージ作成</strong>: Docker イメージのビルドと脆弱性スキャン</li>
        <li><strong>イメージ登録</strong>: コンテナレジストリへのイメージ登録</li>
        <li><strong>DEV環境デプロイ</strong>: ArgoCD による開発環境への自動デプロイ</li>
        <li><strong>統合テスト</strong>: 開発環境での自動統合テスト</li>
        <li><strong>TEST環境デプロイ</strong>: テスト環境への自動デプロイと各種テスト実行</li>
        <li><strong>STG環境デプロイ</strong>: ステージング環境への手動承認後のデプロイ</li>
        <li><strong>受入テスト</strong>: ステージング環境での受入テスト</li>
        <li><strong>PROD環境デプロイ</strong>: 本番環境への手動承認後のデプロイ</li>
    </ol>
    
    <h3 id="network">4.2 ネットワーク構成</h3>
    <div class="container">
        <div class="image-placeholder">
            [ネットワーク構成図]<br>
            ここにネットワーク構成図を挿入
        </div>
    </div>
    
    <h4>4.2.1 VPCとサブネット構成</h4>
    <p>SES業務システムは、以下のVPC（Virtual Private Cloud）とサブネット構成を採用する：</p>
    <table>
        <tr>
            <th>ネットワーク要素</th>
            <th>構成</th>
            <th>目的</th>
        </tr>
        <tr>
            <td><strong>VPC</strong></td>
            <td>環境ごとに独立したVPC</td>
            <td>環境間のネットワーク分離</td>
        </tr>
        <tr>
            <td><strong>パブリックサブネット</strong></td>
            <td>各AZに1つ以上</td>
            <td>インターネット公開コンポーネント（ロードバランサー等）の配置</td>
        </tr>
        <tr>
            <td><strong>アプリケーションサブネット</strong></td>
            <td>各AZに1つ以上</td>
            <td>アプリケーションコンテナの配置</td>
        </tr>
        <tr>
            <td><strong>データベースサブネット</strong></td>
            <td>各AZに1つ以上</td>
            <td>データベースサーバーの配置</td>
        </tr>
        <tr>
            <td><strong>管理サブネット</strong></td>
            <td>各AZに1つ</td>
            <td>運用管理ツール・踏み台サーバーの配置</td>
        </tr>
    </table>
    
    <h4>4.2.2 ネットワークセキュリティ</h4>
    <p>以下のネットワークセキュリティ対策を実施する：</p>
    <table>
        <tr>
            <th>セキュリティ対策</th>
            <th>実装方法</th>
            <th>目的</th>
        </tr>
        <tr>
            <td><strong>ファイアウォール</strong></td>
            <td>セキュリティグループ、ネットワークACL</td>
            <td>不正アクセスの防止</td>
        </tr>
        <tr>
            <td><strong>WAF</strong></td>
            <td>Web Application Firewall</td>
            <td>Webアプリケーション攻撃の防御</td>
        </tr>
        <tr>
            <td><strong>DDoS対策</strong></td>
            <td>DDoS保護サービス</td>
            <td>サービス拒否攻撃からの保護</td>
        </tr>
        <tr>
            <td><strong>IPSec VPN</strong></td>
            <td>サイト間VPN</td>
            <td>社内ネットワークとの安全な接続</td>
        </tr>
        <tr>
            <td><strong>通信の暗号化</strong></td>
            <td>TLS 1.3</td>
            <td>データ通信の盗聴防止</td>
        </tr>
        <tr>
            <td><strong>ネットワーク分離</strong></td>
            <td>サブネット・セキュリティグループ</td>
            <td>侵害発生時の影響範囲の限定</td>
        </tr>
    </table>
    
    <h4>4.2.3 ロードバランシング</h4>
    <p>トラフィック分散のために以下のロードバランサーを配置する：</p>
    <ul>
        <li><strong>外部ロードバランサー</strong>: インターネットからのトラフィックをAPI Gatewayに分散</li>
        <li><strong>内部ロードバランサー</strong>: サービス間通信の負荷分散</li>
        <li><strong>データベースロードバランサー</strong>: データベース読み取りトラフィックの分散</li>
    </ul>
    
    <h3 id="server">4.3 サーバー/コンテナ構成</h3>
    <h4>4.3.1 コンテナ構成</h4>
    <p>SES業務システムのコンポーネントは、以下のコンテナとして展開される：</p>
    <table>
        <tr>
            <th>コンテナ種別</th>
            <th>役割</th>
            <th>構成</th>
            <th>レプリカ数</th>
            <th>リソース割り当て</th>
        </tr>
        <tr>
            <td>Webアプリケーションコンテナ</td>
            <td>Webアプリケーション提供</td>
            <td>Tomcat + Spring Boot + Thymeleaf</td>
            <td>2+（Auto Scaling）</td>
            <td>CPU: 2vCPU<br>Memory: 4GB</td>
        </tr>
        <tr>
            <td>データベースコンテナ</td>
            <td>データ永続化</td>
            <td>PostgreSQL</td>
            <td>マスター1台、レプリカ1台</td>
            <td>CPU: 4vCPU<br>Memory: 8GB</td>
        </tr>
        <tr>
            <td>バックアップコンテナ</td>
            <td>データバックアップ</td>
            <td>PostgreSQL (pgBackRest)</td>
            <td>1台</td>
            <td>CPU: 1vCPU<br>Memory: 2GB</td>
        </tr>
        <tr>
            <td>ファイルストレージコンテナ</td>
            <td>ファイル保存</td>
            <td>共有ボリューム</td>
            <td>1台</td>
            <td>CPU: 1vCPU<br>Memory: 2GB</td>
        </tr>
        <tr>
            <td>CI/CDコンテナ</td>
            <td>継続的インテグレーション・デプロイ</td>
            <td>GitHub Actions Runner</td>
            <td>1台</td>
            <td>CPU: 2vCPU<br>Memory: 4GB</td>
        </tr>
        <tr>
            <td>監視コンテナ</td>
            <td>システム監視・ログ収集</td>
            <td>Prometheus, Grafana</td>
            <td>1台</td>
            <td>CPU: 2vCPU<br>Memory: 4GB</td>
        </tr>
    </table>
    
    <h4>4.3.2 永続化ストレージ</h4>
    <p>以下の永続化ストレージを使用する：</p>
    <table>
        <tr>
            <th>ストレージ種類</th>
            <th>用途</th>
            <th>容量</th>
            <th>バックアップ方式</th>
        </tr>
        <tr>
            <td>ブロックストレージ</td>
            <td>データベース、キャッシュ、メッセージキュー</td>
            <td>2TB～10TB（サービスにより異なる）</td>
            <td>日次スナップショット + 継続的増分バックアップ</td>
        </tr>
        <tr>
            <td>オブジェクトストレージ</td>
            <td>ドキュメント、ログ、バックアップデータ</td>
            <td>50TB+（拡張可能）</td>
            <td>クロスリージョンレプリケーション</td>
        </tr>
        <tr>
            <td>共有ファイルシステム</td>
            <td>アプリケーション間で共有するファイル</td>
            <td>1TB</td>
            <td>日次バックアップ</td>
        </tr>
    </table>
    
    <h4>4.3.3 運用管理インフラ</h4>
    <p>以下の運用管理インフラを構築する：</p>
    <table>
        <tr>
            <th>インフラコンポーネント</th>
            <th>製品/技術</th>
            <th>用途</th>
        </tr>
        <tr>
            <td>CI/CDパイプライン</td>
            <td>Jenkins, ArgoCD</td>
            <td>継続的インテグレーション・デリバリー</td>
        </tr>
        <tr>
            <td>コンテナレジストリ</td>
            <td>Docker Registry</td>
            <td>コンテナイメージの保管・配布</td>
        </tr>
        <tr>
            <td>構成管理</td>
            <td>Terraform, Helm</td>
            <td>インフラとアプリケーション構成の管理</td>
        </tr>
        <tr>
            <td>セキュリティスキャン</td>
            <td>Trivy, SonarQube</td>
            <td>コードとコンテナの脆弱性スキャン</td>
        </tr>
        <tr>
            <td>監視・アラート</td>
            <td>Prometheus, Grafana, PagerDuty</td>
            <td>システム監視と異常検知・通知</td>
        </tr>
        <tr>
            <td>ログ管理</td>
            <td>Elasticsearch, Logstash, Kibana</td>
            <td>ログ収集・分析・可視化</td>
        </tr>
        <tr>
            <td>分散トレーシング</td>
            <td>Jaeger, OpenTelemetry</td>
            <td>マイクロサービス間通信の追跡</td>
        </tr>
    </table>

    <h2 id="security">5. セキュリティ設計</h2>
    <p>SES業務システムでは、多層防御（Defense in Depth）の考え方に基づき、包括的なセキュリティ対策を実施する。</p>
    
    <h3 id="authentication">5.1 認証設計</h3>
    <h4>5.1.1 認証基本方針</h4>
    <p>SES業務システムでは、以下の認証方式を採用する：</p>
    <ul>
        <li><strong>認証プロトコル</strong>: OAuth2.0 + OpenID Connect</li>
        <li><strong>認証方式</strong>: ユーザーID/パスワード認証 + 多要素認証（MFA）</li>
        <li><strong>セッション管理</strong>: JWTトークンによるステートレスセッション</li>
        <li><strong>アカウントロック</strong>: 5回連続ログイン失敗でアカウントロック（30分）</li>
    </ul>
    
    <h4>5.1.2 パスワードポリシー</h4>
    <table>
        <tr>
            <th>項目</th>
            <th>要件</th>
            <th>備考</th>
        </tr>
        <tr>
            <td>最小長</td>
            <td>12文字以上</td>
            <td>セキュリティ要件に基づく設定</td>
        </tr>
        <tr>
            <td>複雑性</td>
            <td>大文字・小文字・数字・特殊文字を含む</td>
            <td>パスワード強度の確保</td>
        </tr>
        <tr>
            <td>有効期限</td>
            <td>90日</td>
            <td>定期的な変更を強制</td>
        </tr>
        <tr>
            <td>履歴管理</td>
            <td>過去12回分のパスワードを再利用不可</td>
            <td>パスワードの使い回し防止</td>
        </tr>
        <tr>
            <td>初期パスワード</td>
            <td>システム生成の一時パスワード + 初回ログイン時の変更強制</td>
            <td>安全な初期設定</td>
        </tr>
    </table>
    
    <h4>5.1.3 多要素認証（MFA）</h4>
    <p>以下のユーザーには多要素認証を必須とする：</p>
    <ul>
        <li>システム管理者アカウント</li>
        <li>経営管理者アカウント</li>
        <li>外部からのアクセスを行うユーザー</li>
        <li>機密情報にアクセスする権限を持つユーザー</li>
    </ul>
    <p>対応する認証要素：</p>
    <ul>
        <li>SMSワンタイムパスワード</li>
        <li>認証アプリケーション（Google Authenticator等）</li>
        <li>生体認証（スマートフォン連携）</li>
    </ul>
    
    <h4>5.1.4 認証アーキテクチャ</h4>
    <div class="container">
        <div class="image-placeholder">
            [認証フロー図]<br>
            ここに認証フロー図を挿入
        </div>
    </div>
    <p>認証サービスは独立したマイクロサービスとして実装し、以下の機能を提供する：</p>
    <ul>
        <li>集中認証サービス（Single Sign-On）</li>
        <li>ユーザー管理・アカウントライフサイクル管理</li>
        <li>トークン発行・検証</li>
        <li>多要素認証（MFA）</li>
        <li>アカウントロック管理</li>
    </ul>
    
    <h3 id="authorization">5.2 認可設計</h3>
    <h4>5.2.1 認可基本方針</h4>
    <p>SES業務システムでは、以下の認可方式を採用する：</p>
    <ul>
        <li><strong>アクセス制御モデル</strong>: RBAC（Role-Based Access Control）+ ABAC（Attribute-Based Access Control）のハイブリッド</li>
        <li><strong>権限管理</strong>: ロール単位での権限付与、組織階層に基づくアクセス制御</li>
        <li><strong>API認可</strong>: OAuth2.0のスコープベースの認可 + JWT クレーム</li>
    </ul>
    
    <h4>5.2.2 ロール体系</h4>
    <table>
        <tr>
            <th>ロール区分</th>
            <th>ロール</th>
            <th>主な権限</th>
        </tr>
        <tr>
            <td rowspan="2">システム管理者</td>
            <td>システム管理者（全体）</td>
            <td>全機能の管理・設定変更</td>
        </tr>
        <tr>
            <td>セキュリティ管理者</td>
            <td>セキュリティ設定、監査ログ管理</td>
        </tr>
        <tr>
            <td rowspan="3">業務管理者</td>
            <td>営業管理者</td>
            <td>案件管理機能の管理、営業データの参照/更新</td>
        </tr>
        <tr>
            <td>人事管理者</td>
            <td>技術者管理機能の管理、人事データの参照/更新</td>
        </tr>
        <tr>
            <td>経理管理者</td>
            <td>請求支払機能の管理、経理データの参照/更新</td>
        </tr>
        <tr>
            <td rowspan="4">一般ユーザー</td>
            <td>営業担当者</td>
            <td>案件情報の登録/更新、担当案件の参照</td>
        </tr>
        <tr>
            <td>人事担当者</td>
            <td>技術者情報の登録/更新、担当技術者の参照</td>
        </tr>
        <tr>
            <td>経理担当者</td>
            <td>請求書の作成、入金情報の登録</td>
        </tr>
        <tr>
            <td>技術者</td>
            <td>自身の情報参照、スキル情報更新、勤怠登録</td>
        </tr>
        <tr>
            <td>外部ユーザー</td>
            <td>顧客担当者</td>
            <td>契約情報の参照、発注情報の確認</td>
        </tr>
    </table>
    
    <h4>5.2.3 権限制御方式</h4>
    <p>マイクロサービスごとに以下の権限制御を実装する：</p>
    <ul>
        <li><strong>API Gateway レベル</strong>: JWT トークンの検証、スコープベースのアクセス制御</li>
        <li><strong>サービスレベル</strong>: サービス固有の詳細な権限チェック（組織階層、データオーナーシップなど）</li>
        <li><strong>データレベル</strong>: クエリ時のフィルタリングによるデータアクセス制御</li>
    </ul>
    
    <h3 id="data-protection">5.3 データ保護</h3>
    <h4>5.3.1 データ分類</h4>
    <p>データは以下のように分類し、分類に応じた保護対策を実施する：</p>
    <table>
        <tr>
            <th>分類</th>
            <th>対象データ例</th>
            <th>保護要件</th>
        </tr>
        <tr>
            <td>機密情報</td>
            <td>個人識別情報（氏名・住所・電話番号等）、給与情報、契約金額</td>
            <td>
                <ul>
                    <li>保存時の暗号化必須</li>
                    <li>アクセスログ記録必須</li>
                    <li>厳格なアクセス制御</li>
                    <li>開発・テスト環境への持ち出し禁止（マスキング必須）</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>重要情報</td>
            <td>案件情報、技術者スキル情報、顧客情報</td>
            <td>
                <ul>
                    <li>保存時の暗号化推奨</li>
                    <li>ロールベースのアクセス制御</li>
                    <li>開発・テスト環境では匿名化</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>一般情報</td>
            <td>公開可能な企業情報、公開求人情報</td>
            <td>
                <ul>
                    <li>通常のアクセス制御</li>
                    <li>改ざん防止対策</li>
                </ul>
            </td>
        </tr>
    </table>
    
    <h4>5.3.2 暗号化対策</h4>
    <p>SES業務システムでは、以下の暗号化対策を実施する：</p>
    <table>
        <tr>
            <th>対象</th>
            <th>暗号化方式</th>
            <th>鍵管理</th>
        </tr>
        <tr>
            <td>通信経路</td>
            <td>TLS 1.3</td>
            <td>証明書管理システムによる自動更新</td>
        </tr>
        <tr>
            <td>データベース（透過的暗号化）</td>
            <td>AES-256</td>
            <td>HSM（Hardware Security Module）による鍵管理</td>
        </tr>
        <tr>
            <td>個別フィールド暗号化</td>
            <td>AES-256-GCM</td>
            <td>アプリケーションレベルでの鍵管理、鍵のローテーション</td>
        </tr>
        <tr>
            <td>バックアップデータ</td>
            <td>AES-256</td>
            <td>HSMによる鍵管理、バックアップ専用の暗号化鍵</td>
        </tr>
        <tr>
            <td>ファイルストレージ</td>
            <td>AES-256</td>
            <td>ストレージシステムによる鍵管理</td>
        </tr>
    </table>
    
    <h4>5.3.3 マスキング・匿名化</h4>
    <p>開発・テスト環境では、以下のデータマスキング・匿名化処理を実施する：</p>
    <ul>
        <li><strong>完全マスキング</strong>: 個人識別情報を完全に別の値に置換</li>
        <li><strong>部分マスキング</strong>: 電話番号の一部を「*」に置換するなど</li>
        <li><strong>トークン化</strong>: 元の値と関連性のない代替値に置換しつつ、一貫性を維持</li>
        <li><strong>シャッフリング</strong>: データセット内で値を入れ替え</li>
        <li><strong>範囲化</strong>: 給与などの数値を範囲で表現</li>
    </ul>
    
    <h4>5.3.4 セキュアコーディング</h4>
    <p>アプリケーション開発において、以下のセキュアコーディング原則を適用する：</p>
    <ul>
        <li>入力値の検証（サーバーサイド）</li>
        <li>SQLインジェクション対策（パラメータ化クエリの使用）</li>
        <li>クロスサイトスクリプティング対策（出力エスケープ）</li>
        <li>セキュアな例外処理（詳細なエラー情報の隠蔽）</li>
        <li>適切なログ出力（機密情報のマスキング）</li>
    </ul>
    
    <h3 id="audit">5.4 監査・ログ設計</h3>
    <h4>5.4.1 監査ログ対象</h4>
    <p>以下の操作・イベントについて監査ログを記録する：</p>
    <table>
        <tr>
            <th>カテゴリ</th>
            <th>監査対象</th>
            <th>記録内容</th>
        </tr>
        <tr>
            <td>認証・認可</td>
            <td>
                <ul>
                    <li>ログイン／ログアウト</li>
                    <li>ログイン失敗</li>
                    <li>パスワード変更</li>
                    <li>権限変更</li>
                </ul>
            </td>
            <td>日時、ユーザーID、IPアドレス、操作内容、結果</td>
        </tr>
        <tr>
            <td>データアクセス</td>
            <td>
                <ul>
                    <li>機密情報の参照</li>
                    <li>データの作成・更新・削除</li>
                    <li>一括データ出力</li>
                </ul>
            </td>
            <td>日時、ユーザーID、データ種別、操作内容、対象レコードID</td>
        </tr>
        <tr>
            <td>システム管理</td>
            <td>
                <ul>
                    <li>システム設定変更</li>
                    <li>ユーザー・ロール管理</li>
                    <li>バッチ処理実行</li>
                </ul>
            </td>
            <td>日時、管理者ID、操作内容、変更前後の値</td>
        </tr>
        <tr>
            <td>システム動作</td>
            <td>
                <ul>
                    <li>アプリケーションエラー</li>
                    <li>セキュリティ例外</li>
                    <li>パフォーマンス異常</li>
                </ul>
            </td>
            <td>日時、イベント種別、エラーコード、詳細情報</td>
        </tr>
    </table>
    
    <h4>5.4.2 ログ管理</h4>
    <p>監査ログは以下のように管理する：</p>
    <ul>
        <li><strong>集中管理</strong>: ELKスタックによる集中ログ管理</li>
        <li><strong>保存期間</strong>: オンライン保存（3ヶ月）、アーカイブ（5年間）</li>
        <li><strong>保護対策</strong>: ログの改ざん防止（書き込み専用ストレージ、ハッシュ値による完全性確認）</li>
        <li><strong>アラート</strong>: 不審な操作検知時のセキュリティアラート</li>
    </ul>
    
    <h3 id="vulnerability">5.5 脆弱性対策</h3>
    <h4>5.5.1 脆弱性管理プロセス</h4>
    <p>以下の脆弱性管理プロセスを確立する：</p>
    <ol>
        <li><strong>脆弱性情報の収集</strong>: セキュリティ情報配信サービス、脆弱性データベースからの情報収集</li>
        <li><strong>脆弱性評価</strong>: 影響範囲の特定、リスク評価、対応優先度の決定</li>
        <li><strong>対策の実施</strong>: パッチ適用、設定変更、回避策の実装</li>
        <li><strong>検証</strong>: 対策後の有効性確認</li>
        <li><strong>報告</strong>: 対応状況の報告・記録</li>
    </ol>
    
    <h4>5.5.2 セキュリティテスト</h4>
    <p>以下のセキュリティテストを定期的に実施する：</p>
    <table>
        <tr>
            <th>テスト種別</th>
            <th>実施頻度</th>
            <th>対象範囲</th>
        </tr>
        <tr>
            <td>静的アプリケーションセキュリティテスト (SAST)</td>
            <td>CI/CDパイプライン内で毎回</td>
            <td>アプリケーションコード</td>
        </tr>
        <tr>
            <td>動的アプリケーションセキュリティテスト (DAST)</td>
            <td>月次</td>
            <td>稼働中のアプリケーション</td>
        </tr>
        <tr>
            <td>ソフトウェア構成分析 (SCA)</td>
            <td>CI/CDパイプライン内で毎回</td>
            <td>使用ライブラリ・依存関係</td>
        </tr>
        <tr>
            <td>コンテナ脆弱性スキャン</td>
            <td>イメージビルド時＋週次</td>
            <td>コンテナイメージ</td>
        </tr>
        <tr>
            <td>ペネトレーションテスト</td>
            <td>半年毎＋重大な変更時</td>
            <td>システム全体</td>
        </tr>
    </table>
    
    <h3 id="incident">5.6 インシデント対応</h3>
    <p>セキュリティインシデント発生時は、以下の対応プロセスに従う：</p>
    <ol>
        <li><strong>検知・通報</strong>: 監視システムによる自動検知または利用者からの報告</li>
        <li><strong>評価・分類</strong>: インシデントの重大度・種類の評価、対応優先度の決定</li>
        <li><strong>初動対応</strong>: 被害拡大防止のための応急措置（影響範囲の特定・分離）</li>
        <li><strong>調査・解析</strong>: 原因調査、攻撃経路・手法の特定、被害範囲の確定</li>
        <li><strong>復旧</strong>: 被害システムの復旧、対策の実施</li>
        <li><strong>報告・再発防止</strong>: 関係者への報告、再発防止策の策定・実施</li>
    </ol>
    
    <h4>5.6.1 インシデント対応体制</h4>
    <p>セキュリティインシデント対応のため、以下の体制を整備する：</p>
    <ul>
        <li><strong>セキュリティ対応チーム</strong>: インシデント対応の中核を担当</li>
        <li><strong>技術対応チーム</strong>: システム調査・復旧を担当</li>
        <li><strong>対外対応チーム</strong>: 顧客・監督官庁等への報告を担当</li>
        <li><strong>経営層</strong>: 重大インシデント時の意思決定を担当</li>
    </ul>

    <h2 id="performance">6. 性能設計</h2>
    <h3 id="response-time">6.1 レスポンスタイム</h3>
    <p>SES業務システムのレスポンスタイム目標は以下の通り：</p>
    <table>
        <tr>
            <th>操作種別</th>
            <th>目標レスポンスタイム</th>
            <th>最大許容値</th>
        </tr>
        <tr>
            <td>画面表示（初期表示）</td>
            <td>1.0秒以内</td>
            <td>3.0秒</td>
        </tr>
        <tr>
            <td>画面遷移</td>
            <td>0.5秒以内</td>
            <td>2.0秒</td>
        </tr>
        <tr>
            <td>検索処理（通常）</td>
            <td>1.0秒以内</td>
            <td>3.0秒</td>
        </tr>
        <tr>
            <td>検索処理（複雑条件）</td>
            <td>3.0秒以内</td>
            <td>10.0秒</td>
        </tr>
        <tr>
            <td>データ更新処理</td>
            <td>1.0秒以内</td>
            <td>3.0秒</td>
        </tr>
        <tr>
            <td>レポート生成</td>
            <td>5.0秒以内</td>
            <td>30.0秒</td>
        </tr>
        <tr>
            <td>バッチ処理</td>
            <td>-</td>
            <td>指定期間内に完了</td>
        </tr>
    </table>

    <h3 id="throughput">6.2 スループット</h3>
    <p>SES業務システムのスループット目標は以下の通り：</p>
    <table>
        <tr>
            <th>項目</th>
            <th>想定値</th>
            <th>最大値</th>
        </tr>
        <tr>
            <td>同時接続ユーザー数</td>
            <td>200ユーザー</td>
            <td>500ユーザー</td>
        </tr>
        <tr>
            <td>トランザクション数（ピーク時）</td>
            <td>100TPS</td>
            <td>300TPS</td>
        </tr>
        <tr>
            <td>データ処理量（日次）</td>
            <td>10GB</td>
            <td>50GB</td>
        </tr>
    </table>

    <h3 id="scaling">6.3 スケーリング方針</h3>
    <p>SES業務システムでは、以下のスケーリング方針を採用する：</p>
    <ul>
        <li><strong>水平スケーリング</strong>: Webアプリケーション層とAPIサービス層は、負荷に応じて水平スケーリングする設計とする</li>
        <li><strong>垂直スケーリング</strong>: データベース層は、負荷に応じて垂直スケーリングを基本とし、必要に応じてシャーディングを検討する</li>
        <li><strong>スケーリングトリガー</strong>: CPU使用率70%、メモリ使用率80%をスケールアウトのトリガーとする</li>
        <li><strong>オートスケーリング</strong>: クラウドプラットフォームのオートスケーリング機能を利用し、負荷に応じて自動的にスケールする</li>
    </ul>

    <h2 id="availability">7. 可用性設計</h2>
    <h3 id="redundancy">7.1 冗長構成</h3>
    <p>SES業務システムでは、以下の冗長構成を採用する：</p>
    <ul>
        <li><strong>マルチAZ構成</strong>: 異なるアベイラビリティゾーンにシステムコンポーネントを配置</li>
        <li><strong>ロードバランサー冗長化</strong>: 複数のロードバランサーを配置し、単一障害点を排除</li>
        <li><strong>アプリケーションサーバー冗長化</strong>: 各サービスを複数インスタンスで運用</li>
        <li><strong>データベース冗長化</strong>: マスター/スレーブ構成によるデータベースの冗長化</li>
    </ul>

    <h3 id="failover">7.2 フェイルオーバー</h3>
    <p>SES業務システムでは、以下のフェイルオーバー設計を採用する：</p>
    <ul>
        <li><strong>データベースフェイルオーバー</strong>: 自動フェイルオーバーによるマスター切り替え（目標RTO: 60秒）</li>
        <li><strong>サービスフェイルオーバー</strong>: ヘルスチェックによる障害検知と自動フェイルオーバー</li>
        <li><strong>サーキットブレーカー</strong>: マイクロサービス間の呼び出しにサーキットブレーカーパターンを適用</li>
        <li><strong>グレースフルデグラデーション</strong>: 一部サービス障害時の縮退運転モード</li>
    </ul>

    <h3 id="disaster-recovery">7.3 災害対策</h3>
    <p>SES業務システムでは、以下の災害対策を実施する：</p>
    <ul>
        <li><strong>データバックアップ</strong>: 日次フルバックアップ、時間単位の増分バックアップ</li>
        <li><strong>バックアップサイト</strong>: 遠隔地バックアップサイトの準備</li>
        <li><strong>リカバリ計画</strong>: 災害時復旧計画（DRP）の策定と定期的な訓練</li>
        <li><strong>RTO/RPO</strong>: RTO（目標復旧時間）: 4時間以内、RPO（目標復旧時点）: 1時間以内</li>
    </ul>

    <h2 id="backup">8. バックアップ設計</h2>
    <p>SES業務システムでは、以下のバックアップ設計を採用する：</p>
    <table>
        <tr>
            <th>バックアップ種別</th>
            <th>対象</th>
            <th>頻度</th>
            <th>保管期間</th>
            <th>方式</th>
        </tr>
        <tr>
            <td>フルバックアップ</td>
            <td>データベース全体</td>
            <td>日次（深夜）</td>
            <td>30日間</td>
            <td>オンラインバックアップ</td>
        </tr>
        <tr>
            <td>増分バックアップ</td>
            <td>データベース変更分</td>
            <td>1時間毎</td>
            <td>7日間</td>
            <td>トランザクションログ</td>
        </tr>
        <tr>
            <td>ファイルバックアップ</td>
            <td>アップロードファイル</td>
            <td>日次</td>
            <td>30日間</td>
            <td>差分バックアップ</td>
        </tr>
        <tr>
            <td>構成バックアップ</td>
            <td>システム構成情報</td>
            <td>構成変更時</td>
            <td>変更履歴5世代</td>
            <td>構成管理ツール</td>
        </tr>
        <tr>
            <td>アーカイブ</td>
            <td>重要データ</td>
            <td>月次</td>
            <td>7年間</td>
            <td>コールドストレージ</td>
        </tr>
    </table>

    <h2 id="batch">9. バッチ処理設計</h2>
    <p>SES業務システムでは、以下のバッチ処理設計を採用する。</p>

    <h3>9.1 バッチ処理の概要</h3>
    <p>SES業務システムにおけるバッチ処理は、Spring Batch フレームワークを利用して実装し、Kubernetes上のCronJobとして定期実行する設計とする。各バッチは独立したコンテナとして実行され、ジョブの実行状況や結果は監視システムによって監視される。</p>

    <h4>9.1.1 バッチ処理アーキテクチャ</h4>
    <div class="container">
        <div class="image-placeholder">
            [バッチ処理アーキテクチャ図]<br>
            ここにバッチ処理アーキテクチャ図を挿入
        </div>
    </div>

    <p>バッチ処理アーキテクチャは以下の構成要素で構成される：</p>
    <ul>
        <li><strong>ジョブスケジューラ</strong>: Kubernetes CronJob による実行スケジュール管理</li>
        <li><strong>バッチジョブコンテナ</strong>: Spring Batch アプリケーションを含むコンテナ</li>
        <li><strong>バッチジョブDB</strong>: Spring Batch のメタデータを管理するデータベース</li>
        <li><strong>処理対象データソース</strong>: 業務データを格納するデータベース</li>
        <li><strong>出力データストア</strong>: 処理結果を格納するストレージ</li>
        <li><strong>監視・通知システム</strong>: バッチジョブの実行状況を監視し、異常時に通知</li>
    </ul>

    <h4>9.1.2 バッチ処理方式</h4>
    <p>バッチ処理は、以下の3つの方式で実装する：</p>
    <table>
        <tr>
            <th>処理方式</th>
            <th>説明</th>
            <th>適用先</th>
        </tr>
        <tr>
            <td>チャンク処理</td>
            <td>大量データを一定サイズのチャンクに分割して処理する方式</td>
            <td>データ集計、レポート生成など</td>
        </tr>
        <tr>
            <td>タスクレット処理</td>
            <td>単一タスクとして処理する方式</td>
            <td>ファイル転送、バックアップなど</td>
        </tr>
        <tr>
            <td>フロー処理</td>
            <td>複数のステップを条件分岐を含むフローとして処理する方式</td>
            <td>複雑な業務ロジックを含むバッチ</td>
        </tr>
    </table>

    <h4>9.1.3 バッチ処理の共通事項</h4>
    <p>全てのバッチ処理に共通する設計方針は以下の通り：</p>
    <ul>
        <li><strong>再実行性</strong>: 障害発生時に同一パラメータで再実行可能な設計</li>
        <li><strong>べき等性</strong>: 同一条件での複数回実行が同一結果となる設計</li>
        <li><strong>分離性</strong>: 他のバッチやオンラインシステムへの影響を最小化</li>
        <li><strong>監視可能性</strong>: 処理状況や結果が監視システムから確認可能</li>
        <li><strong>パラメータ化</strong>: 実行条件をパラメータで外部から制御可能</li>
    </ul>

    <h3>9.2 バッチジョブ一覧</h3>
    <p>SES業務システムで実装するバッチジョブは以下の通り：</p>

    <h4>9.2.1 日次バッチジョブ</h4>
    <table>
        <tr>
            <th>ジョブID</th>
            <th>ジョブ名</th>
            <th>概要</th>
            <th>実行時間</th>
            <th>想定処理時間</th>
            <th>前提条件</th>
            <th>後続処理</th>
        </tr>
        <tr>
            <td>BATCH-D001</td>
            <td>勤怠集計バッチ</td>
            <td>前日の勤怠データを集計し、月次の集計テーブルを更新</td>
            <td>毎日 05:00</td>
            <td>30分以内</td>
            <td>なし</td>
            <td>BATCH-D002</td>
        </tr>
        <tr>
            <td>BATCH-D002</td>
            <td>工数集計バッチ</td>
            <td>前日の工数データを集計し、月次の集計テーブルを更新</td>
            <td>毎日 05:30</td>
            <td>30分以内</td>
            <td>BATCH-D001</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-D003</td>
            <td>案件ステータス更新バッチ</td>
            <td>案件の期限に応じてステータスを自動更新</td>
            <td>毎日 06:00</td>
            <td>15分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-D004</td>
            <td>契約期限チェックバッチ</td>
            <td>契約期限を確認し、期限が近い契約に対して通知を生成</td>
            <td>毎日 07:00</td>
            <td>15分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-D005</td>
            <td>承認期限チェックバッチ</td>
            <td>承認待ちの申請に対して、承認期限が近いものの通知を生成</td>
            <td>毎日 08:00</td>
            <td>15分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-D006</td>
            <td>日次レポート生成バッチ</td>
            <td>日次の業務指標レポートを生成</td>
            <td>毎日 09:00</td>
            <td>30分以内</td>
            <td>BATCH-D001, BATCH-D002</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-D007</td>
            <td>システムログ整理バッチ</td>
            <td>システムログを整理し、長期保存用にアーカイブ</td>
            <td>毎日 01:00</td>
            <td>60分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
    </table>

    <h4>9.2.2 月次バッチジョブ</h4>
    <table>
        <tr>
            <th>ジョブID</th>
            <th>ジョブ名</th>
            <th>概要</th>
            <th>実行時間</th>
            <th>想定処理時間</th>
            <th>前提条件</th>
            <th>後続処理</th>
        </tr>
        <tr>
            <td>BATCH-M001</td>
            <td>請求書生成バッチ</td>
            <td>月次の勤怠・工数データを基に請求書データを生成</td>
            <td>毎月1日 07:00</td>
            <td>120分以内</td>
            <td>月次締め処理完了</td>
            <td>BATCH-M002</td>
        </tr>
        <tr>
            <td>BATCH-M002</td>
            <td>支払データ生成バッチ</td>
            <td>月次の勤怠・工数データを基に支払データを生成</td>
            <td>毎月1日 09:00</td>
            <td>120分以内</td>
            <td>BATCH-M001</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-M003</td>
            <td>月次レポート生成バッチ</td>
            <td>月次の業務指標レポートを生成</td>
            <td>毎月1日 11:00</td>
            <td>60分以内</td>
            <td>BATCH-M001, BATCH-M002</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-M004</td>
            <td>契約自動更新バッチ</td>
            <td>自動更新フラグが立っている契約の更新処理</td>
            <td>毎月25日 10:00</td>
            <td>30分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-M005</td>
            <td>月次データアーカイブバッチ</td>
            <td>月次データのアーカイブと長期保存処理</td>
            <td>毎月2日 01:00</td>
            <td>120分以内</td>
            <td>月次締め処理完了</td>
            <td>なし</td>
        </tr>
    </table>

    <h4>9.2.3 その他の定期バッチジョブ</h4>
    <table>
        <tr>
            <th>ジョブID</th>
            <th>ジョブ名</th>
            <th>概要</th>
            <th>実行時間</th>
            <th>想定処理時間</th>
            <th>前提条件</th>
            <th>後続処理</th>
        </tr>
        <tr>
            <td>BATCH-O001</td>
            <td>マッチング処理バッチ</td>
            <td>案件と技術者のマッチング処理を実行</td>
            <td>毎週月曜 03:00</td>
            <td>120分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-O002</td>
            <td>稼働率予測バッチ</td>
            <td>今後3ヶ月の稼働率予測データを生成</td>
            <td>毎週月曜 05:00</td>
            <td>60分以内</td>
            <td>BATCH-O001</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-O003</td>
            <td>スキル有効期限チェックバッチ</td>
            <td>技術者のスキル・資格の有効期限をチェックし、期限が近いものの通知を生成</td>
            <td>毎週水曜 09:00</td>
            <td>30分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
        <tr>
            <td>BATCH-O004</td>
            <td>データベース最適化バッチ</td>
            <td>データベースの統計情報更新、インデックス再構築などのメンテナンス</td>
            <td>毎週日曜 02:00</td>
            <td>180分以内</td>
            <td>なし</td>
            <td>なし</td>
        </tr>
    </table>

    <h3>9.3 バッチジョブの詳細設計</h3>
    <p>主要なバッチジョブの詳細設計について記述する。</p>

    <h4>9.3.1 勤怠集計バッチ (BATCH-D001)</h4>
    <ul>
        <li><strong>処理概要</strong>: 前日の勤怠データを集計し、月次の集計テーブルを更新する</li>
        <li><strong>処理フロー</strong>:
            <ol>
                <li>前日の勤怠データを取得</li>
                <li>技術者ごとに勤怠時間を集計</li>
                <li>月次集計テーブルのデータを更新</li>
                <li>異常データのログ出力と通知</li>
                <li>処理結果の記録</li>
            </ol>
        </li>
        <li><strong>主要パラメータ</strong>:
            <ul>
                <li>処理日 (対象日の前日)</li>
                <li>再処理フラグ</li>
            </ul>
        </li>
        <li><strong>入力データ</strong>: 勤怠情報テーブル、カレンダーマスタ</li>
        <li><strong>出力データ</strong>: 勤怠集計テーブル、処理ログ</li>
        <li><strong>エラー処理</strong>:
            <ul>
                <li>データ不整合エラー: 警告ログ出力、処理継続</li>
                <li>DB接続エラー: エラーログ出力、処理中断、管理者通知</li>
                <li>その他例外: エラーログ出力、処理中断、管理者通知</li>
            </ul>
        </li>
        <li><strong>リカバリ方法</strong>: 再処理パラメータを指定して再実行</li>
    </ul>

    <h4>9.3.2 請求書生成バッチ (BATCH-M001)</h4>
    <ul>
        <li><strong>処理概要</strong>: 月次の勤怠・工数データを基に請求書データを生成する</li>
        <li><strong>処理フロー</strong>:
            <ol>
                <li>前月の勤怠・工数データを取得</li>
                <li>契約情報と紐づけて請求対象データを抽出</li>
                <li>契約条件に基づいて請求金額を計算</li>
                <li>請求書データを生成</li>
                <li>請求書PDFを生成</li>
                <li>処理結果の記録と通知</li>
            </ol>
        </li>
        <li><strong>主要パラメータ</strong>:
            <ul>
                <li>対象年月</li>
                <li>請求サイクル (月次/半月次/週次)</li>
                <li>再処理フラグ</li>
            </ul>
        </li>
        <li><strong>入力データ</strong>: 勤怠集計テーブル、工数集計テーブル、契約テーブル、料金テーブル</li>
        <li><strong>出力データ</strong>: 請求書データテーブル、請求書PDF、処理ログ</li>
        <li><strong>エラー処理</strong>:
            <ul>
                <li>データ不整合エラー: エラーログ出力、該当データをスキップして処理継続</li>
                <li>PDF生成エラー: エラーログ出力、PDFのみ再処理可能フラグを設定</li>
                <li>DB接続エラー: エラーログ出力、処理中断、管理者通知</li>
                <li>その他例外: エラーログ出力、処理中断、管理者通知</li>
            </ul>
        </li>
        <li><strong>リカバリ方法</strong>: 該当年月、再処理パラメータを指定して再実行</li>
    </ul>

    <h4>9.3.3 マッチング処理バッチ (BATCH-O001)</h4>
    <ul>
        <li><strong>処理概要</strong>: 案件と技術者のマッチング処理を実行し、マッチング結果を生成する</li>
        <li><strong>処理フロー</strong>:
            <ol>
                <li>有効な案件データを取得</li>
                <li>稼働可能な技術者データを取得</li>
                <li>マッチングアルゴリズムを適用してスコアリング</li>
                <li>マッチング結果をデータベースに保存</li>
                <li>高スコアのマッチングに対する通知を生成</li>
                <li>処理結果の記録</li>
            </ol>
        </li>
        <li><strong>主要パラメータ</strong>:
            <ul>
                <li>マッチングアルゴリズム種別</li>
                <li>スコアしきい値</li>
                <li>通知しきい値</li>
            </ul>
        </li>
        <li><strong>入力データ</strong>: 案件テーブル、技術者テーブル、スキルテーブル、稼働状況テーブル</li>
        <li><strong>出力データ</strong>: マッチング結果テーブル、通知テーブル、処理ログ</li>
        <li><strong>エラー処理</strong>:
            <ul>
                <li>データ不整合エラー: 警告ログ出力、処理継続</li>
                <li>アルゴリズムエラー: エラーログ出力、デフォルトアルゴリズムで再試行</li>
                <li>DB接続エラー: エラーログ出力、処理中断、管理者通知</li>
            </ul>
        </li>
        <li><strong>リカバリ方法</strong>: パラメータを調整して再実行</li>
    </ul>

    <h3>9.4 バッチ監視設計</h3>
    <p>バッチジョブの実行状況を監視するための設計について記述する。</p>

    <h4>9.4.1 監視項目</h4>
    <table>
        <tr>
            <th>監視項目</th>
            <th>内容</th>
            <th>通知条件</th>
            <th>通知先</th>
        </tr>
        <tr>
            <td>バッチ実行状態</td>
            <td>バッチジョブの実行状況（実行中/完了/失敗/タイムアウト）</td>
            <td>失敗、タイムアウト</td>
            <td>システム管理者</td>
        </tr>
        <tr>
            <td>実行時間</td>
            <td>バッチジョブの実行時間</td>
            <td>想定処理時間の120%超過</td>
            <td>システム管理者</td>
        </tr>
        <tr>
            <td>処理件数</td>
            <td>バッチジョブで処理されたレコード数</td>
            <td>前回処理件数の±30%変動</td>
            <td>システム管理者、業務担当者</td>
        </tr>
        <tr>
            <td>エラー件数</td>
            <td>バッチジョブ内で発生したエラー件数</td>
            <td>1件以上</td>
            <td>システム管理者</td>
        </tr>
        <tr>
            <td>リソース使用状況</td>
            <td>バッチジョブ実行時のCPU、メモリ使用状況</td>
            <td>割り当ての80%以上</td>
            <td>システム管理者</td>
        </tr>
    </table>

    <h4>9.4.2 監視アーキテクチャ</h4>
    <div class="container">
        <div class="image-placeholder">
            [バッチ監視アーキテクチャ図]<br>
            ここにバッチ監視アーキテクチャ図を挿入
        </div>
    </div>

    <p>バッチジョブの監視には以下のコンポーネントを使用する：</p>
    <ul>
        <li><strong>Spring Batch Admin</strong>: バッチジョブの管理・監視インターフェース</li>
        <li><strong>Prometheus</strong>: メトリクス収集</li>
        <li><strong>Grafana</strong>: 監視ダッシュボード</li>
        <li><strong>Alertmanager</strong>: アラート管理と通知</li>
    </ul>

    <h4>9.4.3 ログ設計</h4>
    <p>バッチジョブのログは以下の方針で設計する：</p>
    <ul>
        <li><strong>ログレベル</strong>: ERROR, WARN, INFO, DEBUG, TRACE</li>
        <li><strong>ログ出力内容</strong>:
            <ul>
                <li>ジョブ開始・終了ログ (INFO)</li>
                <li>ステップ開始・終了ログ (INFO)</li>
                <li>処理件数ログ (INFO)</li>
                <li>警告・例外ログ (WARN, ERROR)</li>
                <li>詳細デバッグログ (DEBUG, TRACE)</li>
            </ul>
        </li>
        <li><strong>ログフォーマット</strong>: [タイムスタンプ] [ログレベル] [ジョブID] [ステップID] [スレッドID] [メッセージ]</li>
        <li><strong>ログローテーション</strong>: 日次でローテーション、30日間保持</li>
    </ul>

    <h3>9.5 バッチジョブの運用管理</h3>
    <p>バッチジョブの運用管理について記述する。</p>

    <h4>9.5.1 スケジュール管理</h4>
    <p>バッチジョブのスケジュールは以下の方針で管理する：</p>
    <ul>
        <li>Kubernetes CronJobによるスケジュール管理</li>
        <li>メンテナンスウィンドウを考慮したスケジュール設定</li>
        <li>各バッチジョブの依存関係を考慮した実行順序の制御</li>
        <li>再実行に備えた時間的余裕の確保</li>
    </ul>

    <h4>9.5.2 障害時運用</h4>
    <p>バッチジョブ実行時の障害に対する運用手順：</p>
    <ol>
        <li>障害検知: 監視システムからのアラート</li>
        <li>障害切り分け: ログ分析による原因特定</li>
        <li>リカバリ処理: 状況に応じた対応策の実施
            <ul>
                <li>パラメータ調整による再実行</li>
                <li>部分的な再実行</li>
                <li>データ修正後の再実行</li>
                <li>代替処理の実行</li>
            </ul>
        </li>
        <li>結果確認: リカバリ後の処理結果確認</li>
        <li>報告・記録: 障害内容と対応策の記録</li>
    </ol>

    <h4>9.5.3 バッチウィンドウ管理</h4>
    <p>各バッチジョブの実行時間枠（バッチウィンドウ）を以下のように管理する：</p>
    <ul>
        <li><strong>日次バッチウィンドウ</strong>: 01:00〜09:00</li>
        <li><strong>月次バッチウィンドウ</strong>: 月初1日〜3日の01:00〜12:00</li>
        <li><strong>週次バッチウィンドウ</strong>: 月曜日・水曜日の01:00〜09:00、日曜日の02:00〜10:00</li>
    </ul>
    <p>各バッチジョブは、指定されたバッチウィンドウ内で完了するよう設計・実装する。バッチウィンドウを超過する可能性がある場合は、事前に監視システムでアラートを発するように設定する。</p>

    <h2 id="authority">10. 権限設計</h2>
    <p>SES業務システムでは、細かな権限管理と安全なアクセス制御を実現するため、ロールベースのアクセス制御（RBAC）と属性ベースのアクセス制御（ABAC）を組み合わせたハイブリッド方式を採用する。</p>

    <h3>10.1 権限設計の基本方針</h3>
    <p>SES業務システムにおける権限設計の基本方針は以下の通り：</p>
    <ul>
        <li><strong>最小権限の原則</strong>: ユーザーには業務に必要な最小限の権限のみを付与する</li>
        <li><strong>職務分離の原則</strong>: 重要な業務プロセスを複数の担当者に分割し、単独での処理を防止する</li>
        <li><strong>階層化された権限管理</strong>: 組織階層に沿った権限の継承と制限</li>
        <li><strong>動的な権限評価</strong>: ユーザー属性、データ属性、コンテキストを考慮した動的な権限評価</li>
        <li><strong>監査可能性</strong>: 権限変更履歴と権限使用履歴の記録</li>
    </ul>

    <h3>10.2 アクセス制御モデル</h3>
    <div class="container">
        <div class="image-placeholder">
            [アクセス制御モデル図]<br>
            ここにアクセス制御モデル図を挿入
        </div>
    </div>

    <h4>10.2.1 RBAC（ロールベースアクセス制御）</h4>
    <p>ユーザーに対してロールを割り当て、そのロールに基づいて権限を制御する。主要なコンポーネントは以下の通り：</p>
    <ul>
        <li><strong>ユーザー（User）</strong>: システムを利用するユーザー</li>
        <li><strong>ロール（Role）</strong>: 権限のグループ。ユーザーに割り当てられる</li>
        <li><strong>権限（Permission）</strong>: システム内の特定の操作を実行する能力</li>
        <li><strong>オブジェクト（Object）</strong>: アクセス制御の対象となるリソース</li>
    </ul>

    <h4>10.2.2 ABAC（属性ベースアクセス制御）</h4>
    <p>RBAC を拡張し、以下の属性を考慮して動的にアクセス制御を行う：</p>
    <ul>
        <li><strong>ユーザー属性</strong>: 所属部署、役職、雇用形態など</li>
        <li><strong>リソース属性</strong>: データの種類、機密レベル、所有者など</li>
        <li><strong>環境属性</strong>: アクセス時間、アクセス元IPアドレス、デバイスタイプなど</li>
        <li><strong>コンテキスト属性</strong>: 現在のワークフロー状態、関係性など</li>
    </ul>

    <h3>10.3 ロール体系</h3>
    <p>SES業務システムで定義するロール体系は以下の通り：</p>

    <h4>10.3.1 システムロール</h4>
    <p>システム全体の管理に関するロール</p>
    <table>
        <tr>
            <th>ロール名</th>
            <th>説明</th>
            <th>主な権限</th>
            <th>想定ユーザー</th>
        </tr>
        <tr>
            <td>システム管理者</td>
            <td>システム全体の管理権限を持つ</td>
            <td>
                <ul>
                    <li>ユーザー管理（全権限）</li>
                    <li>ロール管理（全権限）</li>
                    <li>システム設定（全権限）</li>
                    <li>マスタデータ管理（全権限）</li>
                    <li>全機能の参照・編集</li>
                </ul>
            </td>
            <td>IT部門責任者</td>
        </tr>
        <tr>
            <td>セキュリティ管理者</td>
            <td>セキュリティ関連の管理権限を持つ</td>
            <td>
                <ul>
                    <li>ユーザー管理（参照、ロック/ロック解除）</li>
                    <li>ロール管理（参照のみ）</li>
                    <li>監査ログ管理（全権限）</li>
                    <li>セキュリティ設定（全権限）</li>
                </ul>
            </td>
            <td>情報セキュリティ責任者</td>
        </tr>
        <tr>
            <td>監査者</td>
            <td>システム監査のための権限を持つ</td>
            <td>
                <ul>
                    <li>全機能の参照のみ</li>
                    <li>監査ログの参照</li>
                    <li>レポート生成</li>
                </ul>
            </td>
            <td>内部監査担当者、監査法人</td>
        </tr>
    </table>

    <h4>10.3.2 業務管理ロール</h4>
    <p>業務ドメイン別の管理ロール</p>
    <table>
        <tr>
            <th>ロール名</th>
            <th>説明</th>
            <th>主な権限</th>
            <th>想定ユーザー</th>
        </tr>
        <tr>
            <td>営業管理者</td>
            <td>営業関連機能の管理権限を持つ</td>
            <td>
                <ul>
                    <li>案件管理（全権限）</li>
                    <li>顧客管理（全権限）</li>
                    <li>契約管理（全権限）</li>
                    <li>マッチング管理（全権限）</li>
                    <li>営業レポート（全権限）</li>
                    <li>営業担当者の割り当て</li>
                </ul>
            </td>
            <td>営業部門責任者</td>
        </tr>
        <tr>
            <td>人事管理者</td>
            <td>人事関連機能の管理権限を持つ</td>
            <td>
                <ul>
                    <li>技術者管理（全権限）</li>
                    <li>スキル管理（全権限）</li>
                    <li>評価管理（全権限）</li>
                    <li>勤怠管理設定（全権限）</li>
                    <li>人事レポート（全権限）</li>
                </ul>
            </td>
            <td>人事部門責任者</td>
        </tr>
        <tr>
            <td>経理管理者</td>
            <td>経理関連機能の管理権限を持つ</td>
            <td>
                <ul>
                    <li>請求管理（全権限）</li>
                    <li>支払管理（全権限）</li>
                    <li>経理設定（全権限）</li>
                    <li>財務レポート（全権限）</li>
                </ul>
            </td>
            <td>経理部門責任者</td>
        </tr>
        <tr>
            <td>品質管理者</td>
            <td>品質管理関連機能の権限を持つ</td>
            <td>
                <ul>
                    <li>評価管理（参照、編集）</li>
                    <li>品質指標（全権限）</li>
                    <li>クレーム管理（全権限）</li>
                    <li>品質レポート（全権限）</li>
                </ul>
            </td>
            <td>品質管理担当者</td>
        </tr>
    </table>

    <h4>10.3.3 業務担当ロール</h4>
    <p>日常業務を担当するユーザーのロール</p>
    <table>
        <tr>
            <th>ロール名</th>
            <th>説明</th>
            <th>主な権限</th>
            <th>想定ユーザー</th>
        </tr>
        <tr>
            <td>営業担当者</td>
            <td>案件獲得・顧客管理を担当</td>
            <td>
                <ul>
                    <li>案件管理（担当範囲のみ作成、参照、編集）</li>
                    <li>顧客管理（担当範囲のみ作成、参照、編集）</li>
                    <li>契約管理（担当範囲のみ作成、参照、編集）</li>
                    <li>マッチング（参照、提案作成）</li>
                </ul>
            </td>
            <td>営業部門社員</td>
        </tr>
        <tr>
            <td>人事担当者</td>
            <td>技術者管理・評価を担当</td>
            <td>
                <ul>
                    <li>技術者管理（作成、参照、編集）</li>
                    <li>スキル管理（参照、編集）</li>
                    <li>評価管理（参照、編集）</li>
                    <li>勤怠承認（参照、承認）</li>
                </ul>
            </td>
            <td>人事部門社員</td>
        </tr>
        <tr>
            <td>経理担当者</td>
            <td>請求・支払処理を担当</td>
            <td>
                <ul>
                    <li>請求管理（作成、参照、編集）</li>
                    <li>入金処理（作成、参照、編集）</li>
                    <li>支払処理（作成、参照、編集）</li>
                    <li>経理レポート（参照）</li>
                </ul>
            </td>
            <td>経理部門社員</td>
        </tr>
        <tr>
            <td>マネージャー</td>
            <td>部門・チームの管理を担当</td>
            <td>
                <ul>
                    <li>チームメンバーのデータ（参照）</li>
                    <li>勤怠承認（参照、承認）</li>
                    <li>評価管理（参照、編集）</li>
                    <li>部門レポート（参照）</li>
                </ul>
            </td>
            <td>各部門のマネージャー</td>
        </tr>
    </table>

    <h4>10.3.4 技術者・外部ロール</h4>
    <p>技術者および外部関係者のロール</p>
    <table>
        <tr>
            <th>ロール名</th>
            <th>説明</th>
            <th>主な権限</th>
            <th>想定ユーザー</th>
        </tr>
        <tr>
            <td>技術者</td>
            <td>SES技術者としての機能を利用</td>
            <td>
                <ul>
                    <li>自己プロフィール（参照、一部編集）</li>
                    <li>スキル情報（参照、編集申請）</li>
                    <li>勤怠登録（作成、参照、編集）</li>
                    <li>工数登録（作成、参照、編集）</li>
                    <li>案件情報（自身の案件のみ参照）</li>
                </ul>
            </td>
            <td>SES技術者</td>
        </tr>
        <tr>
            <td>顧客担当者</td>
            <td>顧客企業の担当者</td>
            <td>
                <ul>
                    <li>契約情報（自社契約のみ参照）</li>
                    <li>稼働報告（参照、承認）</li>
                    <li>請求情報（自社請求のみ参照）</li>
                    <li>技術者情報（契約中の技術者のみ参照）</li>
                </ul>
            </td>
            <td>顧客企業担当者</td>
        </tr>
        <tr>
            <td>協力会社担当者</td>
            <td>協力会社（ビジネスパートナー）の担当者</td>
            <td>
                <ul>
                    <li>技術者情報（自社技術者のみ登録、参照、編集）</li>
                    <li>案件情報（公開案件のみ参照）</li>
                    <li>契約情報（自社契約のみ参照）</li>
                    <li>請求情報（自社請求のみ参照）</li>
                </ul>
            </td>
            <td>協力会社担当者</td>
        </tr>
    </table>

    <h3>10.4 権限マトリクス</h3>
    <p>各ロールと機能/データのアクセス権限をマトリクスで定義する。</p>

    <h4>10.4.1 機能権限マトリクス</h4>
    <p>凡例：</p>
    <ul>
        <li><strong>F</strong>: 全機能（Full Control）</li>
        <li><strong>C</strong>: 作成（Create）</li>
        <li><strong>R</strong>: 参照（Read）</li>
        <li><strong>U</strong>: 更新（Update）</li>
        <li><strong>D</strong>: 削除（Delete）</li>
        <li><strong>A</strong>: 承認（Approve）</li>
        <li><strong>-</strong>: アクセス不可（No Access）</li>
    </ul>

    <table>
        <tr>
            <th rowspan="2">機能区分</th>
            <th rowspan="2">機能項目</th>
            <th colspan="3">システムロール</th>
            <th colspan="4">業務管理ロール</th>
            <th colspan="4">業務担当ロール</th>
            <th colspan="3">技術者・外部ロール</th>
        </tr>
        <tr>
            <th>システム管理者</th>
            <th>セキュリティ管理者</th>
            <th>監査者</th>
            <th>営業管理者</th>
            <th>人事管理者</th>
            <th>経理管理者</th>
            <th>品質管理者</th>
            <th>営業担当者</th>
            <th>人事担当者</th>
            <th>経理担当者</th>
            <th>マネージャー</th>
            <th>技術者</th>
            <th>顧客担当者</th>
            <th>協力会社担当者</th>
        </tr>
        <tr>
            <td rowspan="4">案件管理</td>
            <td>案件基本情報</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
        </tr>
        <tr>
            <td>案件詳細情報</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>-</td>
            <td>R</td>
            <td>-</td>
        </tr>
        <tr>
            <td>案件状態管理</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>案件検索</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
        </tr>
        <tr>
            <td rowspan="4">技術者管理</td>
            <td>技術者基本情報</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
            <td>RU</td>
            <td>R</td>
            <td>CRUD</td>
        </tr>
        <tr>
            <td>スキル情報</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>-</td>
            <td>R</td>
            <td>RU</td>
            <td>R</td>
            <td>RU</td>
        </tr>
        <tr>
            <td>稼働状況</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>RU</td>
        </tr>
        <tr>
            <td>評価情報</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>-</td>
            <td>CRUD</td>
            <td>-</td>
            <td>CRUD</td>
            <td>-</td>
            <td>CRUD</td>
            <td>R</td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td rowspan="3">契約管理</td>
            <td>契約基本情報</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
        </tr>
        <tr>
            <td>契約書管理</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>-</td>
            <td>R</td>
            <td>R</td>
        </tr>
        <tr>
            <td>電子署名</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRU</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>RU</td>
            <td>RU</td>
        </tr>
        <tr>
            <td rowspan="3">勤怠工数管理</td>
            <td>勤怠登録</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>RA</td>
            <td>R</td>
            <td>RA</td>
            <td>CRUD</td>
            <td>R</td>
            <td>R</td>
        </tr>
        <tr>
            <td>工数登録</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>RA</td>
            <td>R</td>
            <td>RA</td>
            <td>CRUD</td>
            <td>RA</td>
            <td>R</td>
        </tr>
        <tr>
            <td>勤怠集計</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
        </tr>
        <tr>
            <td rowspan="3">請求支払管理</td>
            <td>請求書作成</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>-</td>
            <td>R</td>
            <td>R</td>
        </tr>
        <tr>
            <td>入金管理</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>支払管理</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>CRUD</td>
            <td>R</td>
            <td>-</td>
            <td>-</td>
            <td>R</td>
        </tr>
        <tr>
            <td rowspan="2">システム管理</td>
            <td>ユーザー管理</td>
            <td>F</td>
            <td>RU</td>
            <td>R</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>マスタ管理</td>
            <td>F</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>R</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
        </tr>
    </table>

    <h4>10.4.2 データアクセス権限</h4>
    <p>データアクセス権限は、基本的な権限に加えて、以下の属性に基づいて動的に制御される：</p>
    <ul>
        <li><strong>組織階層</strong>: 自部門、自部門の配下組織、全組織などの階層関係</li>
        <li><strong>担当関係</strong>: 担当案件、担当顧客、担当技術者などの担当関係</li>
        <li><strong>契約関係</strong>: 契約に紐づくデータへのアクセス制御</li>
        <li><strong>データの機密レベル</strong>: 公開、部門内共有、制限付き、機密などの機密レベル</li>
    </ul>

    <table>
        <tr>
            <th>データカテゴリ</th>
            <th>条件属性</th>
            <th>アクセス条件例</th>
        </tr>
        <tr>
            <td>案件データ</td>
            <td>担当者、部門</td>
            <td>
                <ul>
                    <li>営業担当者: 自身が担当する案件のみ編集可能</li>
                    <li>営業部門マネージャー: 部門の案件を参照可能</li>
                    <li>営業管理者: すべての案件に対する権限を持つ</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>技術者データ</td>
            <td>所属部門、担当者</td>
            <td>
                <ul>
                    <li>人事担当者: 全技術者の基本情報編集可能</li>
                    <li>マネージャー: 部下の技術者情報参照可能</li>
                    <li>技術者: 自身の情報のみ一部編集可能</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>契約データ</td>
            <td>契約当事者、担当者</td>
            <td>
                <ul>
                    <li>営業担当者: 担当契約のみ編集可能</li>
                    <li>顧客担当者: 自社の契約のみ参照可能</li>
                    <li>経理担当者: 請求関連情報のみ編集可能</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>給与・単価データ</td>
            <td>機密レベル、役職</td>
            <td>
                <ul>
                    <li>経理管理者: すべての給与データにアクセス可能</li>
                    <li>マネージャー: 部下の給与データのみ参照可能</li>
                    <li>一般ユーザー: 自身の給与データのみ参照可能</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>勤怠データ</td>
            <td>本人、上長関係</td>
            <td>
                <ul>
                    <li>技術者: 自身の勤怠のみ登録・編集可能</li>
                    <li>マネージャー: 部下の勤怠を承認可能</li>
                    <li>顧客担当者: 契約技術者の勤怠を承認可能</li>
                </ul>
            </td>
        </tr>
    </table>

    <h3>10.5 権限実装</h3>
    <p>権限管理は、以下のコンポーネントを組み合わせて実装する：</p>

    <h4>10.5.1 認証・認可フロー</h4>
    <div class="container">
        <div class="image-placeholder">
            [認証・認可フロー図]<br>
            ここに認証・認可フロー図を挿入
        </div>
    </div>

    <p>主な認証・認可処理フローは以下の通り：</p>
    <ol>
        <li>ユーザーが認証情報を入力</li>
        <li>認証システムがユーザーを認証</li>
        <li>認証成功時、ユーザーの属性情報（ロールを含む）をJWTトークンに格納</li>
        <li>リクエスト時にトークンをAPI Gatewayに送信</li>
        <li>API Gatewayがトークンを検証し、基本的な認可チェック（ロールベース）を実施</li>
        <li>マイクロサービスで詳細な認可チェック（属性ベース）を実施</li>
        <li>データアクセス時にデータレベルの認可チェックを実施</li>
    </ol>

    <h4>10.5.2 技術的実装</h4>
    <p>権限管理の技術的実装は以下の通り：</p>
    <ul>
        <li><strong>認証基盤</strong>: Spring Security + OAuth2.0/OpenID Connect</li>
        <li><strong>認可</strong>: Spring Security ACL + カスタム認可プロバイダー</li>
        <li><strong>権限情報格納</strong>: JWTトークン + 認可サーバーのセッションストア</li>
        <li><strong>データアクセス制御</strong>: データベースビュー + 行レベルセキュリティ + アプリケーションフィルタリング</li>
    </ul>

    <h4>10.5.3 権限管理画面</h4>
    <p>システム管理者向けに以下の権限管理機能を提供する：</p>
    <ul>
        <li><strong>ユーザー管理</strong>: ユーザーの登録・編集・無効化・削除</li>
        <li><strong>ロール管理</strong>: ロールの定義・編集・権限の割り当て</li>
        <li><strong>ユーザーへのロール割り当て</strong>: ユーザーに対するロールの付与・削除</li>
        <li><strong>組織階層管理</strong>: 組織構造の定義と管理</li>
        <li><strong>権限委譲管理</strong>: 一時的な権限委譲の設定</li>
        <li><strong>権限監査</strong>: 権限割り当ての履歴と監査ログの閲覧</li>
    </ul>

    <h3>10.6 権限管理運用</h3>
    <p>権限管理の運用ポリシーを以下のように定める：</p>

    <h4>10.6.1 権限付与プロセス</h4>
    <ol>
        <li><strong>申請</strong>: 権限が必要なユーザーまたはその上長が権限付与を申請</li>
        <li><strong>承認</strong>: 役職や申請内容に応じた承認者が申請を確認・承認</li>
        <li><strong>付与</strong>: システム管理者が承認された権限を付与</li>
        <li><strong>通知</strong>: 権限付与完了をユーザーに通知</li>
        <li><strong>記録</strong>: 権限付与の履歴を監査ログに記録</li>
    </ol>

    <h4>10.6.2 権限管理ポリシー</h4>
    <ul>
        <li><strong>定期的な権限見直し</strong>: 少なくとも年1回、全ユーザーの権限を見直し</li>
        <li><strong>異動時の権限管理</strong>: 人事異動時に自動的に権限を再設定</li>
        <li><strong>退職時の権限削除</strong>: 退職者のアカウントを速やかに無効化</li>
        <li><strong>最小権限の原則遵守</strong>: 必要最小限の権限のみを付与</li>
        <li><strong>権限分離</strong>: 重要な機能は単一のロールで操作できないよう権限を分離</li>
    </ul>

    <h4>10.6.3 権限監査</h4>
    <p>権限の適切な管理のため、以下の監査を実施する：</p>
    <ul>
        <li><strong>権限割り当て監査</strong>: 権限割り当てが適切か定期的に確認</li>
        <li><strong>権限使用監査</strong>: 付与された権限が適切に使用されているか監視</li>
        <li><strong>異常検知</strong>: 権限の異常な使用パターンを検知し通知</li>
        <li><strong>監査ログレビュー</strong>: セキュリティ管理者による定期的な監査ログのレビュー</li>
    </ul>

    <h2 id="error">11. エラー処理設計</h2>
    <p>SES業務システムにおけるエラー処理は、システムの堅牢性と利用者体験の品質を確保するために重要である。本章では、エラー処理の基本方針とその実装方法について詳述する。</p>

    <h3>11.1 エラー処理の基本方針</h3>
    <p>エラー処理の基本方針は以下の通りとする。</p>
    <ul>
        <li><strong>一貫性</strong>: 全てのコンポーネントで一貫したエラー処理方式を採用する</li>
        <li><strong>追跡可能性</strong>: エラーの発生から解決までの追跡が可能な仕組みを提供する</li>
        <li><strong>適切な情報提供</strong>: エンドユーザーには理解可能なメッセージを、開発者には詳細なエラー情報を提供する</li>
        <li><strong>回復可能性</strong>: 可能な限りシステムとユーザー操作の回復手段を提供する</li>
        <li><strong>セキュリティ</strong>: エラー情報による機密情報の漏洩を防止する</li>
    </ul>

    <h3>11.2 エラー分類</h3>
    <p>本システムで扱うエラーを以下のように分類する。</p>

    <table>
        <tr>
            <th>エラー分類</th>
            <th>説明</th>
            <th>処理方針</th>
            <th>主な発生箇所</th>
        </tr>
        <tr>
            <td>入力エラー</td>
            <td>ユーザー入力値の検証エラー</td>
            <td>フロントエンド・バックエンドの両方で検証し、具体的なエラーメッセージをユーザーに提供</td>
            <td>ユーザーインターフェース、Web API</td>
        </tr>
        <tr>
            <td>ビジネスルールエラー</td>
            <td>業務ロジック上の制約違反</td>
            <td>一貫したエラーコードとメッセージを定義し、ユーザーに明確な回避策を提示</td>
            <td>サービス層、ドメイン層</td>
        </tr>
        <tr>
            <td>システムエラー</td>
            <td>内部処理や外部連携の技術的エラー</td>
            <td>詳細ログを記録し、管理者に通知。ユーザーには一般的なエラーメッセージを表示</td>
            <td>データアクセス層、連携サービス</td>
        </tr>
        <tr>
            <td>セキュリティエラー</td>
            <td>認証・認可、不正アクセスに関するエラー</td>
            <td>詳細をログに記録し、セキュリティ監視システムに連携。ユーザーには最小限の情報のみ提供</td>
            <td>認証サービス、API Gateway</td>
        </tr>
        <tr>
            <td>可用性エラー</td>
            <td>サービス停止、過負荷などによるエラー</td>
            <td>代替手段の提示、リトライ機構の提供。運用監視システムへ迅速に通知</td>
            <td>全コンポーネント</td>
        </tr>
    </table>

    <h3>11.3 エラーコード体系</h3>
    <p>エラーコードは以下の体系で定義する。</p>

    <pre>
    E-AABCC
    </pre>

    <ul>
        <li><strong>E-</strong>: エラーを示すプレフィックス</li>
        <li><strong>AA</strong>: モジュールコード（01: 共通, 02: 案件管理, 03: 技術者管理, 04: 契約管理, 05: 勤怠工数管理, 06: 請求支払, 07: マッチング, 08: レポーティング, 09: システム管理）</li>
        <li><strong>B</strong>: エラー分類（1: 入力エラー, 2: ビジネスルールエラー, 3: システムエラー, 4: セキュリティエラー, 5: 可用性エラー）</li>
        <li><strong>CC</strong>: 連番（00-99）</li>
    </ul>

    <p>例:</p>
    <ul>
        <li><strong>E-01101</strong>: 共通モジュールの入力エラー01</li>
        <li><strong>E-03201</strong>: 技術者管理モジュールのビジネスルールエラー01</li>
        <li><strong>E-04301</strong>: 契約管理モジュールのシステムエラー01</li>
    </ul>

    <h3>11.4 フロントエンドのエラー処理</h3>
    <p>フロントエンドでのエラー処理方針を以下に示す。</p>

    <h4>11.4.1 UI表示方法</h4>
    <ul>
        <li><strong>フォームバリデーション</strong>: 入力項目の近くに赤文字でエラーメッセージを表示</li>
        <li><strong>処理エラー</strong>: モーダルダイアログまたはトーストメッセージでエラー内容を表示</li>
        <li><strong>システムエラー</strong>: 専用のエラーページに遷移し、エラーIDと問い合わせ先を表示</li>
        <li><strong>ネットワークエラー</strong>: オフライン状態の表示と、回復時の自動リトライオプションを提供</li>
    </ul>

    <h4>11.4.2 実装方式</h4>
    <p>フロントエンドでのエラー処理は、以下の方式で実装する。</p>
    <ul>
        <li><strong>Reactコンポーネント</strong>: エラーバウンダリによる例外のキャッチと回復</li>
        <li><strong>Redux/状態管理</strong>: グローバルエラー状態の管理と表示制御</li>
        <li><strong>API通信</strong>: Axios インターセプターによるエラーハンドリングと統一処理</li>
        <li><strong>Formライブラリ</strong>: React Hook FormとYupによるバリデーション制御</li>
    </ul>

    <div class="container">
        <div class="image-placeholder">
            [フロントエンドエラー処理フロー図]<br>
            ここにフロントエンドのエラー処理フロー図を挿入
        </div>
    </div>

    <h3>11.5 バックエンドのエラー処理</h3>
    <p>バックエンド（API）でのエラー処理方針を以下に示す。</p>

    <h4>11.5.1 API応答形式</h4>
    <p>エラー発生時のAPI応答は以下のJSON形式で統一する。</p>
    <pre>
    {
      "status": "error",
      "errorCode": "E-AABCC",
      "message": "ユーザー向けエラーメッセージ",
      "details": [
        {
          "field": "該当フィールド名（該当する場合）",
          "message": "詳細エラーメッセージ"
        }
      ],
      "timestamp": "2023-01-01T12:00:00Z",
      "requestId": "リクエスト識別子",
      "path": "/api/v1/resource"
    }
    </pre>

    <h4>11.5.2 実装方式</h4>
    <p>バックエンドでのエラー処理は、以下の方式で実装する。</p>
    <ul>
        <li><strong>例外ハンドリング</strong>: グローバル例外ハンドラーによる統一的な例外処理</li>
        <li><strong>ビジネス例外</strong>: 独自の例外階層を定義し、業務ロジックで明示的に発生させる</li>
        <li><strong>バリデーション</strong>: Bean Validationと独自バリデーターの組み合わせ</li>
        <li><strong>ログ連携</strong>: 例外発生時に構造化ログを自動記録</li>
        <li><strong>監視連携</strong>: 重大なエラー発生時に監視システムへ通知</li>
    </ul>

    <div class="container">
        <div class="image-placeholder">
            [バックエンドエラー処理フロー図]<br>
            ここにバックエンドのエラー処理フロー図を挿入
        </div>
    </div>

    <h3>11.6 データアクセスレイヤーのエラー処理</h3>
    <p>データアクセスレイヤーにおけるエラー処理方針を以下に示す。</p>
    <ul>
        <li><strong>トランザクション管理</strong>: 適切なトランザクション境界の設定とロールバック制御</li>
        <li><strong>コネクション管理</strong>: コネクションプールの監視とタイムアウト制御</li>
        <li><strong>リトライ機構</strong>: 一時的なエラーに対する適切なバックオフとリトライ</li>
        <li><strong>デッドロック対策</strong>: 楽観的ロックの採用と競合検出機構</li>
        <li><strong>整合性確保</strong>: データ整合性エラーの検出と回復手順</li>
    </ul>

    <h3>11.7 外部連携のエラー処理</h3>
    <p>外部システムとの連携におけるエラー処理方針を以下に示す。</p>
    <ul>
        <li><strong>タイムアウト設定</strong>: 適切なタイムアウト値の設定と監視</li>
        <li><strong>サーキットブレーカー</strong>: 障害検知による一時的なサービス利用停止と自動回復</li>
        <li><strong>フォールバック機構</strong>: 代替処理パスの用意</li>
        <li><strong>非同期処理</strong>: 重要な連携処理の非同期化とリトライキュー</li>
        <li><strong>整合性確保</strong>: べき等性の保証とトランザクションID管理</li>
    </ul>

    <div class="container">
        <div class="image-placeholder">
            [外部連携エラー処理パターン図]<br>
            ここに外部連携のエラー処理パターン図を挿入
        </div>
    </div>

    <h3>11.8 運用面のエラー対応</h3>
    <p>システム運用におけるエラー対応方針を以下に示す。</p>
    <ul>
        <li><strong>エラーモニタリング</strong>: リアルタイムでのエラー発生状況監視</li>
        <li><strong>エラー分析</strong>: エラーログ集計と傾向分析</li>
        <li><strong>自動対応</strong>: 特定パターンのエラーに対する自動復旧処理</li>
        <li><strong>エスカレーション</strong>: エラーの重要度に応じた通知先と対応手順</li>
        <li><strong>ユーザー支援</strong>: エラー発生時のサポート体制とナレッジベース</li>
    </ul>

    <h4>11.8.1 監視項目</h4>
    <table>
        <tr>
            <th>監視項目</th>
            <th>閾値</th>
            <th>通知先</th>
            <th>対応方針</th>
        </tr>
        <tr>
            <td>システムエラー発生率</td>
            <td>1分間に5件以上</td>
            <td>システム管理者、開発チーム</td>
            <td>即時調査、必要に応じてロールバック</td>
        </tr>
        <tr>
            <td>特定APIのエラー率</td>
            <td>10%以上</td>
            <td>開発チーム、運用担当者</td>
            <td>該当APIの診断、代替手段の案内</td>
        </tr>
        <tr>
            <td>DB接続エラー</td>
            <td>1件以上</td>
            <td>DBA、システム管理者</td>
            <td>DB状態確認、コネクションプール再設定</td>
        </tr>
        <tr>
            <td>外部連携エラー</td>
            <td>連続3回以上</td>
            <td>システム管理者、連携先担当者</td>
            <td>連携先状態確認、代替処理パスへの切替</td>
        </tr>
    </table>

    <h3>11.9 エラーメッセージ管理</h3>
    <p>エラーメッセージの管理方針を以下に示す。</p>
    <ul>
        <li><strong>メッセージの外部化</strong>: プロパティファイルによるメッセージ定義</li>
        <li><strong>多言語対応</strong>: 日本語・英語の基本対応</li>
        <li><strong>メッセージの構成</strong>: [エラーコード] メッセージ本文 (対処方法)</li>
        <li><strong>プレースホルダー</strong>: メッセージ内の動的部分は{0}形式のプレースホルダーで定義</li>
    </ul>

    <p>例：</p>
    <pre>
    # プロパティファイル例
    E-01101=入力された{0}は必須項目です。値を入力してください。
    E-03201=指定された技術者は既に{0}案件にアサイン済みです。別の技術者を選択してください。
    E-04301=契約書生成中にエラーが発生しました。しばらく経ってから再試行してください。(エラーID: {0})
    </pre>

    <h2 id="logging">12. ログ設計</h2>
    <p>本章では、SES業務システムにおけるログ設計について定義する。システムの運用・監視・障害対応・セキュリティ対策を効果的に行うため、適切なログ収集・分析基盤を構築する。</p>

    <h3>12.1 ログ設計の基本方針</h3>
    <p>ログ設計の基本方針は以下の通りとする。</p>
    <ul>
        <li><strong>統一性</strong>: 全コンポーネントで統一されたログ形式とレベルを採用</li>
        <li><strong>追跡可能性</strong>: リクエスト単位での一連の処理の追跡が可能</li>
        <li><strong>分析可能性</strong>: ログの集中管理と分析が容易な構造化ログの採用</li>
        <li><strong>セキュリティ</strong>: 機密情報のマスキングと適切なアクセス制御</li>
        <li><strong>パフォーマンス</strong>: ログ出力によるシステムパフォーマンスへの影響を最小化</li>
    </ul>

    <h3>12.2 ログの分類</h3>
    <p>システムで収集するログを以下のように分類する。</p>

    <table>
        <tr>
            <th>ログ種別</th>
            <th>概要</th>
            <th>主な目的</th>
            <th>保存期間</th>
        </tr>
        <tr>
            <td>アプリケーションログ</td>
            <td>アプリケーションの動作状況を記録</td>
            <td>障害調査、パフォーマンス分析</td>
            <td>90日</td>
        </tr>
        <tr>
            <td>アクセスログ</td>
            <td>APIや画面へのアクセス情報を記録</td>
            <td>アクセス監視、不正アクセス検知</td>
            <td>180日</td>
        </tr>
        <tr>
            <td>監査ログ</td>
            <td>重要業務アクションを記録</td>
            <td>内部統制、セキュリティ監査</td>
            <td>5年</td>
        </tr>
        <tr>
            <td>エラーログ</td>
            <td>障害やエラー情報を記録</td>
            <td>障害対応、品質改善</td>
            <td>1年</td>
        </tr>
        <tr>
            <td>パフォーマンスログ</td>
            <td>システムのパフォーマンス指標を記録</td>
            <td>性能監視、ボトルネック特定</td>
            <td>30日</td>
        </tr>
        <tr>
            <td>デバッグログ</td>
            <td>詳細なデバッグ情報を記録</td>
            <td>開発時のデバッグ</td>
            <td>7日（本番環境では基本的に無効）</td>
        </tr>
    </table>

    <h3>12.3 ログレベル定義</h3>
    <p>ログレベルは以下のように定義し、環境ごとに出力レベルを制御する。</p>

    <table>
        <tr>
            <th>レベル</th>
            <th>概要</th>
            <th>使用方針</th>
            <th>環境ごとの設定</th>
        </tr>
        <tr>
            <td>FATAL</td>
            <td>システムの継続が困難な致命的な問題</td>
            <td>システム停止やデータ破損につながる重大なエラー</td>
            <td>全環境で出力</td>
        </tr>
        <tr>
            <td>ERROR</td>
            <td>エラー状態だが、システムは継続可能</td>
            <td>予期しない例外、外部システム連携失敗など</td>
            <td>全環境で出力</td>
        </tr>
        <tr>
            <td>WARN</td>
            <td>警告レベルの問題</td>
            <td>将来的に問題となる可能性がある状況、性能低下の兆候など</td>
            <td>全環境で出力</td>
        </tr>
        <tr>
            <td>INFO</td>
            <td>重要な業務イベント</td>
            <td>ユーザーログイン、重要業務処理の開始・完了など</td>
            <td>全環境で出力</td>
        </tr>
        <tr>
            <td>DEBUG</td>
            <td>開発・デバッグ用の詳細情報</td>
            <td>メソッド呼び出し、詳細パラメータなど</td>
            <td>開発・テスト環境のみ出力</td>
        </tr>
        <tr>
            <td>TRACE</td>
            <td>最も詳細なデバッグ情報</td>
            <td>詳細なデータダンプ、ループ内処理など</td>
            <td>開発環境のみ必要時に出力</td>
        </tr>
    </table>

    <h3>12.4 ログ出力内容</h3>
    <p>各ログには以下の情報を含める。</p>

    <h4>12.4.1 共通項目</h4>
    <table>
        <tr>
            <th>項目</th>
            <th>説明</th>
            <th>例</th>
        </tr>
        <tr>
            <td>timestamp</td>
            <td>ログ記録日時（ISO 8601形式）</td>
            <td>2023-01-01T12:34:56.789Z</td>
        </tr>
        <tr>
            <td>level</td>
            <td>ログレベル</td>
            <td>INFO, ERROR など</td>
        </tr>
        <tr>
            <td>service</td>
            <td>サービス（マイクロサービス）名</td>
            <td>contract-service</td>
        </tr>
        <tr>
            <td>instance</td>
            <td>サーバーインスタンス識別子</td>
            <td>contract-service-pod-8a7b6c5d</td>
        </tr>
        <tr>
            <td>thread</td>
            <td>スレッド名</td>
            <td>http-nio-8080-exec-1</td>
        </tr>
        <tr>
            <td>logger</td>
            <td>ロガー名（クラス名）</td>
            <td>jp.co.sesmanager.contract.service.ContractServiceImpl</td>
        </tr>
        <tr>
            <td>traceId</td>
            <td>分散トレース用ID</td>
            <td>4a7b9c3d2e1f8a7b9c3d2e1f</td>
        </tr>
        <tr>
            <td>userId</td>
            <td>ユーザーID（認証済みの場合）</td>
            <td>user_12345</td>
        </tr>
        <tr>
            <td>message</td>
            <td>ログメッセージ本文</td>
            <td>Contract created successfully</td>
        </tr>
    </table>

    <h4>12.4.2 種別ごとの固有項目</h4>

    <h5>アプリケーションログ追加項目</h5>
    <ul>
        <li><strong>methodName</strong>: 実行メソッド名</li>
        <li><strong>elapsedTime</strong>: 処理時間（ミリ秒）</li>
        <li><strong>context</strong>: 処理コンテキスト情報</li>
    </ul>

    <h5>アクセスログ追加項目</h5>
    <ul>
        <li><strong>remoteIp</strong>: クライアントIPアドレス</li>
        <li><strong>method</strong>: HTTPメソッド</li>
        <li><strong>path</strong>: リクエストパス</li>
        <li><strong>query</strong>: クエリパラメータ（機密情報マスク済み）</li>
        <li><strong>userAgent</strong>: ユーザーエージェント</li>
        <li><strong>referer</strong>: リファラー</li>
        <li><strong>statusCode</strong>: HTTPステータスコード</li>
        <li><strong>responseTime</strong>: レスポンス時間（ミリ秒）</li>
        <li><strong>bodySize</strong>: レスポンスボディサイズ（バイト）</li>
    </ul>

    <h5>監査ログ追加項目</h5>
    <ul>
        <li><strong>action</strong>: 実行されたアクション種別</li>
        <li><strong>resource</strong>: 操作対象リソース種別</li>
        <li><strong>resourceId</strong>: 操作対象リソースID</li>
        <li><strong>beforeState</strong>: 変更前の状態（サマリーのみ）</li>
        <li><strong>afterState</strong>: 変更後の状態（サマリーのみ）</li>
        <li><strong>ipAddress</strong>: 操作元IPアドレス</li>
        <li><strong>success</strong>: 操作成功フラグ</li>
    </ul>

    <h5>エラーログ追加項目</h5>
    <ul>
        <li><strong>errorCode</strong>: エラーコード</li>
        <li><strong>exceptionClass</strong>: 例外クラス名</li>
        <li><strong>exceptionMessage</strong>: 例外メッセージ</li>
        <li><strong>stackTrace</strong>: スタックトレース（要約版）</li>
        <li><strong>rootCause</strong>: 根本原因</li>
    </ul>

    <h5>パフォーマンスログ追加項目</h5>
    <ul>
        <li><strong>operation</strong>: 計測対象操作</li>
        <li><strong>duration</strong>: 処理時間（ミリ秒）</li>
        <li><strong>memoryUsage</strong>: メモリ使用量</li>
        <li><strong>cpuUsage</strong>: CPU使用率</li>
        <li><strong>databaseCalls</strong>: データベース呼び出し回数</li>
        <li><strong>externalCalls</strong>: 外部サービス呼び出し回数</li>
    </ul>

    <h3>12.5 ログ出力形式</h3>
    <p>ログは以下の形式で出力する。</p>

    <h4>12.5.1 JSON形式</h4>
    <p>主に分析・監視用途向けにJSON形式でログを出力する。</p>
    <pre>
    {
      "timestamp": "2023-01-01T12:34:56.789Z",
      "level": "INFO",
      "service": "contract-service",
      "instance": "contract-service-pod-8a7b6c5d",
      "thread": "http-nio-8080-exec-1",
      "logger": "jp.co.sesmanager.contract.service.ContractServiceImpl",
      "traceId": "4a7b9c3d2e1f8a7b9c3d2e1f",
      "userId": "user_12345",
      "message": "Contract created successfully",
      "methodName": "createContract",
      "elapsedTime": 235,
      "context": {
        "contractId": "CNT-2023-00123",
        "customerId": "CUST-456",
        "engineerId": "ENG-789"
      }
    }
    </pre>

    <h4>12.5.2 テキスト形式</h4>
    <p>開発時のコンソール表示用にテキスト形式でも出力する。</p>
    <pre>
    2023-01-01 12:34:56.789 [INFO] [contract-service] [http-nio-8080-exec-1] [4a7b9c3d2e1f] [user_12345] jp.co.sesmanager.contract.service.ContractServiceImpl - Contract created successfully - contractId: CNT-2023-00123
    </pre>

    <h3>12.6 ログアーキテクチャ</h3>
    <p>ログ収集・分析のためのアーキテクチャを以下のように定義する。</p>

    <div class="container">
        <div class="image-placeholder">
            [ログアーキテクチャ図]<br>
            ここにログアーキテクチャ図を挿入
        </div>
    </div>

    <h4>12.6.1 コンポーネント構成</h4>
    <table>
        <tr>
            <th>コンポーネント</th>
            <th>役割</th>
            <th>製品選定</th>
        </tr>
        <tr>
            <td>ログ生成</td>
            <td>アプリケーションからのログ出力</td>
            <td>SLF4J + Logback（アプリ）、NGINX（Webサーバー）、PostgreSQL（データベース）</td>
        </tr>
        <tr>
            <td>ログ収集</td>
            <td>各サーバーからのログファイル収集</td>
            <td>Filebeat、Fluentd</td>
        </tr>
        <tr>
            <td>ログ転送</td>
            <td>収集したログの転送と前処理</td>
            <td>Logstash</td>
        </tr>
        <tr>
            <td>ログストレージ</td>
            <td>ログの永続化と検索</td>
            <td>Elasticsearch</td>
        </tr>
        <tr>
            <td>ログ可視化</td>
            <td>ログの分析・可視化</td>
            <td>Kibana、Grafana</td>
        </tr>
        <tr>
            <td>アラート生成</td>
            <td>ログパターンに基づくアラート</td>
            <td>Elasticsearch Watcher、Alertmanager</td>
        </tr>
        <tr>
            <td>分散トレーシング</td>
            <td>サービスをまたぐ処理の追跡</td>
            <td>Jaeger、Zipkin</td>
        </tr>
    </table>

    <h4>12.6.2 データフロー</h4>
    <ol>
        <li>アプリケーションがログを生成（ファイルまたはsyslog）</li>
        <li>Filebeat/Fluentdがログを収集</li>
        <li>Logstashがログを整形・強化（IP位置情報付与、機密情報マスキングなど）</li>
        <li>Elasticsearchにログを保存</li>
        <li>Kibana/Grafanaでログを可視化</li>
        <li>Elasticsearch Watcherがパターンマッチでアラート生成</li>
    </ol>

    <h3>12.7 監査ログの要件</h3>
    <p>特に重要な監査ログについては、以下の要件を満たす実装とする。</p>

    <h4>12.7.1 監査対象アクション</h4>
    <p>以下のアクションを監査対象とし、必ず監査ログを記録する。</p>
    <ul>
        <li><strong>認証関連</strong>: ログイン成功/失敗、ログアウト、パスワード変更、多要素認証</li>
        <li><strong>権限関連</strong>: 権限の付与/変更/剥奪、権限昇格、アクセス拒否</li>
        <li><strong>データ操作</strong>: 重要データの作成/読取/更新/削除</li>
        <li><strong>設定変更</strong>: システム設定、マスターデータ、セキュリティ設定の変更</li>
        <li><strong>システム操作</strong>: バッチ処理の開始/完了、インポート/エクスポート、連携処理</li>
    </ul>

    <h4>12.7.2 監査ログの保全</h4>
    <p>監査ログの完全性と機密性を確保するため、以下の対策を実施する。</p>
    <ul>
        <li><strong>改ざん防止</strong>: ログの書き込み専用アクセス、ハッシュによる整合性検証</li>
        <li><strong>アクセス制限</strong>: 監査ログへのアクセスは監査権限を持つユーザーのみに制限</li>
        <li><strong>長期保存</strong>: 規定期間（5年間）のログ保存、定期的なアーカイブ</li>
        <li><strong>バックアップ</strong>: 定期的なバックアップと異なるストレージへの複製</li>
    </ul>

    <h3>12.8 開発ガイドライン</h3>
    <p>開発者向けのログ出力ガイドラインを以下に示す。</p>

    <h4>12.8.1 ログ出力のベストプラクティス</h4>
    <ul>
        <li><strong>適切なレベル選択</strong>: ログレベルの定義に従い、適切なレベルでログを出力</li>
        <li><strong>構造化情報</strong>: 単純な文字列結合ではなく、構造化されたコンテキスト情報を提供</li>
        <li><strong>機密情報の保護</strong>: パスワード、個人情報、機密データをログに出力しない</li>
        <li><strong>例外スタックトレース</strong>: 例外のスタックトレースを適切に記録</li>
        <li><strong>コンテキスト維持</strong>: MDC（Mapped Diagnostic Context）を活用</li>
        <li><strong>パフォーマンス考慮</strong>: ログ出力のパフォーマンス影響を最小化</li>
    </ul>

    <h4>12.8.2 出力サンプル</h4>
    <p>推奨されるログ出力パターンの実装例：</p>

    <pre>
    // Javaでの実装例
    // 良いパターン
    logger.info("Contract created for customer: {}, engineer: {}", customerId, engineerId);
    
    try {
        // 処理
    } catch (Exception e) {
        logger.error("Failed to process payment: {}", paymentId, e);
    }
    
    // MDCの活用
    MDC.put("traceId", generateTraceId());
    MDC.put("userId", currentUser.getId());
    logger.info("Processing request");
    
    // 悪いパターン（避けるべき）
    logger.debug("Contract data: " + contractJson); // 大量のデータを文字列結合
    logger.info("User password changed to: " + newPassword); // 機密情報の露出
    </pre>

    <h3>12.9 運用管理</h3>
    <p>ログの運用管理方針を以下に示す。</p>

    <h4>12.9.1 容量管理</h4>
    <ul>
        <li><strong>ローテーション</strong>: 日次でのログローテーション</li>
        <li><strong>圧縮</strong>: 古いログファイルの自動圧縮</li>
        <li><strong>削除</strong>: 保存期間を超えたログの自動削除</li>
        <li><strong>アーカイブ</strong>: 長期保存が必要なログの安価なストレージへの移動</li>
        <li><strong>容量監視</strong>: ログストレージの容量監視とアラート設定</li>
    </ul>

    <h4>12.9.2 パフォーマンス管理</h4>
    <ul>
        <li><strong>非同期ログ出力</strong>: アプリケーションのパフォーマンスへの影響を軽減</li>
        <li><strong>バッファリング</strong>: ログ転送時のバッファリングによる効率化</li>
        <li><strong>インデックス最適化</strong>: Elasticsearchのインデックス戦略の最適化</li>
        <li><strong>シャーディング</strong>: 高ボリュームログのシャーディングによる分散</li>
        <li><strong>クエリ最適化</strong>: 頻繁に使用されるログ検索クエリの最適化</li>
    </ul>

    <h4>12.9.3 監視・分析</h4>
    <ul>
        <li><strong>ダッシュボード</strong>: 主要なログ指標をまとめたダッシュボードの整備</li>
        <li><strong>アラート</strong>: 重要なログパターンに対するアラート設定</li>
        <li><strong>定期レポート</strong>: ログ分析の定期レポート生成</li>
        <li><strong>異常検知</strong>: 機械学習による異常パターンの検出</li>
        <li><strong>セキュリティ分析</strong>: セキュリティインシデントの検出と分析</li>
    </ul>

    <h2 id="monitoring">13. 監視設計</h2>
    <p>本章では、SES業務システムの運用状況を継続的に把握し、問題の早期発見・対応を可能にするための監視設計について記述する。</p>

    <h3>13.1 監視設計の基本方針</h3>
    <p>監視設計の基本方針は以下の通りとする。</p>
    <ul>
        <li><strong>網羅性</strong>: インフラからアプリケーションまで全レイヤーを監視対象とする</li>
        <li><strong>予防的監視</strong>: 問題発生前の予兆を検知し、事前対応を可能にする</li>
        <li><strong>自動検知</strong>: 異常の自動検知とアラート通知による迅速な対応</li>
        <li><strong>可視化</strong>: システム状態の直感的な可視化によるモニタリング</li>
        <li><strong>相関分析</strong>: 複数指標の相関関係から真の原因を特定</li>
    </ul>

    <h3>13.2 監視レイヤー構成</h3>
    <p>監視対象を以下のレイヤーに分類し、それぞれに適した監視項目と手法を定義する。</p>

    <table>
        <tr>
            <th>監視レイヤー</th>
            <th>概要</th>
            <th>主な監視対象</th>
            <th>監視ツール</th>
        </tr>
        <tr>
            <td>インフラストラクチャ監視</td>
            <td>物理/仮想リソースの状態監視</td>
            <td>サーバー、ネットワーク、ストレージ</td>
            <td>Prometheus、Node Exporter</td>
        </tr>
        <tr>
            <td>プラットフォーム監視</td>
            <td>ミドルウェアや実行環境の監視</td>
            <td>Kubernetes、データベース、メッセージキュー</td>
            <td>kube-state-metrics、JMX Exporter</td>
        </tr>
        <tr>
            <td>アプリケーション監視</td>
            <td>アプリケーション自体の動作監視</td>
            <td>API、サービス、バッチ処理</td>
            <td>Spring Boot Actuator、Micrometer</td>
        </tr>
        <tr>
            <td>ビジネスプロセス監視</td>
            <td>業務フローの進行状況監視</td>
            <td>業務KPI、処理件数、エラー率</td>
            <td>カスタムメトリクス、Grafana</td>
        </tr>
        <tr>
            <td>エンドユーザー体験監視</td>
            <td>実際のユーザー体験の監視</td>
            <td>レスポンスタイム、エラー率、UI操作</td>
            <td>Synthetic Monitoring、RUM</td>
        </tr>
    </table>

    <h3>13.3 監視対象と指標</h3>
    <p>各監視レイヤーにおける主要な監視対象と指標を定義する。</p>

    <h4>13.3.1 インフラストラクチャ監視</h4>
    <table>
        <tr>
            <th>監視対象</th>
            <th>監視指標</th>
            <th>閾値（警告/重大）</th>
            <th>監視間隔</th>
        </tr>
        <tr>
            <td>CPU</td>
            <td>CPU使用率</td>
            <td>70% / 90%</td>
            <td>30秒</td>
        </tr>
        <tr>
            <td>メモリ</td>
            <td>メモリ使用率</td>
            <td>80% / 95%</td>
            <td>30秒</td>
        </tr>
        <tr>
            <td>ディスク</td>
            <td>ディスク使用率</td>
            <td>75% / 90%</td>
            <td>5分</td>
        </tr>
        <tr>
            <td>ディスクI/O</td>
            <td>I/O待ち時間</td>
            <td>100ms / 500ms</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>ネットワーク</td>
            <td>インターフェース使用率</td>
            <td>60% / 80%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>ネットワーク</td>
            <td>パケット損失率</td>
            <td>1% / 5%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>プロセス</td>
            <td>プロセス数</td>
            <td>定義による</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>負荷</td>
            <td>ロードアベレージ</td>
            <td>CPU数×0.7 / CPU数×0.9</td>
            <td>1分</td>
        </tr>
    </table>

    <h4>13.3.2 プラットフォーム監視</h4>
    <h5>Kubernetes</h5>
    <table>
        <tr>
            <th>監視対象</th>
            <th>監視指標</th>
            <th>閾値（警告/重大）</th>
            <th>監視間隔</th>
        </tr>
        <tr>
            <td>ノード</td>
            <td>ノード状態</td>
            <td>NotReady</td>
            <td>30秒</td>
        </tr>
        <tr>
            <td>ポッド</td>
            <td>ポッド状態</td>
            <td>Pending/Failed/Unknown</td>
            <td>30秒</td>
        </tr>
        <tr>
            <td>ポッド</td>
            <td>再起動回数</td>
            <td>3回 / 5回(10分間)</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>デプロイメント</td>
            <td>利用可能レプリカ率</td>
            <td>80% / 50%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>リソース</td>
            <td>リソース要求vs割り当て</td>
            <td>90% / 100%</td>
            <td>5分</td>
        </tr>
    </table>

    <h5>データベース（PostgreSQL）</h5>
    <table>
        <tr>
            <th>監視対象</th>
            <th>監視指標</th>
            <th>閾値（警告/重大）</th>
            <th>監視間隔</th>
        </tr>
        <tr>
            <td>接続</td>
            <td>接続数</td>
            <td>最大接続数の70% / 90%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>接続</td>
            <td>接続エラー率</td>
            <td>5% / 10%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>パフォーマンス</td>
            <td>クエリ実行時間</td>
            <td>1秒 / 5秒</td>
            <td>5分</td>
        </tr>
        <tr>
            <td>パフォーマンス</td>
            <td>スロークエリ数</td>
            <td>10件 / 50件(10分間)</td>
            <td>10分</td>
        </tr>
        <tr>
            <td>ストレージ</td>
            <td>テーブルサイズ増加率</td>
            <td>10% / 20%(日次)</td>
            <td>1時間</td>
        </tr>
        <tr>
            <td>レプリケーション</td>
            <td>レプリケーション遅延</td>
            <td>10秒 / 60秒</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>バックアップ</td>
            <td>最終バックアップ経過時間</td>
            <td>25時間 / 36時間</td>
            <td>1時間</td>
        </tr>
    </table>

    <h4>13.3.3 アプリケーション監視</h4>
    <table>
        <tr>
            <th>監視対象</th>
            <th>監視指標</th>
            <th>閾値（警告/重大）</th>
            <th>監視間隔</th>
        </tr>
        <tr>
            <td>API</td>
            <td>レスポンスタイム(90パーセンタイル)</td>
            <td>2秒 / 5秒</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>API</td>
            <td>エラー率</td>
            <td>1% / 5%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>API</td>
            <td>リクエスト数</td>
            <td>通常の150% / 200%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>サービス</td>
            <td>サービス可用性</td>
            <td>99% / 95%</td>
            <td>5分</td>
        </tr>
        <tr>
            <td>サービス</td>
            <td>依存サービスのヘルスステータス</td>
            <td>警告 / エラー</td>
            <td>30秒</td>
        </tr>
        <tr>
            <td>JVM</td>
            <td>ヒープメモリ使用率</td>
            <td>70% / 85%</td>
            <td>30秒</td>
        </tr>
        <tr>
            <td>JVM</td>
            <td>GC頻度</td>
            <td>5回/分 / 10回/分</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>JVM</td>
            <td>GC時間</td>
            <td>累積時間の10% / 20%</td>
            <td>1分</td>
        </tr>
        <tr>
            <td>スレッド</td>
            <td>アクティブスレッド数</td>
            <td>スレッドプール最大の70% / 90%</td>
            <td>30秒</td>
        </tr>
        <tr>
            <td>キャッシュ</td>
            <td>キャッシュヒット率</td>
            <td>80%以下 / 60%以下</td>
            <td>5分</td>
        </tr>
    </table>

    <h4>13.3.4 ビジネスプロセス監視</h4>
    <table>
        <tr>
            <th>監視対象</th>
            <th>監視指標</th>
            <th>閾値（警告/重大）</th>
            <th>監視間隔</th>
        </tr>
        <tr>
            <td>契約処理</td>
            <td>新規契約作成数</td>
            <td>前週比±30% / ±50%</td>
            <td>1時間</td>
        </tr>
        <tr>
            <td>技術者マッチング</td>
            <td>マッチング処理完了率</td>
            <td>95% / 90%</td>
            <td>1時間</td>
        </tr>
        <tr>
            <td>技術者マッチング</td>
            <td>マッチングスコア平均値</td>
            <td>前週比-10% / -20%</td>
            <td>1日</td>
        </tr>
        <tr>
            <td>請求処理</td>
            <td>請求書生成エラー率</td>
            <td>1% / 5%</td>
            <td>1時間</td>
        </tr>
        <tr>
            <td>勤怠登録</td>
            <td>勤怠登録完了率</td>
            <td>当月95%未満 / 90%未満</td>
            <td>1日</td>
        </tr>
        <tr>
            <td>工数報告</td>
            <td>未承認工数報告数</td>
            <td>前週比+20% / +40%</td>
            <td>1日</td>
        </tr>
        <tr>
            <td>外部連携</td>
            <td>連携処理成功率</td>
            <td>98% / 95%</td>
            <td>1時間</td>
        </tr>
    </table>

    <h4>13.3.5 エンドユーザー体験監視</h4>
    <table>
        <tr>
            <th>監視対象</th>
            <th>監視指標</th>
            <th>閾値（警告/重大）</th>
            <th>監視間隔</th>
        </tr>
        <tr>
            <td>ページロード</td>
            <td>ページ読み込み時間</td>
            <td>3秒 / 5秒</td>
            <td>5分</td>
        </tr>
        <tr>
            <td>ページロード</td>
            <td>First Contentful Paint</td>
            <td>1.5秒 / 3秒</td>
            <td>5分</td>
        </tr>
        <tr>
            <td>UI操作</td>
            <td>UI応答時間</td>
            <td>500ms / 1秒</td>
            <td>5分</td>
        </tr>
        <tr>
            <td>エラー</td>
            <td>JSエラー発生率</td>
            <td>1% / 5%</td>
            <td>5分</td>
        </tr>
        <tr>
            <td>ユーザーフロー</td>
            <td>主要業務フロー完了率</td>
            <td>95% / 90%</td>
            <td>1時間</td>
        </tr>
        <tr>
            <td>セッション</td>
            <td>セッション異常終了率</td>
            <td>10% / 20%</td>
            <td>15分</td>
        </tr>
    </table>

    <h3>13.4 監視アーキテクチャ</h3>
    <p>システム監視のためのアーキテクチャを以下のように定義する。</p>

    <div class="container">
        <div class="image-placeholder">
            [監視アーキテクチャ図]<br>
            ここに監視アーキテクチャ図を挿入
        </div>
    </div>

    <h4>13.4.1 監視コンポーネント構成</h4>
    <table>
        <tr>
            <th>コンポーネント</th>
            <th>役割</th>
            <th>製品選定</th>
        </tr>
        <tr>
            <td>メトリクス収集</td>
            <td>各種指標データの収集</td>
            <td>Prometheus、Telegraf</td>
        </tr>
        <tr>
            <td>メトリクスストレージ</td>
            <td>時系列データの永続化</td>
            <td>Prometheus TSDB、InfluxDB</td>
        </tr>
        <tr>
            <td>可視化</td>
            <td>メトリクスのダッシュボード表示</td>
            <td>Grafana</td>
        </tr>
        <tr>
            <td>アラート生成</td>
            <td>閾値超過時のアラート発生</td>
            <td>Prometheus Alertmanager</td>
        </tr>
        <tr>
            <td>通知</td>
            <td>アラートの通知配信</td>
            <td>Slack、メール、OpsGenie</td>
        </tr>
        <tr>
            <td>サービス監視</td>
            <td>外部からのサービス可用性チェック</td>
            <td>Blackbox Exporter、Synthetic Monitoring</td>
        </tr>
        <tr>
            <td>ログ連携</td>
            <td>ログとメトリクスの統合分析</td>
            <td>Loki、Elasticsearch</td>
        </tr>
        <tr>
            <td>トレース連携</td>
            <td>分散トレースとの連携</td>
            <td>Jaeger、Zipkin</td>
        </tr>
    </table>

    <h4>13.4.2 データフロー</h4>
    <ol>
        <li>Prometheusが各種Exporterからメトリクスをスクレイプ</li>
        <li>アプリケーションが/actuator/prometheusエンドポイントでメトリクスを公開</li>
        <li>Prometheusがメトリクスをローカルストレージに保存</li>
        <li>長期保存用メトリクスは外部ストレージに転送</li>
        <li>Grafanaが各種データソースからデータを取得し可視化</li>
        <li>Alertmanagerがアラートルールに基づきアラートを生成</li>
        <li>アラートはSilence/Inhibitなどのフィルタリングを経て通知</li>
    </ol>

    <h3>13.5 アラート設計</h3>
    <p>アラートの分類と通知先を以下のように定義する。</p>

    <h4>13.5.1 アラート重要度</h4>
    <table>
        <tr>
            <th>重要度</th>
            <th>定義</th>
            <th>対応時間</th>
            <th>通知方法</th>
        </tr>
        <tr>
            <td>Critical</td>
            <td>サービスが停止しているか、重大な機能障害が発生している</td>
            <td>即時（24時間365日）</td>
            <td>電話、SMS、Slack、メール</td>
        </tr>
        <tr>
            <td>High</td>
            <td>サービスに一部影響があるか、放置すると重大な問題になる恐れがある</td>
            <td>30分以内（営業時間）、2時間以内（営業時間外）</td>
            <td>SMS、Slack、メール</td>
        </tr>
        <tr>
            <td>Medium</td>
            <td>サービスへの影響は限定的だが、対応が必要な問題</td>
            <td>営業時間内に対応</td>
            <td>Slack、メール</td>
        </tr>
        <tr>
            <td>Low</td>
            <td>サービスへの直接的な影響はないが、調査が必要な事象</td>
            <td>翌営業日以降に対応</td>
            <td>Slack、メール</td>
        </tr>
        <tr>
            <td>Info</td>
            <td>情報提供のみ、即時対応不要</td>
            <td>対応不要</td>
            <td>ダッシュボード、ログ</td>
        </tr>
    </table>

    <h4>13.5.2 アラートルール設計</h4>
    <p>アラートルールの例：</p>
    <pre>
    # CPU使用率の高負荷アラート
    alert: HighCpuLoad
    expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 90
    for: 5m
    labels:
      severity: high
    annotations:
      summary: "High CPU load (instance {{ $labels.instance }})"
      description: "CPU load is > 90%\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"

    # APIエラー率アラート
    alert: HighApiErrorRate
    expr: sum(rate(http_server_requests_seconds_count{status=~"5.."}[5m])) / sum(rate(http_server_requests_seconds_count[5m])) > 0.05
    for: 2m
    labels:
      severity: high
    annotations:
      summary: "High API error rate"
      description: "Error rate is > 5% (current value: {{ $value | humanizePercentage }})"
    </pre>

    <h4>13.5.3 アラート抑制とグルーピング</h4>
    <p>アラートの効率的な管理のため、以下の抑制・グルーピングルールを設定する：</p>
    <ul>
        <li><strong>抑制</strong>: ノード障害発生時に、そのノード上のサービス個別アラートを抑制</li>
        <li><strong>抑制</strong>: ネットワーク障害発生時に、関連サービスの接続エラーアラートを抑制</li>
        <li><strong>グルーピング</strong>: 同一サービスの複数インスタンスのアラートをグループ化</li>
        <li><strong>グルーピング</strong>: 同一原因と推測される複数種類のアラートをグループ化</li>
        <li><strong>静寂化</strong>: 計画メンテナンス時に特定アラートを一時的に無効化</li>
    </ul>

    <h3>13.6 ダッシュボード設計</h3>
    <p>監視ダッシュボードを以下のように構成する。</p>

    <h4>13.6.1 ダッシュボード階層</h4>
    <ol>
        <li><strong>トップレベルダッシュボード</strong>: 全体状況の俯瞰
            <ul>
                <li>システム全体のヘルスステータス</li>
                <li>主要サービスの可用性</li>
                <li>アクティブアラートのサマリー</li>
                <li>ビジネスKPIの概要</li>
            </ul>
        </li>
        <li><strong>サービス別ダッシュボード</strong>: 各サービスの詳細監視
            <ul>
                <li>サービスの健全性指標</li>
                <li>リソース使用状況</li>
                <li>エラー率と応答時間</li>
                <li>依存サービス連携状況</li>
            </ul>
        </li>
        <li><strong>インフラダッシュボード</strong>: インフラ状況の監視
            <ul>
                <li>ノード状態とリソース使用率</li>
                <li>データベースパフォーマンス</li>
                <li>ネットワーク状態</li>
                <li>ストレージ使用状況</li>
            </ul>
        </li>
        <li><strong>ビジネスダッシュボード</strong>: 業務指標の監視
            <ul>
                <li>契約状況</li>
                <li>マッチング効率</li>
                <li>請求・支払処理状況</li>
                <li>技術者稼働状況</li>
            </ul>
        </li>
        <li><strong>トラブルシューティングダッシュボード</strong>: 障害調査用
            <ul>
                <li>詳細なアプリケーションメトリクス</li>
                <li>JVMと言語ランタイムの状態</li>
                <li>スロークエリと高負荷エンドポイント</li>
                <li>ログとトレースへの連携</li>
            </ul>
        </li>
    </ol>

    <h4>13.6.2 ユーザーロールに応じたダッシュボード</h4>
    <table>
        <tr>
            <th>ユーザーロール</th>
            <th>主な関心事</th>
            <th>ダッシュボード内容</th>
        </tr>
        <tr>
            <td>運用管理者</td>
            <td>システム全体の健全性、アラート状況</td>
            <td>全体状況、アラート一覧、リソース使用状況</td>
        </tr>
        <tr>
            <td>システム管理者</td>
            <td>インフラと技術的詳細</td>
            <td>詳細なリソースメトリクス、セキュリティ状態、パフォーマンス指標</td>
        </tr>
        <tr>
            <td>開発者</td>
            <td>アプリケーションの状態と性能</td>
            <td>API性能、エラー率、JVMメトリクス、依存サービス連携状況</td>
        </tr>
        <tr>
            <td>業務管理者</td>
            <td>業務KPIと利用状況</td>
            <td>ユーザー活動、業務処理効率、契約状況、マッチング状況</td>
        </tr>
        <tr>
            <td>経営層</td>
            <td>ビジネスパフォーマンス</td>
            <td>サービスレベル達成状況、重要KPI、トレンド分析</td>
        </tr>
    </table>

    <h3>13.7 監視運用</h3>
    <p>監視システムの運用方針を以下に示す。</p>

    <h4>13.7.1 監視設定管理</h4>
    <ul>
        <li><strong>構成管理</strong>: 監視設定をコード化し、バージョン管理システムで管理</li>
        <li><strong>CI/CD連携</strong>: アプリケーションデプロイ時に監視設定も自動更新</li>
        <li><strong>テスト</strong>: アラートルールのテストを自動化し、誤検知を防止</li>
        <li><strong>ドキュメント化</strong>: 各アラートの意味と対応方法をドキュメント化</li>
        <li><strong>定期レビュー</strong>: 監視設定の有効性を定期的にレビューし最適化</li>
    </ul>

    <h4>13.7.2 インシデント対応</h4>
    <p>監視アラートに基づくインシデント対応フローを以下のように定義する：</p>
    <ol>
        <li><strong>検知</strong>: 監視システムがアラート条件を検知</li>
        <li><strong>通知</strong>: 重要度に応じた通知先へアラート送信</li>
        <li><strong>トリアージ</strong>: オンコール担当者がアラートの緊急度と影響範囲を評価</li>
        <li><strong>エスカレーション</strong>: 必要に応じて適切な専門家へエスカレーション</li>
        <li><strong>対応</strong>: インシデント対応手順に従い問題を解決</li>
        <li><strong>解決</strong>: 問題解決後、アラートをクローズ</li>
        <li><strong>事後分析</strong>: インシデントの根本原因分析と再発防止策の検討</li>
        <li><strong>改善</strong>: 監視ルールとアラート設定の見直し</li>
    </ol>

    <h4>13.7.3 キャパシティプランニング</h4>
    <p>監視データを活用したキャパシティプランニングを実施する。</p>
    <ul>
        <li><strong>トレンド分析</strong>: リソース使用量の長期トレンドを分析し、将来予測を行う</li>
        <li><strong>季節変動対応</strong>: 繁忙期に備えたリソース計画を立案</li>
        <li><strong>ボトルネック特定</strong>: パフォーマンス測定により拡張が必要なコンポーネントを特定</li>
        <li><strong>スケール計画</strong>: 段階的なスケールアップ/アウト計画の立案</li>
        <li><strong>コスト最適化</strong>: 使用率データに基づくリソース最適化</li>
    </ul>

    <h3>13.8 SLI/SLO設計</h3>
    <p>主要なサービスレベル指標（SLI）とサービスレベル目標（SLO）を定義する。</p>

    <h4>13.8.1 SLI定義</h4>
    <table>
        <tr>
            <th>SLI</th>
            <th>測定方法</th>
            <th>測定ポイント</th>
        </tr>
        <tr>
            <td>可用性</td>
            <td>成功リクエスト数 / 全リクエスト数</td>
            <td>API Gateway</td>
        </tr>
        <tr>
            <td>レイテンシ</td>
            <td>レスポンス時間の90パーセンタイル</td>
            <td>各サービスエンドポイント</td>
        </tr>
        <tr>
            <td>エラー率</td>
            <td>エラーレスポンス数 / 全リクエスト数</td>
            <td>各サービスエンドポイント</td>
        </tr>
        <tr>
            <td>処理能力</td>
            <td>単位時間あたりの処理リクエスト数</td>
            <td>アプリケーションサービス</td>
        </tr>
        <tr>
            <td>データ新鮮度</td>
            <td>最終データ更新からの経過時間</td>
            <td>データ分析サービス</td>
        </tr>
    </table>

    <h4>13.8.2 SLO定義</h4>
    <table>
        <tr>
            <th>サービス</th>
            <th>SLI</th>
            <th>SLO</th>
            <th>測定期間</th>
            <th>エラーバジェット</th>
        </tr>
        <tr>
            <td rowspan="3">API Gateway</td>
            <td>可用性</td>
            <td>99.9%</td>
            <td>月次</td>
            <td>43分/月</td>
        </tr>
        <tr>
            <td>レイテンシ</td>
            <td>95%のリクエストが200ms以内</td>
            <td>日次</td>
            <td>5%のリクエスト</td>
        </tr>
        <tr>
            <td>エラー率</td>
            <td>0.5%未満</td>
            <td>日次</td>
            <td>0.5%のリクエスト</td>
        </tr>
        <tr>
            <td rowspan="2">契約管理サービス</td>
            <td>可用性</td>
            <td>99.5%</td>
            <td>月次</td>
            <td>3.6時間/月</td>
        </tr>
        <tr>
            <td>契約処理時間</td>
            <td>90%の処理が5秒以内</td>
            <td>日次</td>
            <td>10%の処理</td>
        </tr>
        <tr>
            <td rowspan="2">マッチングエンジン</td>
            <td>バッチ処理成功率</td>
            <td>99%</td>
            <td>週次</td>
            <td>1回/週</td>
        </tr>
        <tr>
            <td>処理時間</td>
            <td>95%の処理が30分以内</td>
            <td>週次</td>
            <td>5%の処理</td>
        </tr>
        <tr>
            <td rowspan="2">勤怠工数システム</td>
            <td>可用性</td>
            <td>99.5%（営業時間内）</td>
            <td>月次</td>
            <td>3.6時間/月</td>
        </tr>
        <tr>
            <td>データ保存時間</td>
            <td>95%の保存が2秒以内</td>
            <td>日次</td>
            <td>5%の処理</td>
        </tr>
    </table>

    <h4>13.8.3 SLO監視とレポート</h4>
    <ul>
        <li><strong>リアルタイム監視</strong>: SLI指標のリアルタイム監視とアラート設定</li>
        <li><strong>エラーバジェット消費</strong>: エラーバジェット消費率の可視化</li>
        <li><strong>傾向分析</strong>: SLI指標の経時変化と傾向分析</li>
        <li><strong>定期レポート</strong>: SLO達成状況の定期レポート（日次/週次/月次）</li>
        <li><strong>改善計画</strong>: SLO未達時の改善計画立案と実施</li>
    </ul>

    <h2 id="migration">14. 移行設計</h2>
    <p class="todo">TODO: 移行設計の詳細を記述する。</p>

    <h2 id="appendix">15. 付録</h2>
    <p class="todo">TODO: 必要に応じて付録情報を追加する。</p>

    <footer>
        <p>© 2025 SES業務システム プロジェクト</p>
    </footer>
</body>
</html>