<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ユーザー管理API 基本設計</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3, h4 {
            color: #0066cc;
            margin-top: 24px;
        }
        h1 {
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #0066cc;
            padding-bottom: 5px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        code {
            background-color: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
        }
        .note {
            background-color: #e7f3fe;
            border-left: 6px solid #2196F3;
            padding: 10px;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 6px solid #ffc107;
            padding: 10px;
            margin: 15px 0;
        }
        .endpoint {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 6px solid #6c757d;
        }
        .method {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 3px;
            color: white;
            display: inline-block;
            margin-right: 10px;
        }
        .get {
            background-color: #61affe;
        }
        .post {
            background-color: #49cc90;
        }
        .put {
            background-color: #fca130;
        }
        .delete {
            background-color: #f93e3e;
        }
        .path {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ユーザー管理API 基本設計</h1>

    <h2>1. 概要</h2>
    <p>
        ユーザー管理APIは、SES業務システムのユーザーアカウントを管理するためのAPIです。
        ユーザーの作成、更新、削除、ステータス変更、パスワードリセット、活動履歴の取得などの機能を提供します。
    </p>

    <h2>2. API一覧</h2>
    <table>
        <tr>
            <th>メソッド</th>
            <th>パス</th>
            <th>説明</th>
        </tr>
        <tr>
            <td>GET</td>
            <td>/api/v1/admin/users</td>
            <td>ユーザー一覧の取得</td>
        </tr>
        <tr>
            <td>POST</td>
            <td>/api/v1/admin/users/search</td>
            <td>ユーザー検索</td>
        </tr>
        <tr>
            <td>POST</td>
            <td>/api/v1/admin/users</td>
            <td>新規ユーザーの作成</td>
        </tr>
        <tr>
            <td>GET</td>
            <td>/api/v1/admin/users/{userId}</td>
            <td>特定ユーザーの詳細取得</td>
        </tr>
        <tr>
            <td>PUT</td>
            <td>/api/v1/admin/users/{userId}</td>
            <td>ユーザー情報の更新</td>
        </tr>
        <tr>
            <td>PUT</td>
            <td>/api/v1/admin/users/{userId}/status</td>
            <td>ユーザーステータスの変更</td>
        </tr>
        <tr>
            <td>POST</td>
            <td>/api/v1/admin/users/{userId}/reset-password</td>
            <td>ユーザーパスワードのリセット</td>
        </tr>
        <tr>
            <td>POST</td>
            <td>/api/v1/admin/users/{userId}/unlock</td>
            <td>ユーザーアカウントのロック解除</td>
        </tr>
        <tr>
            <td>PUT</td>
            <td>/api/v1/admin/users/bulk-status</td>
            <td>複数ユーザーステータスの一括変更</td>
        </tr>
        <tr>
            <td>POST</td>
            <td>/api/v1/admin/users/bulk-unlock</td>
            <td>複数ユーザーの一括ロック解除</td>
        </tr>
    </table>

    <h2>3. 共通仕様</h2>
    
    <h3>3.1 レスポンス形式</h3>
    <p>
        すべてのAPIレスポンスは統一された形式で返されます。正常系のレスポンスは以下の形式です。
    </p>
    <pre><code>{
  "data": {
    // レスポンスデータ
  }
}</code></pre>
    <p>
        エラー系のレスポンスは以下の形式です。
    </p>
    <pre><code>{
  "error": {
    "code": "ERROR_CODE",
    "message": "エラーメッセージ",
    "details": [
      // バリデーションエラーなどの詳細情報（任意）
      {
        "field": "フィールド名",
        "message": "エラーメッセージ"
      }
    ]
  }
}</code></pre>

    <h3>3.2 認証方式</h3>
    <p>
        すべてのAPIは、認証済みユーザーからのアクセスが必要です。認証には以下のヘッダーが必要です。
    </p>
    <pre><code>Authorization: Bearer {JWT_ACCESS_TOKEN}</code></pre>

    <h3>3.3 エラーコード</h3>
    <table>
        <tr>
            <th>エラーコード</th>
            <th>説明</th>
        </tr>
        <tr>
            <td>UNAUTHORIZED</td>
            <td>認証が必要です</td>
        </tr>
        <tr>
            <td>FORBIDDEN</td>
            <td>このリソースにアクセスする権限がありません</td>
        </tr>
        <tr>
            <td>VALIDATION_ERROR</td>
            <td>入力データにエラーがあります</td>
        </tr>
        <tr>
            <td>NOT_FOUND</td>
            <td>リソースが見つかりません</td>
        </tr>
        <tr>
            <td>RESOURCE_ALREADY_EXISTS</td>
            <td>リソースが既に存在します</td>
        </tr>
        <tr>
            <td>INTERNAL_SERVER_ERROR</td>
            <td>内部サーバーエラーが発生しました</td>
        </tr>
    </table>

    <h2>4. API詳細</h2>

    <div class="endpoint">
        <h3><span class="method get">GET</span><span class="path">/api/v1/admin/users</span></h3>
        <p><strong>説明：</strong> ユーザー一覧を取得します。</p>

        <h4>リクエストパラメータ</h4>
        <p>なし</p>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "email": "admin@example.com",
      "name": "システム管理者",
      "department": "システム管理部",
      "position": "システム管理者",
      "role": "ADMIN",
      "status": "active",
      "lastLoginAt": "2025-05-01T09:00:00.000Z",
      "createdAt": "2025-01-15T10:30:00.000Z",
      "updatedAt": "2025-04-20T14:45:00.000Z"
    },
    {
      "id": "550e8401-e29b-41d4-a716-446655440001",
      "email": "user@example.com",
      "name": "一般ユーザー",
      "department": "営業部",
      "position": "一般社員",
      "role": "USER",
      "status": "active",
      "lastLoginAt": "2025-05-02T14:30:00.000Z",
      "createdAt": "2025-02-01T09:15:00.000Z",
      "updatedAt": "2025-04-25T10:20:00.000Z"
    }
    // ... その他のユーザー
  ]
}</code></pre>

        <h4>エラーレスポンス例</h4>
        <pre><code>{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "認証が必要です。"
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span><span class="path">/api/v1/admin/users/search</span></h3>
        <p><strong>説明：</strong> 条件に一致するユーザーを検索します。</p>

        <h4>リクエストボディ</h4>
        <pre><code>{
  "keyword": "検索キーワード",
  "status": "active",
  "role": "ADMIN",
  "department": "システム管理部",
  "from": "2025-01-01T00:00:00.000Z",
  "to": "2025-05-01T00:00:00.000Z"
}</code></pre>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "email": "admin@example.com",
      "name": "システム管理者",
      "department": "システム管理部",
      "position": "システム管理者",
      "role": "ADMIN",
      "status": "active",
      "lastLoginAt": "2025-05-01T09:00:00.000Z",
      "createdAt": "2025-01-15T10:30:00.000Z",
      "updatedAt": "2025-04-20T14:45:00.000Z"
    }
    // ... 検索条件に一致する他のユーザー
  ]
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span><span class="path">/api/v1/admin/users</span></h3>
        <p><strong>説明：</strong> 新規ユーザーを作成します。</p>

        <h4>リクエストボディ</h4>
        <pre><code>{
  "email": "new.user@example.com",
  "name": "新規 ユーザー",
  "password": "Password123",
  "department": "営業部",
  "position": "一般社員",
  "role": "USER",
  "status": "active"
}</code></pre>

        <h4>レスポンス例（成功時 - 201 Created）</h4>
        <pre><code>{
  "data": {
    "id": "550e8402-e29b-41d4-a716-446655440002",
    "email": "new.user@example.com",
    "name": "新規 ユーザー",
    "department": "営業部",
    "position": "一般社員",
    "role": "USER",
    "status": "active",
    "createdAt": "2025-05-06T10:30:00.000Z",
    "updatedAt": "2025-05-06T10:30:00.000Z"
  }
}</code></pre>

        <h4>エラーレスポンス例</h4>
        <pre><code>{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力データにエラーがあります。",
    "details": [
      {
        "field": "email",
        "message": "有効なメールアドレスを入力してください"
      },
      {
        "field": "password",
        "message": "パスワードは8文字以上で、英字と数字を含む必要があります"
      }
    ]
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method get">GET</span><span class="path">/api/v1/admin/users/{userId}</span></h3>
        <p><strong>説明：</strong> 特定のユーザーの詳細情報を取得します。</p>

        <h4>パスパラメータ</h4>
        <table>
            <tr>
                <th>パラメータ名</th>
                <th>型</th>
                <th>説明</th>
            </tr>
            <tr>
                <td>userId</td>
                <td>string</td>
                <td>ユーザーID（UUID形式）</td>
            </tr>
        </table>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "admin@example.com",
    "name": "システム管理者",
    "department": "システム管理部",
    "position": "システム管理者",
    "phone": "03-1234-5678",
    "role": "ADMIN",
    "status": "active",
    "lastLoginAt": "2025-05-01T09:00:00.000Z",
    "loginAttempts": 0,
    "passwordExpiresAt": "2025-06-01T00:00:00.000Z",
    "mfaEnabled": false,
    "createdAt": "2025-01-15T10:30:00.000Z",
    "updatedAt": "2025-04-20T14:45:00.000Z"
  }
}</code></pre>

        <h4>エラーレスポンス例</h4>
        <pre><code>{
  "error": {
    "code": "NOT_FOUND",
    "message": "指定されたユーザーが見つかりません。"
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method put">PUT</span><span class="path">/api/v1/admin/users/{userId}</span></h3>
        <p><strong>説明：</strong> ユーザー情報を更新します。</p>

        <h4>パスパラメータ</h4>
        <table>
            <tr>
                <th>パラメータ名</th>
                <th>型</th>
                <th>説明</th>
            </tr>
            <tr>
                <td>userId</td>
                <td>string</td>
                <td>ユーザーID（UUID形式）</td>
            </tr>
        </table>

        <h4>リクエストボディ</h4>
        <pre><code>{
  "email": "updated.email@example.com",
  "name": "更新 ユーザー",
  "department": "営業部",
  "position": "主任",
  "phone": "03-1234-5678",
  "role": "MANAGER",
  "status": "active"
}</code></pre>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "updated.email@example.com",
    "name": "更新 ユーザー",
    "department": "営業部",
    "position": "主任",
    "phone": "03-1234-5678",
    "role": "MANAGER",
    "status": "active",
    "updatedAt": "2025-05-06T11:30:00.000Z"
  }
}</code></pre>

        <h4>エラーレスポンス例</h4>
        <pre><code>{
  "error": {
    "code": "NOT_FOUND",
    "message": "指定されたユーザーが見つかりません。"
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method put">PUT</span><span class="path">/api/v1/admin/users/{userId}/status</span></h3>
        <p><strong>説明：</strong> ユーザーのステータスを変更します。</p>

        <h4>パスパラメータ</h4>
        <table>
            <tr>
                <th>パラメータ名</th>
                <th>型</th>
                <th>説明</th>
            </tr>
            <tr>
                <td>userId</td>
                <td>string</td>
                <td>ユーザーID（UUID形式）</td>
            </tr>
        </table>

        <h4>リクエストボディ</h4>
        <pre><code>{
  "status": "inactive"  // active, inactive, locked のいずれか
}</code></pre>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "status": "inactive",
    "updatedAt": "2025-05-06T12:00:00.000Z"
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span><span class="path">/api/v1/admin/users/{userId}/reset-password</span></h3>
        <p><strong>説明：</strong> ユーザーのパスワードをリセットします。</p>

        <h4>パスパラメータ</h4>
        <table>
            <tr>
                <th>パラメータ名</th>
                <th>型</th>
                <th>説明</th>
            </tr>
            <tr>
                <td>userId</td>
                <td>string</td>
                <td>ユーザーID（UUID形式）</td>
            </tr>
        </table>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": {
    "message": "パスワードが正常にリセットされました",
    "id": "550e8400-e29b-41d4-a716-446655440000"
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span><span class="path">/api/v1/admin/users/{userId}/unlock</span></h3>
        <p><strong>説明：</strong> ロックされたユーザーアカウントのロックを解除します。</p>

        <h4>パスパラメータ</h4>
        <table>
            <tr>
                <th>パラメータ名</th>
                <th>型</th>
                <th>説明</th>
            </tr>
            <tr>
                <td>userId</td>
                <td>string</td>
                <td>ユーザーID（UUID形式）</td>
            </tr>
        </table>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": {
    "message": "アカウントロックが解除されました",
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "status": "active"
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method put">PUT</span><span class="path">/api/v1/admin/users/bulk-status</span></h3>
        <p><strong>説明：</strong> 複数ユーザーのステータスを一括で変更します。</p>

        <h4>リクエストボディ</h4>
        <pre><code>{
  "userIds": [
    "550e8400-e29b-41d4-a716-446655440000",
    "550e8401-e29b-41d4-a716-446655440001"
  ],
  "status": "inactive"  // active, inactive, locked のいずれか
}</code></pre>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": {
    "message": "2 件のユーザーステータスが更新されました",
    "count": 2
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span><span class="path">/api/v1/admin/users/bulk-unlock</span></h3>
        <p><strong>説明：</strong> 複数ユーザーのアカウントロックを一括で解除します。</p>

        <h4>リクエストボディ</h4>
        <pre><code>{
  "userIds": [
    "550e8400-e29b-41d4-a716-446655440000",
    "550e8401-e29b-41d4-a716-446655440001"
  ]
}</code></pre>

        <h4>レスポンス例（成功時 - 200 OK）</h4>
        <pre><code>{
  "data": {
    "message": "2 件のユーザーアカウントのロックが解除されました",
    "count": 2
  }
}</code></pre>

        <h4>アクセス権限要件</h4>
        <p>ADMIN ロールが必要です。</p>
    </div>

    <h2>5. ユーザーステータスについて</h2>
    <p>ユーザーアカウントには以下の3つのステータスがあります：</p>
    <table>
        <tr>
            <th>ステータス</th>
            <th>説明</th>
        </tr>
        <tr>
            <td>active</td>
            <td>アクティブなユーザー。システムへのログインや操作が可能。</td>
        </tr>
        <tr>
            <td>inactive</td>
            <td>非アクティブなユーザー。システムへのログインが禁止されている。退職者や長期休職者などに設定。</td>
        </tr>
        <tr>
            <td>locked</td>
            <td>アカウントがロックされたユーザー。連続したログイン失敗などによりシステムにより自動的にロックされた状態。</td>
        </tr>
    </table>

    <h2>6. セキュリティ上の考慮事項</h2>
    <ul>
        <li>すべてのAPIは認証済みユーザーからのアクセスが必要です。</li>
        <li>ユーザー管理APIはADMINロールを持つユーザーのみアクセス可能です。</li>
        <li>パスワード関連の操作はすべて監査ログに記録されます。</li>
        <li>ユーザー一覧取得APIでは、機密情報（パスワードハッシュ等）は含まれません。</li>
        <li>パスワードリセット機能は、一時的なパスワードを生成し、初回ログイン時にパスワード変更を強制する仕組みを使用します。</li>
    </ul>

    <h2>7. 改訂履歴</h2>
    <table>
        <tr>
            <th>日付</th>
            <th>バージョン</th>
            <th>内容</th>
            <th>担当者</th>
        </tr>
        <tr>
            <td>2025/05/06</td>
            <td>1.1</td>
            <td>API実装に合わせて仕様を更新</td>
            <td>S.Ichimaru</td>
        </tr>
        <tr>
            <td>2025/05/04</td>
            <td>1.0</td>
            <td>初版作成</td>
            <td>S.Ichimaru</td>
        </tr>
    </table>

</body>
</html>