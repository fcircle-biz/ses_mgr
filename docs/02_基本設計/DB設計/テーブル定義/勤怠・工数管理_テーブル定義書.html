<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>勤怠・工数管理 テーブル定義書 (PostgreSQL)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #2980b9;
            margin-top: 30px;
            border-left: 5px solid #3498db;
            padding-left: 10px;
        }
        p {
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        ul {
            margin-bottom: 20px;
        }
        li {
            margin-bottom: 5px;
        }
        .code-block {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>勤怠・工数管理 テーブル定義書 (PostgreSQL)</h1>

    <h2>勤務月次テーブル (monthly_attendances)</h2>
    <p>技術者の月次勤怠情報を管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>外部キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>monthly_attendance_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td></td>
                <td>月次勤怠ID</td>
            </tr>
            <tr>
                <td>engineer_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(engineers.engineer_id)</td>
                <td></td>
                <td>技術者ID</td>
            </tr>
            <tr>
                <td>project_id</td>
                <td>INTEGER</td>
                <td>YES</td>
                <td></td>
                <td>FK(projects.project_id)</td>
                <td></td>
                <td>案件ID</td>
            </tr>
            <tr>
                <td>target_year</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>対象年</td>
            </tr>
            <tr>
                <td>target_month</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>対象月</td>
            </tr>
            <tr>
                <td>contracted_working_days</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>契約稼働日数</td>
            </tr>
            <tr>
                <td>working_days</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>実働日数</td>
            </tr>
            <tr>
                <td>absence_days</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>欠勤日数</td>
            </tr>
            <tr>
                <td>paid_leave_days</td>
                <td>NUMERIC(3,1)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>有給休暇日数</td>
            </tr>
            <tr>
                <td>total_working_hours</td>
                <td>NUMERIC(5,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>総稼働時間</td>
            </tr>
            <tr>
                <td>overtime_hours</td>
                <td>NUMERIC(5,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>残業時間</td>
            </tr>
            <tr>
                <td>night_work_hours</td>
                <td>NUMERIC(5,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>深夜勤務時間</td>
            </tr>
            <tr>
                <td>holiday_work_hours</td>
                <td>NUMERIC(5,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>休日勤務時間</td>
            </tr>
            <tr>
                <td>status</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'作成中'</td>
                <td>ステータス</td>
            </tr>
            <tr>
                <td>remarks</td>
                <td>TEXT</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>備考</td>
            </tr>
            <tr>
                <td>submitted_at</td>
                <td>TIMESTAMP</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>提出日時</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>更新日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (target_year >= 2000 AND target_year <= 2100)</li>
                <li>CHECK (target_month >= 1 AND target_month <= 12)</li>
                <li>CHECK (status IN ('作成中', '提出済', '承認済', '差戻', '確定'))</li>
                <li>UNIQUE (engineer_id, project_id, target_year, target_month)</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (monthly_attendance_id)</li>
                <li>CREATE INDEX idx_monthly_attendances_engineer_id ON monthly_attendances(engineer_id);</li>
                <li>CREATE INDEX idx_monthly_attendances_project_id ON monthly_attendances(project_id);</li>
                <li>CREATE INDEX idx_monthly_attendances_year_month ON monthly_attendances(target_year, target_month);</li>
                <li>CREATE INDEX idx_monthly_attendances_status ON monthly_attendances(status);</li>
            </ul>
        </li>
    </ul>

    <h2>日次勤怠テーブル (daily_attendances)</h2>
    <p>技術者の日次勤怠情報を管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>外部キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>daily_attendance_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td></td>
                <td>日次勤怠ID</td>
            </tr>
            <tr>
                <td>monthly_attendance_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(monthly_attendances.monthly_attendance_id)</td>
                <td></td>
                <td>月次勤怠ID</td>
            </tr>
            <tr>
                <td>attendance_date</td>
                <td>DATE</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>勤務日</td>
            </tr>
            <tr>
                <td>day_type</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'平日'</td>
                <td>日区分</td>
            </tr>
            <tr>
                <td>start_time</td>
                <td>TIME</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>開始時間</td>
            </tr>
            <tr>
                <td>end_time</td>
                <td>TIME</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>終了時間</td>
            </tr>
            <tr>
                <td>break_time</td>
                <td>NUMERIC(3,1)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>1.0</td>
                <td>休憩時間(時間)</td>
            </tr>
            <tr>
                <td>working_hours</td>
                <td>NUMERIC(4,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>実働時間</td>
            </tr>
            <tr>
                <td>overtime_hours</td>
                <td>NUMERIC(4,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>残業時間</td>
            </tr>
            <tr>
                <td>night_work_hours</td>
                <td>NUMERIC(4,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>深夜勤務時間</td>
            </tr>
            <tr>
                <td>attendance_type</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'出勤'</td>
                <td>勤怠区分</td>
            </tr>
            <tr>
                <td>location_type</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'客先'</td>
                <td>勤務場所区分</td>
            </tr>
            <tr>
                <td>location_details</td>
                <td>TEXT</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>勤務場所詳細</td>
            </tr>
            <tr>
                <td>remarks</td>
                <td>TEXT</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>備考</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>更新日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (day_type IN ('平日', '休日', '祝日'))</li>
                <li>CHECK (attendance_type IN ('出勤', '欠勤', '有給休暇', '半休', '特別休暇', 'リモート勤務'))</li>
                <li>CHECK (location_type IN ('客先', '社内', 'リモート', 'その他'))</li>
                <li>UNIQUE (monthly_attendance_id, attendance_date)</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (daily_attendance_id)</li>
                <li>CREATE INDEX idx_daily_attendances_monthly_attendance_id ON daily_attendances(monthly_attendance_id);</li>
                <li>CREATE INDEX idx_daily_attendances_attendance_date ON daily_attendances(attendance_date);</li>
                <li>CREATE INDEX idx_daily_attendances_attendance_type ON daily_attendances(attendance_type);</li>
            </ul>
        </li>
    </ul>

    <h2>工数テーブル (work_hours)</h2>
    <p>日次の作業工数を管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>外部キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>work_hour_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td></td>
                <td>工数ID</td>
            </tr>
            <tr>
                <td>daily_attendance_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(daily_attendances.daily_attendance_id)</td>
                <td></td>
                <td>日次勤怠ID</td>
            </tr>
            <tr>
                <td>project_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(projects.project_id)</td>
                <td></td>
                <td>案件ID</td>
            </tr>
            <tr>
                <td>task_name</td>
                <td>VARCHAR(100)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>タスク名</td>
            </tr>
            <tr>
                <td>task_category</td>
                <td>TEXT</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td>'開発'</td>
                <td>タスク分類</td>
            </tr>
            <tr>
                <td>work_hours</td>
                <td>NUMERIC(4,2)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>0</td>
                <td>工数(時間)</td>
            </tr>
            <tr>
                <td>billable</td>
                <td>BOOLEAN</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>TRUE</td>
                <td>請求可能フラグ</td>
            </tr>
            <tr>
                <td>description</td>
                <td>TEXT</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>作業内容</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>更新日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (work_hours >= 0)</li>
                <li>CHECK (task_category IN ('要件定義', '設計', '開発', 'テスト', 'レビュー', '会議', '調査', '保守', 'その他'))</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (work_hour_id)</li>
                <li>CREATE INDEX idx_work_hours_daily_attendance_id ON work_hours(daily_attendance_id);</li>
                <li>CREATE INDEX idx_work_hours_project_id ON work_hours(project_id);</li>
                <li>CREATE INDEX idx_work_hours_task_category ON work_hours(task_category);</li>
                <li>CREATE INDEX idx_work_hours_billable ON work_hours(billable);</li>
            </ul>
        </li>
    </ul>

    <h2>承認フローテーブル (approval_flows)</h2>
    <p>勤怠承認フローを管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>外部キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>flow_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td></td>
                <td>フローID</td>
            </tr>
            <tr>
                <td>monthly_attendance_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(monthly_attendances.monthly_attendance_id)</td>
                <td></td>
                <td>月次勤怠ID</td>
            </tr>
            <tr>
                <td>current_step</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>1</td>
                <td>現在のステップ</td>
            </tr>
            <tr>
                <td>flow_type</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'標準'</td>
                <td>フロータイプ</td>
            </tr>
            <tr>
                <td>status</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'申請中'</td>
                <td>ステータス</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>更新日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (current_step >= 0)</li>
                <li>CHECK (flow_type IN ('標準', '緊急', '特別'))</li>
                <li>CHECK (status IN ('申請中', '承認中', '差戻', '完了', 'キャンセル'))</li>
                <li>UNIQUE (monthly_attendance_id)</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (flow_id)</li>
                <li>CREATE INDEX idx_approval_flows_monthly_attendance_id ON approval_flows(monthly_attendance_id);</li>
                <li>CREATE INDEX idx_approval_flows_status ON approval_flows(status);</li>
            </ul>
        </li>
    </ul>

    <h2>承認ステップテーブル (approval_steps)</h2>
    <p>勤怠承認の各ステップを管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>外部キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>step_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td></td>
                <td>ステップID</td>
            </tr>
            <tr>
                <td>flow_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(approval_flows.flow_id)</td>
                <td></td>
                <td>フローID</td>
            </tr>
            <tr>
                <td>step_number</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>ステップ番号</td>
            </tr>
            <tr>
                <td>approver_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(users.user_id)</td>
                <td></td>
                <td>承認者ID</td>
            </tr>
            <tr>
                <td>approver_role</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'PM'</td>
                <td>承認者役割</td>
            </tr>
            <tr>
                <td>status</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>'未対応'</td>
                <td>ステータス</td>
            </tr>
            <tr>
                <td>approved_at</td>
                <td>TIMESTAMP</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>承認日時</td>
            </tr>
            <tr>
                <td>comments</td>
                <td>TEXT</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>コメント</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>更新日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (step_number >= 1)</li>
                <li>CHECK (approver_role IN ('PM', '営業', '管理者', '経理', 'その他'))</li>
                <li>CHECK (status IN ('未対応', '承認', '差戻', '保留', 'スキップ'))</li>
                <li>UNIQUE (flow_id, step_number)</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (step_id)</li>
                <li>CREATE INDEX idx_approval_steps_flow_id ON approval_steps(flow_id);</li>
                <li>CREATE INDEX idx_approval_steps_approver_id ON approval_steps(approver_id);</li>
                <li>CREATE INDEX idx_approval_steps_status ON approval_steps(status);</li>
            </ul>
        </li>
    </ul>

    <h2>勤務設定テーブル (work_settings)</h2>
    <p>技術者の勤務時間や休憩時間などの設定を管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>外部キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>setting_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td></td>
                <td>設定ID</td>
            </tr>
            <tr>
                <td>engineer_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(engineers.engineer_id)</td>
                <td></td>
                <td>技術者ID</td>
            </tr>
            <tr>
                <td>project_id</td>
                <td>INTEGER</td>
                <td>YES</td>
                <td></td>
                <td>FK(projects.project_id)</td>
                <td></td>
                <td>案件ID</td>
            </tr>
            <tr>
                <td>regular_work_hours</td>
                <td>NUMERIC(3,1)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>8.0</td>
                <td>所定労働時間</td>
            </tr>
            <tr>
                <td>default_start_time</td>
                <td>TIME</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td>'09:00:00'</td>
                <td>デフォルト開始時間</td>
            </tr>
            <tr>
                <td>default_end_time</td>
                <td>TIME</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td>'18:00:00'</td>
                <td>デフォルト終了時間</td>
            </tr>
            <tr>
                <td>default_break_time</td>
                <td>NUMERIC(3,1)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>1.0</td>
                <td>デフォルト休憩時間</td>
            </tr>
            <tr>
                <td>overtime_threshold</td>
                <td>NUMERIC(3,1)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>8.0</td>
                <td>残業閾値(時間)</td>
            </tr>
            <tr>
                <td>night_work_start</td>
                <td>TIME</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td>'22:00:00'</td>
                <td>深夜勤務開始時間</td>
            </tr>
            <tr>
                <td>night_work_end</td>
                <td>TIME</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td>'05:00:00'</td>
                <td>深夜勤務終了時間</td>
            </tr>
            <tr>
                <td>working_days</td>
                <td>INTEGER[]</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td>'{1,2,3,4,5}'</td>
                <td>勤務曜日(1=月,7=日)</td>
            </tr>
            <tr>
                <td>is_active</td>
                <td>BOOLEAN</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>TRUE</td>
                <td>有効フラグ</td>
            </tr>
            <tr>
                <td>valid_from</td>
                <td>DATE</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>有効開始日</td>
            </tr>
            <tr>
                <td>valid_to</td>
                <td>DATE</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>有効終了日</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>更新日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (regular_work_hours > 0)</li>
                <li>CHECK (default_break_time >= 0)</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (setting_id)</li>
                <li>CREATE INDEX idx_work_settings_engineer_id ON work_settings(engineer_id);</li>
                <li>CREATE INDEX idx_work_settings_project_id ON work_settings(project_id);</li>
                <li>CREATE INDEX idx_work_settings_is_active ON work_settings(is_active);</li>
                <li>CREATE INDEX idx_work_settings_valid_dates ON work_settings(valid_from, valid_to);</li>
            </ul>
        </li>
    </ul>

    <h2>勤怠通知テーブル (attendance_notifications)</h2>
    <p>勤怠に関する通知やリマインダーを管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>外部キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>notification_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td></td>
                <td>通知ID</td>
            </tr>
            <tr>
                <td>notification_type</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>通知タイプ</td>
            </tr>
            <tr>
                <td>user_id</td>
                <td>INTEGER</td>
                <td>NO</td>
                <td></td>
                <td>FK(users.user_id)</td>
                <td></td>
                <td>ユーザーID</td>
            </tr>
            <tr>
                <td>title</td>
                <td>VARCHAR(200)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>タイトル</td>
            </tr>
            <tr>
                <td>message</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>メッセージ</td>
            </tr>
            <tr>
                <td>related_entity</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td></td>
                <td>関連エンティティ種別</td>
            </tr>
            <tr>
                <td>entity_id</td>
                <td>INTEGER</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>エンティティID</td>
            </tr>
            <tr>
                <td>is_read</td>
                <td>BOOLEAN</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>FALSE</td>
                <td>既読フラグ</td>
            </tr>
            <tr>
                <td>read_at</td>
                <td>TIMESTAMP</td>
                <td>YES</td>
                <td></td>
                <td></td>
                <td></td>
                <td>既読日時</td>
            </tr>
            <tr>
                <td>notify_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>通知日時</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (notification_type IN ('勤怠提出リマインド', '勤怠承認依頼', '勤怠承認完了', '勤怠差戻', 'その他'))</li>
                <li>CHECK (related_entity IN ('monthly_attendance', 'daily_attendance', 'approval', 'other'))</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (notification_id)</li>
                <li>CREATE INDEX idx_attendance_notifications_user_id ON attendance_notifications(user_id);</li>
                <li>CREATE INDEX idx_attendance_notifications_is_read ON attendance_notifications(is_read);</li>
                <li>CREATE INDEX idx_attendance_notifications_notify_at ON attendance_notifications(notify_at);</li>
                <li>CREATE INDEX idx_attendance_notifications_type ON attendance_notifications(notification_type);</li>
            </ul>
        </li>
    </ul>

    <h2>休日カレンダーテーブル (holidays)</h2>
    <p>祝日や会社の休業日を管理するテーブル</p>
    
    <table>
        <thead>
            <tr>
                <th>カラム名</th>
                <th>データ型</th>
                <th>NULL</th>
                <th>主キー</th>
                <th>デフォルト</th>
                <th>説明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>holiday_id</td>
                <td>SERIAL</td>
                <td>NO</td>
                <td>PK</td>
                <td></td>
                <td>休日ID</td>
            </tr>
            <tr>
                <td>holiday_date</td>
                <td>DATE</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>休日日付</td>
            </tr>
            <tr>
                <td>holiday_name</td>
                <td>VARCHAR(100)</td>
                <td>NO</td>
                <td></td>
                <td></td>
                <td>休日名</td>
            </tr>
            <tr>
                <td>holiday_type</td>
                <td>TEXT</td>
                <td>NO</td>
                <td></td>
                <td>'祝日'</td>
                <td>休日タイプ</td>
            </tr>
            <tr>
                <td>is_half_day</td>
                <td>BOOLEAN</td>
                <td>NO</td>
                <td></td>
                <td>FALSE</td>
                <td>半休フラグ</td>
            </tr>
            <tr>
                <td>created_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>作成日時</td>
            </tr>
            <tr>
                <td>updated_at</td>
                <td>TIMESTAMP</td>
                <td>NO</td>
                <td></td>
                <td>CURRENT_TIMESTAMP</td>
                <td>更新日時</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>制約
            <ul>
                <li>CHECK (holiday_type IN ('祝日', '会社休業日', 'その他'))</li>
                <li>UNIQUE (holiday_date, holiday_type)</li>
            </ul>
        </li>
        <li>インデックス
            <ul>
                <li>PRIMARY KEY (holiday_id)</li>
                <li>CREATE INDEX idx_holidays_date ON holidays(holiday_date);</li>
                <li>CREATE INDEX idx_holidays_type ON holidays(holiday_type);</li>
            </ul>
        </li>
    </ul>

    <h2>テーブル作成用SQL</h2>
    <div class="code-block">
-- 更新タイムスタンプ用のトリガー関数
CREATE OR REPLACE FUNCTION update_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- 勤務月次テーブル
CREATE TABLE monthly_attendances (
    monthly_attendance_id SERIAL PRIMARY KEY,
    engineer_id INTEGER NOT NULL REFERENCES engineers(engineer_id),
    project_id INTEGER REFERENCES projects(project_id),
    target_year INTEGER NOT NULL CHECK (target_year >= 2000 AND target_year <= 2100),
    target_month INTEGER NOT NULL CHECK (target_month >= 1 AND target_month <= 12),
    contracted_working_days INTEGER NOT NULL DEFAULT 0,
    working_days INTEGER NOT NULL DEFAULT 0,
    absence_days INTEGER NOT NULL DEFAULT 0,
    paid_leave_days NUMERIC(3,1) NOT NULL DEFAULT 0,
    total_working_hours NUMERIC(5,2) NOT NULL DEFAULT 0,
    overtime_hours NUMERIC(5,2) NOT NULL DEFAULT 0,
    night_work_hours NUMERIC(5,2) NOT NULL DEFAULT 0,
    holiday_work_hours NUMERIC(5,2) NOT NULL DEFAULT 0,
    status TEXT NOT NULL DEFAULT '作成中' 
        CHECK (status IN ('作成中', '提出済', '承認済', '差戻', '確定')),
    remarks TEXT,
    submitted_at TIMESTAMP,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (engineer_id, project_id, target_year, target_month)
);

CREATE INDEX idx_monthly_attendances_engineer_id ON monthly_attendances(engineer_id);
CREATE INDEX idx_monthly_attendances_project_id ON monthly_attendances(project_id);
CREATE INDEX idx_monthly_attendances_year_month ON monthly_attendances(target_year, target_month);
CREATE INDEX idx_monthly_attendances_status ON monthly_attendances(status);

CREATE TRIGGER update_monthly_attendances_timestamp
BEFORE UPDATE ON monthly_attendances
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();

-- 日次勤怠テーブル
CREATE TABLE daily_attendances (
    daily_attendance_id SERIAL PRIMARY KEY,
    monthly_attendance_id INTEGER NOT NULL REFERENCES monthly_attendances(monthly_attendance_id),
    attendance_date DATE NOT NULL,
    day_type TEXT NOT NULL DEFAULT '平日' CHECK (day_type IN ('平日', '休日', '祝日')),
    start_time TIME,
    end_time TIME,
    break_time NUMERIC(3,1) NOT NULL DEFAULT 1.0,
    working_hours NUMERIC(4,2) NOT NULL DEFAULT 0,
    overtime_hours NUMERIC(4,2) NOT NULL DEFAULT 0,
    night_work_hours NUMERIC(4,2) NOT NULL DEFAULT 0,
    attendance_type TEXT NOT NULL DEFAULT '出勤' 
        CHECK (attendance_type IN ('出勤', '欠勤', '有給休暇', '半休', '特別休暇', 'リモート勤務')),
    location_type TEXT NOT NULL DEFAULT '客先' CHECK (location_type IN ('客先', '社内', 'リモート', 'その他')),
    location_details TEXT,
    remarks TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (monthly_attendance_id, attendance_date)
);

CREATE INDEX idx_daily_attendances_monthly_attendance_id ON daily_attendances(monthly_attendance_id);
CREATE INDEX idx_daily_attendances_attendance_date ON daily_attendances(attendance_date);
CREATE INDEX idx_daily_attendances_attendance_type ON daily_attendances(attendance_type);

CREATE TRIGGER update_daily_attendances_timestamp
BEFORE UPDATE ON daily_attendances
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();

-- 工数テーブル
CREATE TABLE work_hours (
    work_hour_id SERIAL PRIMARY KEY,
    daily_attendance_id INTEGER NOT NULL REFERENCES daily_attendances(daily_attendance_id),
    project_id INTEGER NOT NULL REFERENCES projects(project_id),
    task_name VARCHAR(100) NOT NULL,
    task_category TEXT DEFAULT '開発' 
        CHECK (task_category IN ('要件定義', '設計', '開発', 'テスト', 'レビュー', '会議', '調査', '保守', 'その他')),
    work_hours NUMERIC(4,2) NOT NULL DEFAULT 0 CHECK (work_hours >= 0),
    billable BOOLEAN NOT NULL DEFAULT TRUE,
    description TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_work_hours_daily_attendance_id ON work_hours(daily_attendance_id);
CREATE INDEX idx_work_hours_project_id ON work_hours(project_id);
CREATE INDEX idx_work_hours_task_category ON work_hours(task_category);
CREATE INDEX idx_work_hours_billable ON work_hours(billable);

CREATE TRIGGER update_work_hours_timestamp
BEFORE UPDATE ON work_hours
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();

-- 承認フローテーブル
CREATE TABLE approval_flows (
    flow_id SERIAL PRIMARY KEY,
    monthly_attendance_id INTEGER NOT NULL REFERENCES monthly_attendances(monthly_attendance_id),
    current_step INTEGER NOT NULL DEFAULT 1 CHECK (current_step >= 0),
    flow_type TEXT NOT NULL DEFAULT '標準' CHECK (flow_type IN ('標準', '緊急', '特別')),
    status TEXT NOT NULL DEFAULT '申請中' 
        CHECK (status IN ('申請中', '承認中', '差戻', '完了', 'キャンセル')),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (monthly_attendance_id)
);

CREATE INDEX idx_approval_flows_monthly_attendance_id ON approval_flows(monthly_attendance_id);
CREATE INDEX idx_approval_flows_status ON approval_flows(status);

CREATE TRIGGER update_approval_flows_timestamp
BEFORE UPDATE ON approval_flows
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();

-- 承認ステップテーブル
CREATE TABLE approval_steps (
    step_id SERIAL PRIMARY KEY,
    flow_id INTEGER NOT NULL REFERENCES approval_flows(flow_id),
    step_number INTEGER NOT NULL CHECK (step_number >= 1),
    approver_id INTEGER NOT NULL REFERENCES users(user_id),
    approver_role TEXT NOT NULL DEFAULT 'PM' 
        CHECK (approver_role IN ('PM', '営業', '管理者', '経理', 'その他')),
    status TEXT NOT NULL DEFAULT '未対応' 
        CHECK (status IN ('未対応', '承認', '差戻', '保留', 'スキップ')),
    approved_at TIMESTAMP,
    comments TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (flow_id, step_number)
);

CREATE INDEX idx_approval_steps_flow_id ON approval_steps(flow_id);
CREATE INDEX idx_approval_steps_approver_id ON approval_steps(approver_id);
CREATE INDEX idx_approval_steps_status ON approval_steps(status);

CREATE TRIGGER update_approval_steps_timestamp
BEFORE UPDATE ON approval_steps
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();

-- 勤務設定テーブル
CREATE TABLE work_settings (
    setting_id SERIAL PRIMARY KEY,
    engineer_id INTEGER NOT NULL REFERENCES engineers(engineer_id),
    project_id INTEGER REFERENCES projects(project_id),
    regular_work_hours NUMERIC(3,1) NOT NULL DEFAULT 8.0 CHECK (regular_work_hours > 0),
    default_start_time TIME DEFAULT '09:00:00',
    default_end_time TIME DEFAULT '18:00:00',
    default_break_time NUMERIC(3,1) NOT NULL DEFAULT 1.0 CHECK (default_break_time >= 0),
    overtime_threshold NUMERIC(3,1) NOT NULL DEFAULT 8.0,
    night_work_start TIME DEFAULT '22:00:00',
    night_work_end TIME DEFAULT '05:00:00',
    working_days INTEGER[] DEFAULT '{1,2,3,4,5}',
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    valid_from DATE NOT NULL,
    valid_to DATE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_work_settings_engineer_id ON work_settings(engineer_id);
CREATE INDEX idx_work_settings_project_id ON work_settings(project_id);
CREATE INDEX idx_work_settings_is_active ON work_settings(is_active);
CREATE INDEX idx_work_settings_valid_dates ON work_settings(valid_from, valid_to);

CREATE TRIGGER update_work_settings_timestamp
BEFORE UPDATE ON work_settings
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();

-- 勤怠通知テーブル
CREATE TABLE attendance_notifications (
    notification_id SERIAL PRIMARY KEY,
    notification_type TEXT NOT NULL 
        CHECK (notification_type IN ('勤怠提出リマインド', '勤怠承認依頼', '勤怠承認完了', '勤怠差戻', 'その他')),
    user_id INTEGER NOT NULL REFERENCES users(user_id),
    title VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    related_entity TEXT NOT NULL 
        CHECK (related_entity IN ('monthly_attendance', 'daily_attendance', 'approval', 'other')),
    entity_id INTEGER,
    is_read BOOLEAN NOT NULL DEFAULT FALSE,
    read_at TIMESTAMP,
    notify_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_attendance_notifications_user_id ON attendance_notifications(user_id);
CREATE INDEX idx_attendance_notifications_is_read ON attendance_notifications(is_read);
CREATE INDEX idx_attendance_notifications_notify_at ON attendance_notifications(notify_at);
CREATE INDEX idx_attendance_notifications_type ON attendance_notifications(notification_type);

-- 休日カレンダーテーブル
CREATE TABLE holidays (
    holiday_id SERIAL PRIMARY KEY,
    holiday_date DATE NOT NULL,
    holiday_name VARCHAR(100) NOT NULL,
    holiday_type TEXT NOT NULL DEFAULT '祝日' CHECK (holiday_type IN ('祝日', '会社休業日', 'その他')),
    is_half_day BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (holiday_date, holiday_type)
);

CREATE INDEX idx_holidays_date ON holidays(holiday_date);
CREATE INDEX idx_holidays_type ON holidays(holiday_type);

CREATE TRIGGER update_holidays_timestamp
BEFORE UPDATE ON holidays
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();
    </div>

</body>
</html>